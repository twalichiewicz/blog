@use 'variables';
@use 'sass:color';
@use 'propel';

// Hidden tab content optimization
.tab-panel:not(.active) {
	.portfolio-item {
		img, video {
			visibility: hidden;
		}
	}
}

// Project edge wrapper styles
body .project-edge-wrapper,
.project-edge-wrapper {
	// Remove all borders from project-edge-wrapper but keep top-left radius
	@media (min-width: calc(variables.$mobile-breakpoint + 1px)) {
		border: none;
		border-radius: 12px 0 0 0;
		background: variables.$card-bg;
		
		@media (prefers-color-scheme: dark) {
			border: none;
			background: rgb(24, 24, 24);
		}
	}
	
	.above-fold-content-wrapper {
		.project-title {
			.project-byline {
				font-size: var(--font-size-base);
				line-height: 120%;
				margin-top: 0.5rem; // Reduce margin to bring closer to stats
				margin-bottom: 0.25rem; // Tighter bottom margin before stats
				max-width: 450px;
				margin-left: 0;
				margin-right: 0;
				
				// Mobile-specific adjustments
				@media (max-width: variables.$mobile-breakpoint) {
					margin-top: 0.5rem;
					font-size: clamp(0.9rem, 2.2vw, 1.1rem);
				}
			}
		}
	}
}

// Project wrapper container - matching Substack layout
.project-wrapper {
	width: 100%;
	margin: 0 auto;
	min-height: auto;
	box-sizing: border-box;
	display: flex;
	flex-direction: column;
	justify-content: start;
	align-items: center;
	padding: 0 24px;
	position: relative;
	overflow: visible;
	flex: 1;

	@media (max-width: variables.$tablet-breakpoint) {
		padding: 0 20px;
		flex-direction: column;
	}

	@media (max-width: variables.$mobile-breakpoint) {
		padding: 0 16px;
		position: relative;
		display: flex;
		flex-direction: column;

		.dynamic-back-button {
			position: absolute;
			top: 24px;
			left: 24px;
			border-radius: 12px;
		}
	}
}

// Project pages - remove conflicting borders
// The border styles are now handled in theme mode files
body .project-edge-wrapper {
	.blog-content {
		// Desktop/tablet: Only structural styles, no borders
		@media (min-width: calc(variables.$mobile-breakpoint + 1px)) {
			// Top-left border radius to match the top/left borders
			border-radius: 12px 0 0 0;
			margin: 12px;
			background: variables.$white;
			height: auto; // Override default blog-content height
			overflow: visible; // Override default overflow
			
			@media (prefers-color-scheme: dark) {
				background: rgb(9, 9, 9);
			}
		}
	}
}


// Ensure short articles take full viewport height when loaded
body.loaded .project-wrapper {
	min-height: 100dvh;
}

// Override for .project-wrapper when dynamically loaded into .blog-content on mobile
.blog-content > .project-wrapper {
	@media (max-width: variables.$mobile-breakpoint) {
		position: relative;
		height: auto;
		max-height: none;
		padding-top: 0; // Reset padding-top that interferes with project layout
		margin-top: 0; // Reset margin-top that interferes with project layout
		inset: auto;

		// On mobile, content should expand naturally - no container scrolling
		overflow: visible;
	}

	// General scrollability for dynamically loaded content on larger screens
	@media (width >=calc(variables.$mobile-breakpoint + 1px)) {
		overflow: auto;
		min-height: 100dvh; // Or adjust as needed for desktop/tablet
		height: 100%; // Ensure it takes full height of parent container
		max-height: none;
		margin-top: 0; // Reset margin-top that interferes with project layout
		padding-top: 0; // Reset padding-top that interferes with project layout
	}
}

// Project back link container
.project-back-link-container {
	max-width: var(--project-max-width, 1200px);
	margin: 1.5rem auto 0.5rem;
	padding: 0 var(--project-padding, 1.5rem);

	a {
		color: variables.$link-color;
		text-decoration: none;
		font-size: 0.9rem;
		display: inline-flex;
		align-items: center;
		transition: variables.$transition-standard;

		&:hover {
			color: variables.$hover-color;
			transform: translateX(-3px);
		}
	}
}

// Project Variables - Updated to match Substack typography
:root {
	// Layout - matching Substack's max-width
	--project-max-width: 680px;
	--project-padding: 24px;
	--section-spacing: 32px;

	// Typography - matching Substack sizing
	--heading-xl: 32px; // Match post title
	--heading-lg: 28px; // Match h1
	--heading-md: 24px; // Match h2
	--heading-sm: 20px; // Match h3
	--text-lg: 18px; // Match h4
	--text-md: 16px; // Match base font
	--text-sm: 14px; // Match smaller text
	--text-xs: 13px; // Match metadata

	// Animation
	--transition-fast: 0.2s ease;
	--transition-medium: 0.4s ease;
	--transition-slow: 0.6s ease;

	// Parachute Animation
	--parachute-duration: 8s;
	--parachute-delay: 2.5s;
	--parachute-size: 5rem;
	--parachute-path-height: 150dvh;
	--swing-amount: 30px;
}

// Project Base
.project-page {

	html,
	body {
		overflow: auto;
	}

	@media (max-width: variables.$mobile-breakpoint) {

		html,
		body {
			overflow: auto;
			-webkit-overflow-scrolling: touch;
		}
	}
}

.container {
	max-width: min(100vw, 65ch);
	margin: 0 auto;
	padding: 0 variables.$space-md;
}

// Project Header
.project-header {
	min-height: 90dvh;
	display: flex;
	align-items: center;
	background: variables.$card-bg;
	border-bottom: none;
	margin-bottom: 0;
	padding: 0;
	position: relative;

	.container {
		max-width: var(--project-max-width);
		margin: 0 auto;
		padding: 0 var(--project-padding);
		width: 100%;
	}

	.company-byline {
		font-size: var(--text-sm);
		font-weight: var(--font-weight-semibold);
		text-transform: uppercase;
		letter-spacing: 0.1em;
		color: variables.$text-color-secondary;
		margin-bottom: 1.5rem;
		opacity: 0.8;
	}

	.project-title {
		font-size: var(--heading-xl);
		margin: 0 0 1.5rem;
		line-height: var(--line-height-tight).2;
		max-width: 100%;
		font-weight: var(--font-weight-bold);
		color: variables.$text-color;
		letter-spacing: -0.02em;
		position: relative;
		z-index: 2;
		
		@media (prefers-color-scheme: dark) {
			color: variables.$text-color-dark;
		}
	}

	.project-byline {
		font-size: var(--text-md);
		color: variables.$text-color-secondary;
		margin: 0 0 24px;
		line-height: var(--line-height-tight).7;
		max-width: 100%;
		font-weight: var(--font-weight-normal);
		
		@media (prefers-color-scheme: dark) {
			color: variables.$text-color-secondary-dark;
		}
	}
}

// Project Title styling - matching Substack
.project-title {
	margin: 40px 0 24px;
	padding: 0;
	border-radius: 0;
	color: variables.$text-color;
	border: none;
	text-align: left;
	transition: background-color 0.3s ease;

	.project-category {
		font-size: var(--font-size-sm);
		text-transform: uppercase;
		letter-spacing: 0.05em;
		font-weight: var(--font-weight-semibold);
		color: variables.$text-color-secondary;
		margin-bottom: 8px;
		display: block;
		
		@media (prefers-color-scheme: dark) {
			color: variables.$text-color-secondary-dark;
		}
	}

	h2 {
		margin: 0 0 16px 0;
		font-size: 32px;
		font-weight: var(--font-weight-bold);
		line-height: var(--line-height-tight).2;
		border: none;
		letter-spacing: -0.02em;
		color: variables.$text-color;
		max-width: 100%;

		@media (prefers-color-scheme: dark) {
			color: variables.$text-color-dark;
		}

		// Mobile styles
		@media (width <=768px) {
			font-size: 28px;
		}

		// Small mobile screens
		@media (width <=480px) {
			font-size: var(--font-size-2xl);
		}
	}

	.metadata {
		margin-top: 1rem;
		padding: 1rem;
		background: rgb(0 0 0 / 2%);
		border-radius: 8px;
		border: 1px solid rgb(0 0 0 / 5%);

		.metadata-list {
			display: flex;
			flex-wrap: wrap;
			gap: 1rem;
		}

		.metadata-item {
			display: flex;
			flex-direction: column;
			gap: 2px;
		}
	}

	// Dark mode adjustments
	@media (prefers-color-scheme: dark) {
		color: variables.$text-color-dark;

		.project-category {
			color: variables.$text-color-secondary-dark;
		}

		h2 {
			color: #fff;
		}

		.metadata {
			background: rgb(255 255 255 / 5%);
			border-color: rgb(255 255 255 / 10%);
		}
	}
}

.intro-section {
	margin: 32px 0;
	display: flex;
	align-items: center;
	justify-content: flex-start;
	background: transparent;
	padding: 0;
	text-align: left;
	border-radius: 0;

	.container {
		max-width: 680px;
		margin: 0;
	}

	.intro-text {
		font-size: var(--font-size-base);
		line-height: var(--line-height-tight).7;
		color: variables.$text-color;
		margin-bottom: 20px;
		max-width: 100%;
		font-weight: var(--font-weight-normal);
		
		@media (prefers-color-scheme: dark) {
			color: variables.$text-color-dark;
		}
	}

	.button-group {
		display: flex;
		gap: 16px;
		justify-content: flex-start;
		align-items: center;
	}
}

// Generic Button Styles
.app-store-button {
	display: inline-flex;
	align-items: center;
	margin-left: 1.5rem;
	transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);

	img {
		height: 44px;
		width: auto;
		display: block;
	}

	&:hover {
		transform: translateY(-2px);
		opacity: 0.8;
	}

	@media (prefers-color-scheme: dark) {
		img {
			filter: invert(1) brightness(2);
		}
	}
}

// Floating TL;DR Button
.floating-tldr {
	position: absolute;
	bottom: 2rem;
	right: 2rem;
	z-index: 100;
	opacity: 0;
	transform: translateY(20px);
	transition: all 0.3s ease;
	pointer-events: none;

	&.visible {
		opacity: 1;
		transform: translateY(0);
		pointer-events: auto;
	}

	button {
		background: variables.$card-bg;
		border: 1px solid variables.$border-color;
		border-radius: 2rem;
		padding: 0.75rem 1.25rem;
		display: flex;
		align-items: center;
		gap: 0.5rem;
		color: variables.$text-color;
		font-size: var(--text-md);
		font-weight: var(--font-weight-medium);
		cursor: pointer;
		transition: all 0.2s ease;
		box-shadow: 0 2px 4px rgb(0 0 0 / 10%);

		svg {
			width: 20px;
			height: 20px;
		}

		&:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 6px rgb(0 0 0 / 10%);
		}
	}
}

// Dark Mode Adjustments for floating button
@media (prefers-color-scheme: dark) {
	.floating-tldr button {
		background: variables.$card-bg-dark;
		border-color: variables.$border-color-dark;
		color: variables.$text-color-dark;
	}
}

// Generic Animation Keyframes
@keyframes bounce-fade {

	0%,
	20%,
	50%,
	80% {
		transform: translateX(-50%) translateY(0);
		opacity: 0.5;
	}

	40% {
		transform: translateX(-50%) translateY(-20px);
		opacity: 0.5;
	}

	60% {
		transform: translateX(-50%) translateY(-10px);
		opacity: 0.5;
	}

	90%,
	100% {
		transform: translateX(-50%) translateY(0);
		opacity: 0;
	}
}

// Responsive Design
@media (max-width: variables.$tablet-breakpoint) {
	.project-header {
		min-height: 90dvh;
		padding: 0;

		.project-title {
			font-size: var(--heading-lg);
		}

		.project-byline {
			font-size: var(--text-md);
		}
	}
}

// Responsive styles
@media (max-width: variables.$mobile-breakpoint) {
	.project-back-link-container {
		padding: 0 1rem;
		margin-top: 1rem;
	}
}

// Dark Mode Styles
@media (prefers-color-scheme: dark) {
	.project-header {
		background: variables.$card-bg-dark;
		border-color: variables.$border-color-dark;

		.project-title {
			color: variables.$text-color-dark;
		}

		.project-byline {
			color: variables.$text-color-secondary-dark;
		}
	}
}

// Project Gallery
.project-gallery {
	width: 100%;
	margin-bottom: 2rem;
	display: flex;
	flex-direction: column;
	position: relative;

	.carousel {
		width: 100%;
		margin: 0 auto;
		border-radius: 12px 12px 0 0;
		background: variables.$black;
		border: none;
		position: relative;
		z-index: 1;
		display: flex;
		align-items: center;
		justify-content: center;
		overflow: hidden;
		aspect-ratio: 16 / 9;

		// No explicit height or min-height
		// Fallback for browsers without aspect-ratio handled in _carousel.scss
	}
}

.project-content {
	width: 100%;
	height: auto;
	margin-left: auto;
	margin-right: auto;
	background: transparent;
	box-shadow: none;
	border: none;
	border-radius: 12px 12px 0 0;
	overflow: visible;
	transition: box-shadow 0.3s ease;
	display: flex;
	flex-direction: column;
	
	// Dark mode background - transparent on mobile to inherit from parent
	@media (prefers-color-scheme: dark) {
		@media (min-width: calc(variables.$mobile-breakpoint + 1px)) {
			background-color: rgb(9, 9, 9);
		}
		
		@media (max-width: variables.$mobile-breakpoint) {
			background-color: transparent;
		}
	}

	// Add consistent typography for lists - matching Substack
	ul,
	ol {
		font-size: var(--font-size-base);
		line-height: var(--line-height-tight).7;
		margin: 20px 0;
		padding-left: 30px;
		color: variables.$text-color;

		li {
			margin-bottom: 8px;
			font-size: inherit;
			line-height: inherit;

			&:last-child {
				margin-bottom: 0;
			}

			// Nested lists should maintain the same size
			ul,
			ol {
				margin-top: 8px;
				margin-bottom: 0;
			}
		}
	}

	@media (prefers-color-scheme: dark) {

		ul,
		ol {
			color: variables.$text-color-dark;
		}
	}

	@media (max-width: variables.$tablet-breakpoint) {
		width: 100%;
		max-width: none;
		margin-left: 0;
		overflow: visible;
	}

	@media (max-width: variables.$mobile-breakpoint) {
		height: auto;
		min-height: 0;
		flex: 1;
		margin-bottom: env(safe-area-inset-bottom, 0);
		display: flex;
		flex-direction: column;
		box-shadow: none;
		overflow: visible;
	}

	.project-details {
		padding: 16px 16px 0;
		padding-bottom: 0;
		scrollbar-width: thin;
		scrollbar-color: rgb(0 0 0 / 20%) rgb(0 0 0 / 5%);

		@media (max-width: variables.$tablet-breakpoint) {
			height: auto;
			overflow: visible;
			padding-bottom: 3rem;
		}

		.project-gallery-section {
			margin-left: 18px;
			margin-right: 18px;
		}

		@media (max-width: variables.$mobile-breakpoint) {
			padding: 0;
			padding-bottom: calc(1rem + env(safe-area-inset-bottom, 0px));
			height: auto;
			overflow: visible;
			flex: none;

			.project-title,
			.project-description {
				padding-left: 9px;
				padding-right: 9px;
			}
		}

		&::-webkit-scrollbar {
			width: 8px;
		}

		&::-webkit-scrollbar-track {
			background: rgb(0 0 0 / 5%);
			border-radius: 4px;
		}

		&::-webkit-scrollbar-thumb {
			background-color: rgb(0 0 0 / 20%);
			border-radius: 4px;
		}
	}

	@media (prefers-color-scheme: dark) {
		// Removed background color - handled elsewhere
		box-shadow: 0 2px 15px rgb(0 0 0 / 15%),
			0 0 0 1px rgb(255 255 255 / 10%);

		/* &:hover {
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3),
				0 0 0 1px rgba(255, 255, 255, 0.15);
		} */

		.project-details {
			scrollbar-color: rgb(255 255 255 / 20%) rgb(255 255 255 / 5%);

			&::-webkit-scrollbar-track {
				background: rgb(255 255 255 / 5%);
			}

			&::-webkit-scrollbar-thumb {
				background-color: rgb(255 255 255 / 20%);
			}
		}

		@media (width >=calc(variables.$mobile-breakpoint + 1px)) {
			background-color: transparent;
			box-shadow: none;
		}

		@media (max-width: variables.$mobile-breakpoint) {
			box-shadow: none;
		}
	}
}

@media (prefers-color-scheme: dark) {
	.project-gallery {
		.project-content {
			.carousel {
				background: variables.$card-bg-dark;

				.carousel-button {
					background: rgb(0 0 0 / 70%);
					color: white;

					&:hover {
						background: rgb(0 0 0 / 90%);
					}
				}

				.carousel-indicators {
					.indicator {
						background: rgb(255 255 255 / 30%);

						&.active {
							background: white;
						}
					}
				}
			}

			.project-details {
				.metadata {
					background: rgb(255 255 255 / 5%);
					border-color: rgb(255 255 255 / 10%);

					&:hover {
						background: rgb(255 255 255 / 8%);
					}

					.metadata-item {
						.label {
							color: variables.$text-color-secondary-dark;
						}

						.value {
							color: variables.$text-color-dark;
						}
					}
				}

				// Dark mode styles handled by main .project-description rules
			}
		}
	}
}

// Project description typography matching Substack
.project-description {
	font-size: var(--font-size-base);
	line-height: var(--line-height-tight).7;
	color: variables.$text-color;
	margin: 0 auto;
	padding: 0 24px;

	@media (prefers-color-scheme: dark) {
		color: variables.$text-color-dark;
	}

	// Apply max-width to text elements
	p,
	h1, h2, h3, h4, h5, h6,
	blockquote,
	ul, ol,
	pre {
		max-width: 720px;
		margin-left: auto;
		margin-right: auto;
	}

	p {
		margin: 20px 0;
		font-size: var(--font-size-base);
		line-height: var(--line-height-tight).7;
	}

	h1, h2, h3, h4, h5, h6 {
		font-family: var(--font-sans);
		font-weight: var(--font-weight-semibold);
		margin-top: 32px;
		margin-bottom: 16px;
		color: variables.$text-color;
		
		@media (prefers-color-scheme: dark) {
			color: variables.$text-color-dark;
		}
	}

	h1 { font-size: 28px; }
	h2 { font-size: var(--font-size-2xl); }
	h3 { font-size: var(--font-size-xl); }
	h4 { font-size: var(--font-size-lg); }

	blockquote {
		margin: 24px 0;
		padding-left: 20px;
		border-left: 3px solid variables.$border-color;
		font-style: italic;
		color: variables.$text-color-secondary;

		@media (prefers-color-scheme: dark) {
			border-left-color: variables.$border-color-dark;
			color: variables.$text-color-secondary-dark;
		}
	}
	
	// Allow tables to expand beyond text width
	table,
	.table-wrapper {
		max-width: 100%;
		margin-left: auto;
		margin-right: auto;
	}
	
	// Images - default behavior is to follow text width
	img {
		max-width: 720px;
		height: auto;
		margin: 20px auto;
		display: block;
		border-radius: 4px;
		
		// Full-width images with a special class
		&.full-width {
			max-width: 100%;
		}
	}

	a {
		color: variables.$link-color;
		text-decoration: underline;
		text-decoration-color: rgba(variables.$link-color, 0.3);
		transition: text-decoration-color 0.2s ease;
		border-bottom: none;

		&:hover {
			text-decoration-color: rgba(variables.$link-color, 1);
		}

		@media (prefers-color-scheme: dark) {
			color: variables.$link-color-dark;
			text-decoration-color: rgba(variables.$link-color-dark, 0.3);

			&:hover {
				text-decoration-color: rgba(variables.$link-color-dark, 1);
			}
		}
	}

	code {
		background-color: variables.$card-bg;
		padding: 2px 6px;
		border-radius: 3px;
		font-size: 0.85em;

		@media (prefers-color-scheme: dark) {
			background-color: variables.$card-bg-dark;
		}
	}

	pre {
		background-color: variables.$card-bg;
		padding: 16px;
		border-radius: 6px;
		overflow-x: auto;
		margin: 24px 0;

		@media (prefers-color-scheme: dark) {
			background-color: variables.$card-bg-dark;
		}

		code {
			background: none;
			padding: 0;
			font-size: var(--font-size-sm);
		}
	}

	ul, ol {
		margin: 20px 0;
		padding-left: 30px;

		li {
			margin-bottom: 8px;
			line-height: var(--line-height-tight).7;
		}
	}
	
	// Mobile overrides for text max-width  
	@media (max-width: variables.$mobile-breakpoint) {
		// Override max-width for all text elements on mobile
		p,
		h1, h2, h3, h4, h5, h6,
		blockquote,
		ul, ol,
		pre,
		img {
			max-width: 100%;
		}
	}
}

// Parachute Animation Styles
.parachute-container {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: var(--parachute-path-height);
	pointer-events: none;
	overflow: hidden;
}

.parachute-box {
	position: absolute;
	top: -50px;
	font-size: var(--parachute-size);
	animation: parachute-fall var(--parachute-duration) cubic-bezier(0.45, 0, 0.55, 1) forwards;
	opacity: 0;

	&:nth-child(1) {
		left: 20%;
		animation-delay: calc(var(--parachute-delay) + 0s);
	}

	&:nth-child(2) {
		left: 40%;
		animation-delay: calc(var(--parachute-delay) + 0.5s);
	}

	&:nth-child(3) {
		left: 60%;
		animation-delay: calc(var(--parachute-delay) + 1s);
	}

	&:nth-child(4) {
		left: 80%;
		animation-delay: calc(var(--parachute-delay) + 1.5s);
	}
}

@keyframes parachute-fall {
	0% {
		transform: translateY(0) translateX(0);
		opacity: 0;
	}

	10% {
		opacity: 1;
	}

	100% {
		transform: translateY(calc(var(--parachute-path-height) - var(--parachute-size))) translateX(calc(var(--swing-amount) * -1));
		opacity: 0;
	}
}

// Add swinging motion
@keyframes parachute-swing {

	0%,
	100% {
		transform: translateX(0);
	}

	50% {
		transform: translateX(var(--swing-amount));
	}
}

// Project navigation element - styled to match dynamic-back-button
.project-navigation {
	position: absolute;
	top: 6px;
	left: 6px;
	z-index: 1000;
	width: auto;
	max-width: none;
	margin: 0;
	pointer-events: auto;

	@media (max-width: variables.$mobile-breakpoint) {
		// Fix mobile positioning - place inside content area instead of absolute positioning
		position: relative;
		top: auto;
		left: auto;
		padding: 1rem 1rem 0 1rem;
		margin: 0;
	}

	.project-mini-bio {
		pointer-events: auto;
	}
}

// Project mini bio - simplified to match dynamic-back-button
.project-mini-bio {
	background-color: transparent !important;
	box-shadow: none;
	border: none;
	padding: 0 !important;
	margin: 0;
	place-items: center start;
	display: flex;
	align-items: center;

	@media (max-width: variables.$tablet-breakpoint) {
		// padding: 24px 24px 0;
	}

	@media (max-width: variables.$mobile-breakpoint) {
		// padding: 16px;
	}

	.project-mini-bio-image {
		display: none; // Hide bio image to match dynamic button simplicity
	}

	.project-mini-bio-content {
		display: none; // Hide bio content to match dynamic button simplicity
	}

	.project-mini-bio-name {
		display: none; // Hide name to match dynamic button simplicity
	}

	.project-mini-bio-text {
		display: none; // Hide text to match dynamic button simplicity
	}

	.button-stack {
		display: flex;
		flex-direction: row;
		gap: 0;
		margin: 0;
	}

	.project-home-button {
		// Match dynamic-back-button styling exactly
		border-radius: 12px;
		box-shadow: none;
		background-color: black;
		color: white;

		// Keep existing functionality styles
		display: flex;
		align-items: center;
		gap: 0;
		padding: 4px 10px;
		font-size: var(--font-size-xs);
		font-weight: var(--font-weight-medium);
		border: none;
		transition: all 0.2s ease;
		cursor: pointer;
		flex-shrink: 0;
		width: auto;
		text-decoration: none;

		svg {
			width: 16px;
			height: 16px;
			margin-right: 6px;
			transition: transform 0.3s ease;
			flex-shrink: 0;
		}

		span {
			line-height: var(--line-height-normal);
		}

		&:hover {
			background-color: rgb(0 0 0 / 80%);
			color: white;
		}

		&:active {
			background-color: rgb(0 0 0 / 90%);
		}

		&:focus {
			outline: 2px solid var(--focus-ring-color, Highlight);
			outline-offset: 2px;
		}
	}

	.project-collapse-button {
		display: none; // Hide collapse button to match dynamic button simplicity
	}

	&.collapsed {
		max-width: fit-content;
		transition: max-width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
			transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
			opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);

		.project-mini-bio-content {
			opacity: 0;
			transform: translateY(-10px);
			height: 0;
			margin: 0;
			padding: 0;
			overflow: hidden;
			width: 0;
		}

		.project-mini-bio-image {
			opacity: 0;
			transform: translateY(-10px);
			height: 0;
			margin: 0;
			padding: 0;
			overflow: hidden;
			width: 0;
		}

		.project-home-button {
			padding: 4px;
			width: 24px;
			height: 24px;
			display: flex;
			align-items: center;
			justify-content: center;

			span {
				display: none;
			}

			svg {
				margin: 0;
			}
		}

		.project-collapse-button {
			padding: 4px;
			width: 24px;
			height: 24px;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0;
			gap: 0;

			span {
				display: none;
			}

			svg {
				margin: 0;
				transform: rotate(180deg);
			}
		}
	}

	.project-mini-bio-content,
	.project-mini-bio-image,
	.button-stack {
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	}

	// Dark mode styles to match dynamic-back-button
	@media (prefers-color-scheme: dark) {
		.project-home-button {
			background-color: white;
			color: black;

			&:hover {
				background-color: rgb(255 255 255 / 80%);
				color: black;
			}

			&:active {
				background-color: rgb(255 255 255 / 90%);
			}
		}
	}

	@media (max-width: variables.$mobile-breakpoint) {
		.project-home-button {
			margin-left: 0;
			width: auto;
			justify-content: center;
		}
	}
}

// Remove hover effects from figure images using high specificity
figure {
	img, video {
		transition: none;
		transform: none;
		
		&:hover {
			transition: none;
			transform: none;
			cursor: default;
		}
	}
}

// Pull quote variant (featured highlight)
blockquote.pullquote {
	font-size: var(--font-size-2xl);
	line-height: var(--line-height-tight).4;
	text-align: center;
	border: 1px solid rgba(255, 255, 255, 0.1);
	background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
	padding: 2.25rem 1.75rem;
	margin: 2.25rem 0;
	border-radius: 16px;
	color: #ffffff;
	font-weight: var(--font-weight-medium);
	font-style: normal;
	position: relative;
	
	&::before {
		display: none;
	}
	
	@media (prefers-color-scheme: light) {
		background: linear-gradient(135deg, #f5f5f5 0%, #e5e5e5 100%);
		color: #1a1a1a;
		border-color: rgba(0, 0, 0, 0.1);
	}
}

// Shared content area mixin for posts and projects
@mixin content-area-styles {
	line-height: var(--line-height-tight).7;
	font-size: 1.1em;
	color: variables.$text-color;
	background: variables.$white;
	box-shadow: 0 2px 10px rgb(0 0 0 / 5%);
	border-radius: 16px;
	border: 1px solid rgb(0 0 0 / 3%);
	margin: 0 16px 24px;
	max-width: 800px;
	padding: 32px;
	box-sizing: border-box;

	img,
	video,
	iframe {
		max-width: 100%;
		height: auto;
		margin-top: 20px;
		margin-bottom: 20px;
		border-radius: 8px;
	}

	// Table styles
	.table-wrapper {
		margin: 24px 0;
		position: relative;
		border-radius: 12px;
		box-shadow: 0 1px 3px rgb(0 0 0 / 5%);
		overflow: hidden; // Contain the scroll container
		
		// Optional caption
		.table-caption {
			font-size: 0.9em;
			color: variables.$text-color-secondary;
			margin-bottom: 12px;
			font-weight: var(--font-weight-medium);
			text-align: center;
			padding: 0 16px;
			line-height: var(--line-height-normal);
			
			// Tighter line-height on mobile for better spacing
			@media (max-width: variables.$mobile-breakpoint) {
				line-height: var(--line-height-tight);
			}
		}
		
		// Table scroll container
		.table-scroll-container {
			overflow-x: auto;
			overflow-y: visible; // Don't clip vertically
			-webkit-overflow-scrolling: touch;
			overscroll-behavior-x: contain;
			position: relative;
			width: 100%;
			max-width: 100%;
			
			// Scroll indicators
			&::before,
			&::after {
				content: '';
				position: absolute;
				top: 0;
				bottom: 0;
				width: 20px;
				pointer-events: none;
				z-index: 1;
				opacity: 0;
				transition: opacity 0.3s ease;
			}
			
			&::before {
				left: 0;
				background: linear-gradient(to right, variables.$white 0%, transparent 100%);
			}
			
			&::after {
				right: 0;
				background: linear-gradient(to left, variables.$white 0%, transparent 100%);
			}
			
			// Show indicators when scrollable
			&.has-scroll {
				&::after {
					opacity: 1;
				}
				
				&.scrolled::before {
					opacity: 1;
				}
				
				&.at-end::after {
					opacity: 0;
				}
			}
			
			// Focus state for keyboard navigation
			&:focus {
				outline: 2px solid variables.$accent-gold;
				outline-offset: 2px;
				border-radius: 12px;
				
				@media (prefers-color-scheme: dark) {
					outline-color: variables.$accent-gold-dark;
				}
			}
			
			// Touch scrolling indicator
			&.touch-scrolling::before,
			&.touch-scrolling::after {
				opacity: 0.8 !important;
			}
			
			// Focused state - enhance scroll indicators
			&.focused.has-scroll {
				&::before,
				&::after {
					height: 3px;
					bottom: 0;
					top: auto;
					background: variables.$accent-gold;
					opacity: 0.6;
				}
				
				@media (prefers-color-scheme: dark) {
					&::before,
					&::after {
						background: variables.$accent-gold-dark;
					}
				}
			}
		}
		
		// Ensure tables inside scroll containers maintain their layout
		.table-scroll-container table {
			width: auto; // Let table size based on content
			min-width: 100%; // But ensure it fills container if content is smaller
		}
		
		// Skills matrix specific styling
		&.skills-matrix {
			.table-scroll-container {
				// Only apply sticky positioning on larger screens
				@media (min-width: variables.$tablet-breakpoint) {
					table {
						th:first-child,
						td:first-child {
							position: sticky;
							left: 0;
							z-index: 2;
							background: variables.$white;
							box-shadow: 2px 0 4px rgb(0 0 0 / 5%);
							
							@media (prefers-color-scheme: dark) {
								background: variables.$card-bg-dark;
							}
						}
						
						th:first-child {
							z-index: 3;
							background: rgba(variables.$accent-gold, 0.05);
							
							@media (prefers-color-scheme: dark) {
								background: rgba(variables.$accent-gold-dark, 0.1);
							}
						}
					}
				}
				
				table {
					th:first-child {
						width: 30%;
						min-width: 120px;
						text-align: left;
					}
				}
			}
		}
		
		@media (prefers-color-scheme: dark) {
			box-shadow: 0 1px 3px rgb(0 0 0 / 10%);
			
			.table-caption {
				color: variables.$text-color-secondary-dark;
			}
			
			.table-scroll-container {
				&::before {
					background: linear-gradient(to right, variables.$card-bg-dark 0%, transparent 100%);
				}
				
				&::after {
					background: linear-gradient(to left, variables.$card-bg-dark 0%, transparent 100%);
				}
			}
		}
		
		// Mobile optimizations
		@media (max-width: variables.$mobile-breakpoint) {
			margin: 16px -16px; // Extend to edge of container
			border-radius: 0;
			
			.table-caption {
				font-size: 0.85em;
				margin-bottom: 8px;
			}
		}
	}
	
	// Handle standalone tables (not wrapped)
	.project-description > table {
		max-width: 100%;
		margin-left: auto;
		margin-right: auto;
	}
	
	table {
		border-collapse: collapse;
		background: variables.$white;
		border: 1px solid rgba(variables.$border-color, 0.3);
		border-radius: 8px;
		overflow: hidden;
		font-size: 0.95em;
		display: table; // Ensure proper table display
		width: 100%; // Always fill container
		table-layout: auto; // Allow automatic column sizing based on content
		
		// For consistent column widths across all cells
		// The browser will calculate optimal widths based on all content
		word-break: break-word; // Allow breaking long words if needed
		
		thead {
			background: rgba(variables.$accent-gold, 0.05);
			border-bottom: 2px solid rgba(variables.$accent-gold, 0.2);
		}
		
		th {
			padding: 12px 16px;
			text-align: center;
			font-weight: var(--font-weight-semibold);
			color: variables.$text-color;
			letter-spacing: 0.02em;
			white-space: normal;
			word-wrap: break-word;
			overflow-wrap: break-word;
			min-width: min-content; // Ensure minimum width based on content
			
			// Mobile adjustments
			@media (max-width: variables.$mobile-breakpoint) {
				padding: 10px 12px;
				font-size: 0.85em;
				white-space: normal; // Allow wrapping on mobile
				word-break: break-word;
			}
		}
		
		td {
			padding: 12px 16px;
			text-align: center;
			color: variables.$text-color;
			border-bottom: 1px solid rgba(variables.$border-color, 0.2);
			white-space: normal; // Allow wrapping
			word-wrap: break-word;
			overflow-wrap: break-word;
			
			// Support for bold text
			strong {
				font-weight: var(--font-weight-semibold);
				color: variables.$text-color;
			}
			
			// Mobile adjustments
			@media (max-width: variables.$mobile-breakpoint) {
				padding: 10px 12px;
				font-size: 0.9em;
				white-space: normal; // Override the nowrap to allow wrapping on mobile
				word-break: break-word;
				hyphens: auto;
			}
		}
		
		// First column adjustments for skills matrix
		.skills-matrix & {
			td:first-child,
			th:first-child {
				text-align: left;
				font-weight: var(--font-weight-semibold);
			}
		}
		
		tbody tr {
			transition: background-color 0.2s ease;
			
			&:hover {
				background: rgba(variables.$accent-gold, 0.02);
			}
			
			&:last-child td {
				border-bottom: none;
			}
		}
		
		// Zebra striping
		tbody tr:nth-child(even) {
			background: rgba(variables.$grey-light, 0.05);
		}
		
		// Responsive font sizing with zoom support
		@media (max-width: variables.$tablet-breakpoint) {
			font-size: 0.9em;
		}
		
		@media (max-width: variables.$mobile-breakpoint) {
			font-size: 0.85em;
			// Allow table to scroll horizontally if needed
			display: block;
			overflow-x: auto;
			white-space: nowrap;
		}
		
		// Support for browser zoom
		@media (min-resolution: 2dppx) {
			// Slightly larger fonts for high DPI displays
			font-size: 1em;
			
			@media (max-width: variables.$mobile-breakpoint) {
				font-size: 0.9em;
			}
		}
		
		// Dark mode styles for tables
		@media (prefers-color-scheme: dark) {
			background: variables.$card-bg-dark;
			border-color: rgba(variables.$border-color-dark, 0.3);
			
			thead {
				background: rgba(variables.$accent-gold-dark, 0.1);
				border-bottom-color: rgba(variables.$accent-gold-dark, 0.3);
			}
			
			th {
				color: variables.$text-color-dark;
			}
			
			td {
				color: variables.$text-color-dark;
				border-bottom-color: rgba(variables.$border-color-dark, 0.2);
				
				strong {
					color: variables.$text-color-dark;
				}
			}
			
			tbody tr {
				&:hover {
					background: rgba(variables.$accent-gold-dark, 0.05);
				}
			}
			
			tbody tr:nth-child(even) {
				background: rgba(255, 255, 255, 0.02);
			}
			
			// Sticky column backgrounds in dark mode
			.skills-matrix & {
				td:first-child,
				th:first-child {
					background: variables.$card-bg-dark;
				}
			}
		}
	}

	@media (prefers-color-scheme: dark) {
		background: variables.$card-bg-dark;
		color: variables.$text-color-dark;
		box-shadow: 0 2px 10px rgb(0 0 0 / 20%);
		border-color: variables.$border-color-dark;
	}
}


// Rule moved from project_gallery.ejs for better separation of concerns
// Hides project navigation when the project is dynamically loaded.
.project-wrapper.dynamic-loaded .project-navigation {
	display: none !important;
}

// Also hide project navigation when inside project-edge-wrapper and dynamically loaded
.blog-content .project-edge-wrapper .project-navigation {
	display: none !important;
}

// Blog content specific above-fold-content-wrapper styles
.blog-content .project-edge-wrapper .above-fold-content-wrapper {
	max-width: 1200px;
	margin-left: auto;
	margin-right: auto;
	flex-direction: row;
	justify-content: space-between;
	align-items: stretch; // Ensure children fill height
	gap: 2rem; // Add gap between project-title and project-info-wrapper
	
	// When content gets too close, switch to column
	@media (max-width: 1000px) {
		flex-direction: column;
		justify-content: flex-end;
		align-items: flex-start;
		gap: 1rem; // Smaller gap on smaller screens
	}
	
	// Ensure responsive behavior on mobile
	@media (max-width: variables.$mobile-breakpoint) {
		flex-direction: column;
		justify-content: flex-end;
	}
	
	// Project title specific styles for blog content
	.project-title {
		// On larger screens, use flex to spread content vertically
		@media (min-width: 1001px) {
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			height: 100%;
			
			// Read story button container - remove margin on larger screens
			.read-story-button-container {
				margin: 0;
				// Don't use margin-top: auto here as gap handles spacing
			}
		}
	}
}

// Project info wrapper - contains byline and stats in column layout
.project-info-wrapper {
	display: flex;
	flex-direction: column;
	gap: 0.5rem; // Tighter gap between byline and stats
	align-items: flex-start;
	justify-content: flex-end; // Bottom align the content
	margin-top: auto; // Push to bottom of flex container
	
	// Within blog content, align to the right
	.blog-content .project-edge-wrapper & {
		align-items: flex-end;
		
		.project-byline {
			font-size: var(--font-size-md);
			text-align: right;
			max-width: 450px;
			color: white;
			text-shadow: none; // Remove text shadow in blog context
			
			@media (prefers-color-scheme: dark) {
				color: white;
			}
		}
		
		.project-impact-stats {
			justify-content: flex-end;
		}
		
		// When switching to column layout
		@media (max-width: 1000px) {
			align-items: flex-start;
			width: 100%;
			
			.project-byline {
				text-align: left;
				margin: 0 0 12px 0;
			}
			
			.project-impact-stats {
				justify-content: flex-start;
				width: 100%;
			}
		}
		
		// On mobile, align back to left
		@media (max-width: variables.$mobile-breakpoint) {
			align-items: flex-start;
			width: 100%;
			
			.project-byline {
				text-align: left;
				margin: 0 0 12px 0;
			}
			
			.project-impact-stats {
				justify-content: flex-start;
				width: 100%;
			}
		}
	}
}

// Ensure dynamically loaded project wrapper has proper height
.project-wrapper.dynamic-loaded {
	// No display: flex, no flex-direction, no height/min-height/overflow overrides
}

// Ensure project wrapper has full height when body is loaded
body.loaded .project-wrapper {
	height: 100%;
}

// Mobile-specific styles for 768px breakpoint
@media (width <=768px) {

	.project-wrapper,
	.project-content,
	.project-details {
		height: auto !important;
		min-height: auto !important;
		overflow: visible !important;
	}

	.project-content {
		// Remove background linear-gradient (already removed above)
	}

	.project-summary {
		margin-left: 18px !important;
		margin-right: 18px !important;

		.summary-navigation {
			padding-top: 0 !important;
			padding-left: 0 !important;
		}
	}

	.project-writeup {
		margin-left: 0;
		margin-right: 0;
		margin-top: 18px !important; // Override the 3rem top margin
	}
}

.project-wrapper.dynamic-loaded .project-gallery {
	margin-bottom: 2rem;
}

// =============================================================================
// EDGE-TO-EDGE PROJECT GALLERY SYSTEM
// =============================================================================

// Main container for edge-to-edge layout
.project-edge-wrapper {
	width: 100%;
	position: relative;
	margin: 0;
	padding: 0;
	border-radius: 12px 0 0 0;
	overflow-x: hidden; // Prevent horizontal overflow from child elements
	
	// Dark mode background
	@media (prefers-color-scheme: dark) {
		background-color: rgb(9, 9, 9);
	}
}

// Above the fold preview - 100vh container with Apple TV+ cinematic styling
.above-the-fold-preview {
	height: 100dvh;
	width: 100%;
	position: relative;
	display: flex;
	flex-direction: column;
	background: #000;
	overflow: hidden;
	
	// Background image styling when cover image is present
	background-size: cover;
	background-position: center;
	background-repeat: no-repeat;
}

// Project trailer hero - video background with adjusted height
.project-trailer-hero {
	height: 75dvh;
	width: 100%;
	position: relative;
	z-index: 1;
	min-height: 400px; // Ensure minimum visibility
	background: transparent; // Make transparent to show background image
	
	// Override hidden class when it shouldn't be hidden
	&:not(.hidden) {
		display: block !important;
	}

	.trailer-content {
		width: 100%;
		height: 100%;
		position: relative;
		background: transparent; // Changed from #000 to show background
		overflow: hidden;
		
		// Ensure video/content fills entire background with fade-in
		video, img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			position: absolute;
			top: 0;
			left: 0;
			min-height: 400px; // Ensure minimum visibility for images
			opacity: 0;
			animation: trailerFadeIn 2.5s ease-out 0.5s forwards;
			border-radius: 0;
		}
		
		// Iframes (used for demos) should appear immediately without fade
		iframe {
			width: 100%;
			height: 100%;
			position: absolute;
			top: 0;
			left: 0;
			opacity: 1;
			border-radius: 0;
		}
		
		// Demo inline container takes full space - no fade animation for interactive content
		.demo-inline-container {
			position: relative;
			width: 100%;
			height: 100%;
			opacity: 1;
			// No animation for interactive demos - they should appear immediately
		}
		
		// Empty trailer fallback - ensure minimum height
		.trailer-empty {
			width: 100%;
			height: 100%;
			min-height: 400px;
			display: flex;
			align-items: center;
			justify-content: center;
			background: #f5f5f5;
			
			p {
				color: #666;
				font-size: 1rem;
			}
			
			@media (prefers-color-scheme: dark) {
				background: #1a1a1a;
				
				p {
					color: #999;
				}
			}
		}
	}
}

// Trailer fade-in animation
@keyframes trailerFadeIn {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}

// Above fold content wrapper - bottom aligned with background
.above-fold-content-wrapper {
	height: auto;
	min-height: 25dvh;
	width: 100%;
	position: relative;
	z-index: 10;
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
	align-items: flex-start;
	padding: clamp(2rem, 4dvh, 4rem) 36px 36px 36px;
	box-sizing: border-box;
	text-align: left;
	
	// Dark overlay with blur for text readability
	&::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: linear-gradient(
			180deg,
			rgba(0, 0, 0, 0) 0%,
			rgba(0, 0, 0, 0.4) 30%,
			rgba(0, 0, 0, 0.7) 60%,
			rgba(0, 0, 0, 0.85) 85%,
			rgba(0, 0, 0, 0.95) 100%
		);
		backdrop-filter: blur(10px);
		-webkit-backdrop-filter: blur(10px);
		z-index: -1;
		pointer-events: none; // Ensure it doesn't interfere with content
	}
	
	// Ensure all content is above the overlay
	> * {
		position: relative;
		z-index: 1;
	}
	
	// Responsive adjustments for all sizes
	@media (max-width: 1200px) {
		padding: clamp(1.5rem, 3dvh, 3rem) 32px 32px 32px;
		min-height: 22dvh;
	}
	
	@media (max-width: 768px) {
		padding: clamp(1.5rem, 3dvh, 3rem) 24px 24px 24px;
		min-height: 20dvh;
	}
	
	@media (max-width: 480px) {
		padding: 1.5rem 20px 20px 20px;
		min-height: 18dvh;
	}

	// Ensure project impact stats are always in row direction
	.project-impact-stats {
		display: flex;
		flex-direction: row !important;
	}

	// Very small height adjustments
	@media (max-height: 600px) {
		min-height: 22dvh;
		padding: 15px clamp(0.5rem, 3vw, 2rem) 20px;
		justify-content: flex-start;
	}

	@media (max-height: 500px) {
		min-height: 20dvh;
		padding: 10px clamp(0.5rem, 2vw, 1.5rem) 15px;
		gap: 0.5rem;
	}

	@media (max-height: 400px) {
		min-height: 18dvh;
		padding: 8px clamp(0.5rem, 2vw, 1rem) 12px; // Maintain smaller top vs bottom
		gap: 0.25rem;
	}
}

// When demo is inline, adjust the above-fold content wrapper
body.demo-inline-active .project-edge-wrapper .above-the-fold-preview .above-fold-content-wrapper {
	// Note: Blur overlay is now disabled globally, so no special handling needed
	
	// Reduce padding since demo provides visual interest
	padding: clamp(2rem, 4dvh, 4rem) 36px 36px 36px;
	
	// Adjust responsive padding
	@media (max-width: 1200px) {
		padding: clamp(1.5rem, 3dvh, 3rem) 32px 32px 32px;
	}
	
	@media (max-width: 768px) {
		padding: clamp(1rem, 2dvh, 2rem) 24px 24px 24px;
	}
	
	@media (max-width: 480px) {
		padding: 1.5rem 20px 20px 20px;
	}
	
	// Adjust for very small heights
	@media (max-height: 600px) {
		padding: 15px clamp(0.5rem, 3vw, 2rem) 20px;
	}

	@media (max-height: 500px) {
		padding: 10px clamp(0.5rem, 2vw, 1.5rem) 15px;
	}

	@media (max-height: 400px) {
		padding: 8px clamp(0.5rem, 2vw, 1rem) 12px;
	}
}

// Project title in above-fold content - Apple TV+ style
.above-fold-content-wrapper .project-title {
	margin: 0 0 clamp(2rem, 4vw, 3rem) 0;
	text-align: left;
	max-width: 100%;
	flex: 1; // Make it fill available height
	display: flex;
	flex-direction: column;
	justify-content: space-between;
	gap: 24px; // Minimum gap between children

	.project-category {
		font-size: clamp(11px, 1.4vw, 14px);
		text-transform: uppercase;
		letter-spacing: 0.15em;
		font-weight: var(--font-weight-bold);
		color: rgba(255, 255, 255, 0.7);
		display: block;
		margin-bottom: 1rem;
		text-shadow: 0 1px 8px rgba(0, 0, 0, 0.6);
		
		@media (prefers-color-scheme: light) {
			color: rgba(255, 255, 255, 0.8);
			text-shadow: 0 2px 12px rgba(0, 0, 0, 0.8);
		}
	}

	h2 {
		font-size: clamp(3rem, 8vw, 6rem);
		font-weight: 800;
		margin: 0;
		line-height: 0.9;
		color: #ffffff;
		text-shadow: 0 2px 20px rgba(0, 0, 0, 0.8);
		letter-spacing: -0.02em;

		// Larger size for big viewports
		@media (min-width: 1400px) {
			font-size: clamp(4rem, 10vw, 8rem);
		}
	}
}

// Project edge wrapper specific overrides - flat white styling for video overlay
.project-edge-wrapper .above-fold-content-wrapper .project-title {
	display: flex;
	flex-direction: column;
	justify-content: space-between;
	flex: 1; // Fill available height
	gap: 24px; // Minimum gap between project-company-title and read-story-button-container
	
	// Company and title in flex column
	.project-company-title {
		display: flex;
		flex-direction: column; // Changed to column layout
		align-items: flex-start;
		gap: 0; // No gap as requested
	}
	
	h2 {
		color: #ffffff !important;
		text-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
		background: none;
		background-clip: unset;
		-webkit-background-clip: unset;
		-webkit-text-fill-color: unset;
		font-size: clamp(1.5rem, 4vw, 42px); // Cap at 42px
		margin: 0; // No additional padding
		padding: 0; // No additional padding
	}
	
	.project-category {
		font-size: var(--font-size-xs);
		color: rgba(255, 255, 255, 0.8);
		text-shadow: 0 1px 8px rgba(0, 0, 0, 0.6);
		margin-bottom: 0.5rem; // Space between company and title
	}

	.project-byline {
		font-size: clamp(1.1rem, 2.8vw, 1.5rem);
		line-height: var(--line-height-tight).4;
		color: rgba(255, 255, 255, 0.85);
		margin-top: 1.5rem;
		margin-left: 0;
		max-width: 450px; // Updated max-width as requested
		font-weight: var(--font-weight-normal);
		text-shadow: 0 1px 10px rgba(0, 0, 0, 0.6);
		position: relative;
		
		// Truncate text after 3 lines
		&.truncated {
			display: -webkit-box;
			-webkit-line-clamp: 3;
			-webkit-box-orient: vertical;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		
		@media (prefers-color-scheme: light) {
			color: rgba(255, 255, 255, 0.9);
			text-shadow: 0 2px 15px rgba(0, 0, 0, 0.8);
		}
	}
	
	// More button styles moved to _byline-truncation.scss
}

// Project impact stats in above-fold content - clean minimal design
.project-edge-wrapper .above-fold-content-wrapper .project-impact-stats {
	display: flex;
	gap: 8px; // Tighter gap between stat items
	margin-top: 0; // Remove margin - using flexbox gap instead
	align-items: flex-start;
	
	.stat-item-wrapper .stat-item {
		display: flex;
		flex-direction: column;
		align-items: flex-start;
		padding: 4px 6px; // Tighter padding for more compact stat items
		border: 1px solid rgba(255, 255, 255, 0.25);
		border-radius: 8px;
		position: relative;
		overflow: hidden;
		
		// Watercolor-style greyscale background - now using enhanced hover state as default
		&::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: 
				radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
				radial-gradient(circle at 80% 70%, rgba(240, 240, 240, 0.1) 0%, transparent 40%),
				radial-gradient(circle at 40% 80%, rgba(220, 220, 220, 0.08) 0%, transparent 60%),
				linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.04) 100%);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			z-index: -1;
		}
		
		&:hover {
			border-color: rgba(255, 255, 255, 0.3);
			
			&::before {
				background: 
					radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.18) 0%, transparent 50%),
					radial-gradient(circle at 80% 70%, rgba(240, 240, 240, 0.12) 0%, transparent 40%),
					radial-gradient(circle at 40% 80%, rgba(220, 220, 220, 0.1) 0%, transparent 60%),
					linear-gradient(135deg, rgba(255, 255, 255, 0.06) 0%, rgba(200, 200, 200, 0.05) 100%);
			}
		}
		
		.stat-value {
			font-size: var(--font-size-xl); // Updated font-size one weight up as requested
			font-weight: var(--font-weight-medium); // Updated font-weight as requested
			line-height: var(--line-height-tight);
			color: #ffffff;
			margin-bottom: 0.25rem;
			letter-spacing: -0.01em;
			text-shadow: none;
			position: relative;
			z-index: 1;
		}
		
		.stat-label {
			font-size: var(--font-size-xs);
			font-weight: var(--font-weight-normal);
			text-transform: uppercase;
			letter-spacing: 0.08em;
			color: rgba(255, 255, 255, 0.7);
			line-height: var(--line-height-tight).2;
			text-shadow: none;
			position: relative;
			z-index: 1;
		}
		
		// Special class for project impact stats labels - no margin bottom
		.stat-label--impact {
			font-size: var(--font-size-xs);
			font-weight: var(--font-weight-normal);
			text-transform: uppercase;
			letter-spacing: 0.08em;
			color: rgba(255, 255, 255, 0.7);
			line-height: var(--line-height-tight).2;
			text-shadow: none;
			position: relative;
			z-index: 1;
			margin-bottom: 0;
		}
	}
	
	// Responsive adjustments
	@media (max-width: 768px) {
		.stat-item-wrapper .stat-item {
			.stat-value {
				font-size: var(--font-size-base); // Slightly smaller on mobile
			}
			
			.stat-label,
			.stat-label--impact {
				font-size: 8px;
			}
		}
	}
	
	@media (max-width: 480px) {
		.stat-item-wrapper .stat-item {
			
			.stat-value {
				font-size: clamp(1.25rem, 3.5vw, 1.75rem);
			}
			
			.stat-label,
			.stat-label--impact {
				font-size: 7px;
			}
		}
	}
}

// Read story button container - inline positioning within content flow
.read-story-button-container {
	margin-top: 0.75rem; // Small margin after company/title
	margin-bottom: 0.75rem; // Small margin before byline
	z-index: 10;
	display: flex;
	gap: 12px; // Space between buttons
	align-items: center;
	
	// Mobile-specific margin reduction
	@media (max-width: variables.$mobile-breakpoint) {
		margin-top: 0.5rem; // Smaller margin on mobile
		margin-bottom: 0.5rem;
	}
}

// SHARED MIXINS FOR CONSISTENCY
@mixin stat-value-base {
	margin-bottom: 0;
	color: variables.$black;
	white-space: nowrap;
	letter-spacing: -3%;

	@media (prefers-color-scheme: dark) {
		color: variables.$white;
	}
}

@mixin stat-value-scaling {
	@media (max-height: 600px) {
		font-size: 2rem;
	}

	@media (max-height: 500px) {
		font-size: var(--font-size-2xl);
	}

	@media (max-height: 400px) {
		font-size: var(--font-size-xl);
	}
}

@mixin stat-label-base {
	font-size: clamp(12px, 1.5vw, 1rem);
	color: #909090;
	line-height: var(--line-height-tight);
}

@mixin project-title-colors {
	color: variables.$black;

	@media (prefers-color-scheme: dark) {
		color: variables.$white;
	}
}

@mixin project-byline-edge-wrapper {
	font-size: clamp(12px, 2vw, 2rem);
	margin-top: 0.5rem;
	margin-bottom: 0;
	max-width: 450px;
	margin-left: auto;
	margin-right: auto;
}

@mixin min-height-adjustments($base-min-height) {
	min-height: $base-min-height;

	@media (max-height: 600px) {
		min-height: calc($base-min-height - 5dvh);
	}

	@media (max-height: 500px) {
		min-height: calc($base-min-height - 10dvh);
	}

	@media (max-height: 400px) {
		min-height: calc($base-min-height - 15dvh);
	}
}

@mixin asymmetric-padding-adjustments($base-top: 30px, $base-bottom: 45px) {

	// Very small height adjustments - maintains asymmetric ratio
	@media (max-height: 600px) {
		padding-top: calc($base-top * 0.67); // 20px from 30px
		padding-bottom: calc($base-bottom * 0.67); // 30px from 45px
	}

	@media (max-height: 500px) {
		padding-top: calc($base-top * 0.33); // 10px from 30px
		padding-bottom: calc($base-bottom * 0.44); // 20px from 45px
	}

	@media (max-height: 400px) {
		padding-top: calc($base-top * 0.3); // 9px from 30px
		padding-bottom: calc($base-bottom * 0.33); // 15px from 45px
	}
}

// Standalone version styles to match dynamic loading
.project-edge-wrapper {
	.above-fold-content-wrapper {
		.project-title {
			padding-bottom: 0;
			margin-bottom: 0;

			h2 {
				@include project-title-colors;
			}

			.project-category {
				margin-bottom: 0;
			}

			.project-byline {
				@include project-byline-edge-wrapper;
	& {
		margin-left: 0;
		margin-right: 0;
	}
			}
		}
	}

	// Standalone project impact stats styling to match dynamic version
	.project-impact-stats {
		margin: 0;
		padding: 0;
		display: flex;
		flex-direction: row !important;

		.stat-item {
			padding: 3px;

			.stat-value {
				font-size: 2.5rem;
				@include stat-value-base;
				@include stat-value-scaling;
			}

			.stat-label {
				@include stat-label-base;
			}
		}
	}
}

// Demo button - solid white with black text
.demo-button {
	background-color: white;
	color: black;
	border: 1px solid rgba(255, 255, 255, 0.9);
	border-radius: 30px;
	padding: 12px 24px;
	font-size: var(--font-size-base);
	font-weight: var(--font-weight-medium);
	cursor: pointer;
	display: inline-flex;
	align-items: center;
	gap: 8px;
	transition: all 0.2s ease;
	text-decoration: none;
	
	svg {
		width: 16px;
		height: 16px;
		fill: currentColor;
	}
	
	&:hover {
		background-color: #e3e3e3;
		color: black;
	}
	
	&:active {
		background-color: #E8E8E8;
	}
}

// Read story button container
.read-story-button-container {
	margin-top: 1.5rem; // Default margin for compact view
	display: flex;
	gap: 12px;
	align-items: center;
}

// Read story button - optimized for video overlay
.read-story-button {
	background-color: black;
	color: white;
	border: 1px solid rgba(255, 255, 255, 0.2);
	border-radius: 30px;
	padding: 12px 24px;
	font-size: var(--font-size-base);
	font-weight: var(--font-weight-normal);
	cursor: pointer;
	display: flex;
	align-items: center;
	gap: 8px;
	transition: all 300ms ease-in-out;
	backdrop-filter: blur(20px);
	-webkit-backdrop-filter: blur(20px);
	text-shadow: rgba(0, 0, 0, 0.15) 0px 2px 4px;

	svg {
		width: 16px;
		height: 16px;
	}

	&:hover {
		background-color: #1A1A1A; // Subtle lighten from black
		border-color: rgba(255, 255, 255, 0.3);
	}

	&:active {
		background-color: #242424;
	}
}

// Dynamic loading specific overrides - make scrollable and ensure proper layout
.blog-content .project-edge-wrapper {
	// Reset any blog-content constraints and spacing
	max-width: none;
	width: 100%;
	margin-left: 0;
	margin-right: 0;
	margin-top: 0;
	overflow-y: auto;
	-webkit-overflow-scrolling: touch;
	
	// Reset inherited blog-content styles that interfere with project layout
	.above-the-fold-preview {
		height: 100%;
		margin-top: 0;
		padding-top: 0;
		
		// Mobile-specific fixes for dynamic loading
		@media (max-width: variables.$mobile-breakpoint) {
			height: 100vh; // Fallback for older browsers
			height: 100dvh;
		}
	}

	.project-trailer-hero {
		height: 100%;
		margin-top: 0;
		padding-top: 0;
	}

	.above-fold-content-wrapper {
		position: relative;
		min-height: unset;
		max-height: unset;
		padding: 36px;
		
		// Create full-width background that extends to edges
		&::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100vw;
			right: -100vw;
			bottom: 0;
			background-color: rgba(0, 0, 0, 0.03); // Subtle light mode background
			z-index: -1;
			
			@media (prefers-color-scheme: dark) {
				background-color: rgba(255, 255, 255, 0.03); // Subtle dark mode background
			}
		}
		
		// Responsive padding overrides
		@media (max-width: 1200px) {
			padding: 36px 32px;
		}
		
		@media (max-width: 768px) {
			padding: 36px 24px;
			display: flex;
			flex-direction: column;
			justify-content: flex-end;
			gap: 0.75rem;
		}
		
		@media (max-width: 480px) {
			padding: 36px 20px;
			display: flex;
			flex-direction: column;
			justify-content: flex-end;
			gap: 0.75rem;
		}
	}
}

// Dynamic back button positioning - persist in top left corner
.blog-content .dynamic-back-button {
	position: absolute;
	top: 24px;
	left: 24px;
	z-index: 1000;
}

// RESPONSIVE ADJUSTMENTS - Consolidated and cleaned up
@media (max-width: variables.$tablet-breakpoint) {
	.above-fold-content-wrapper {
		padding: 30px clamp(1rem, 3vw, 2rem) 45px;

		.project-title {
			max-width: 90%;

			h2 {
				font-size: clamp(2rem, 7vw, 3rem);
			}

			.project-byline {
				font-size: clamp(0.9rem, 2.2vw, 1.1rem);
			}
		}
	}
}

@media (max-width: variables.$mobile-breakpoint) {
	.above-the-fold-preview {
		height: 100dvh;
	}

	.project-gallery-hero {
		height: 55dvh; // Increase to give more space for content
	}

	.above-fold-content-wrapper {
		// Mobile styles now handled in the main .blog-content .project-edge-wrapper block
		// to maintain consistency with 36px padding

		.project-title {
			max-width: 95%;
			display: flex;
			flex-direction: column;
			gap: 0.5rem; // Control spacing between title elements
			margin-bottom: 0; // Set margin-bottom to 0 on mobile

			h2 {
				font-size: clamp(1.75rem, 6vw, 2.5rem);
				margin: 0; // Remove default margins
				margin-bottom: 9px; // Add 9px margin-bottom on mobile
			}

			.project-byline {
				font-size: clamp(0.9rem, 2.2vw, 1.1rem);
				margin: 0; // Remove all margins - using gap instead
				line-height: var(--line-height-tight).3;
			}
		}
	}

	// Mobile styles for project-edge-wrapper elements
	.project-edge-wrapper .above-fold-content-wrapper {
		.project-title {
			margin-bottom: 0; // Set margin-bottom to 0 on mobile

			.project-category {
				margin-bottom: 6px; // Add 6px margin-bottom on mobile
			}

			h2 {
				margin-bottom: 9px; // Add 9px margin-bottom on mobile
			}
		}

		// Fix stats scaling and spacing on mobile
		.project-impact-stats {
			margin: 0; // Remove margin - using gap instead
			gap: 1rem; // Reduce gap between stats
			
			.stat-item {
				padding: 8px 12px; // Reduce padding
				
				.stat-value {
					font-size: clamp(1.1rem, 3.5vw, 1.5rem); // Smaller and more controlled
					margin: 0; // Remove margins
				}
				
				.stat-label {
					font-size: clamp(0.75rem, 1.8vw, 0.9rem); // Smaller and more controlled
					margin: 0; // Remove margins
				}
			}
		}
	}

	.read-story-button {
		padding: 8px 16px; // More padding for better touch targets
		font-size: var(--font-size-sm); // Slightly larger text
		bottom: 20px; // Move up from edge

		svg {
			width: 14px;
			height: 14px;
		}
	}

	// Fix the read story button container positioning
	.read-story-button-container {
		margin: 0; // Remove all margins - using flexbox gap instead
	}
}

// Projects without writeups - simple list style
.portfolio-item.no-writeup-list {
	// No longer in grid, so remove grid-column
	margin: 24px 0 0 0;  // Add top margin to separate from grid
	padding: 9px 0;
	background: transparent;
	border: none;
	box-shadow: none;
	aspect-ratio: unset;  // Remove square aspect ratio
	height: auto;  // Let content determine height
	min-height: unset;  // Remove min-height constraint
	display: flex;
	align-items: start;
	width: 100%;  // Ensure full width
	box-sizing: border-box;  // Include padding in width calculation
	
	// Remove max-height constraints to let content flow naturally
	@media screen and (min-width: 480px) {
		height: auto;
		min-height: unset;
		margin-top: 32px;  // Slightly more space on desktop
	}
	
	.portfolio-content {
		padding: 0;
		
		.no-writeup-intro {
			font-size: var(--font-size-sm);
			line-height: var(--line-height-tight).4;
			color: variables.$text-color-secondary;
			margin: 0 0 variables.$space-xs 0;
			
			@media (prefers-color-scheme: dark) {
				color: variables.$text-color-secondary-dark;
			}
		}
		
		.no-writeup-projects {
			font-size: var(--font-size-xs);
			line-height: var(--line-height-tight).4;
			color: variables.$grey;
			margin: 0;
			
			@media (prefers-color-scheme: dark) {
				color: variables.$grey-dark;
				opacity: 0.7;
			}
		}
	}
}

// New Portfolio Redesign Styles
.portfolio-list--redesigned {
	// Hide the old filter when in redesigned mode
	.project-filter-container {
		display: none;
	}
	
	// Column title with responsive padding
	.portfolio-column-title {
		padding: 0 48px;
		
		@media (min-width: 1200px) {
			padding: 0 64px;
		}
		
		@media (min-width: 1400px) {
			padding: 0 80px;
		}
		
		@media (max-width: variables.$tablet-breakpoint) {
			padding: 0 32px;
		}
		
		@media (max-width: variables.$mobile-breakpoint) {
			padding: 0 16px;
		}
	}
	
	// Portfolio controls (filters button)
	.portfolio-controls {
		margin-bottom: 32px;
		padding: 0 48px;
		
		@media (min-width: 1200px) {
			padding: 0 64px;
		}
		
		@media (min-width: 1400px) {
			padding: 0 80px;
		}
		
		@media (max-width: variables.$tablet-breakpoint) {
			padding: 0 32px;
		}
		
		@media (max-width: variables.$mobile-breakpoint) {
			padding: 0 16px;
			margin-bottom: 0;
		}
		
		// Using the reusable posts-only-button class from components/_button.scss
		.posts-only-button {
			display: inline-flex;
			align-items: center;
			gap: 6px;
		}
	}
	
	// Filters dropdown
	.filters-dropdown-container {
		position: relative;
		display: inline-block;
		
		.filters-toggle {
			position: relative;
			
			// Filter count pip
			.filter-count-pip {
				position: absolute;
				top: -8px;
				right: -8px;
				background: variables.$accent-gold;
				color: variables.$black;
				font-size: var(--font-size-xs);
				font-weight: var(--font-weight-semibold);
				min-width: 18px;
				height: 18px;
				border-radius: 9px;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				padding: 0 5px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
				
				@media (prefers-color-scheme: dark) {
					background: variables.$accent-gold-dark;
					color: variables.$white;
				}
			}
		}
		
		.filters-dropdown {
			position: absolute;
			top: 100%;
			left: 0;
			margin-top: 8px;
			min-width: 480px;
			background: variables.$white;
			border: 1px solid variables.$border-color;
			border-radius: 12px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15),
						0 4px 8px rgba(0, 0, 0, 0.1);
			z-index: 100;
			
			@media (prefers-color-scheme: dark) {
				background: variables.$card-bg-dark;
				border-color: variables.$border-color-dark;
				box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4),
							0 4px 8px rgba(0, 0, 0, 0.3);
			}
			
			@media (max-width: variables.$mobile-breakpoint) {
				min-width: 320px;
				max-width: calc(100vw - 32px);
			}
			
			.filters-dropdown-content {
				padding: 20px;
				
				.filters-dropdown-header {
					display: flex;
					justify-content: space-between;
					align-items: center;
					margin-bottom: 20px;
					padding-bottom: 16px;
					border-bottom: 1px solid rgba(variables.$border-color, 0.5);
					
					@media (prefers-color-scheme: dark) {
						border-color: rgba(variables.$border-color-dark, 0.5);
					}
					
					h3 {
						font-size: var(--font-size-base);
						font-weight: var(--font-weight-semibold);
						margin: 0;
						color: variables.$text-color;
						
						@media (prefers-color-scheme: dark) {
							color: variables.$text-color-dark;
						}
					}
					
					.filter-clear {
						padding: 4px 12px;
						font-size: var(--font-size-xs);
						font-weight: var(--font-weight-medium);
						background: transparent;
						border: 1px solid variables.$border-color;
						border-radius: 6px;
						color: variables.$text-color-secondary;
						cursor: pointer;
						transition: all 0.2s ease;
						
						&:not(:disabled):hover {
							border-color: variables.$text-color-secondary;
							color: variables.$text-color;
						}
						
						&:disabled {
							opacity: 0.4;
							cursor: not-allowed;
						}
						
						@media (prefers-color-scheme: dark) {
							border-color: variables.$border-color-dark;
							color: variables.$text-color-secondary-dark;
							
							&:not(:disabled):hover {
								border-color: variables.$text-color-secondary-dark;
								color: variables.$text-color-dark;
							}
						}
					}
				}
			}
		}
	}
	
	// New filter system
	.portfolio-filters {
		margin-bottom: 48px;
		padding: 24px 0;
		border-bottom: 1px solid variables.$border-color;
		
		@media (prefers-color-scheme: dark) {
			border-color: variables.$border-color-dark;
		}
		
		.filter-category {
			margin-bottom: 20px;
			
			&-label {
				font-size: var(--font-size-xs);
				font-weight: var(--font-weight-semibold);
				text-transform: uppercase;
				letter-spacing: 0.05em;
				color: variables.$text-color-secondary;
				margin-bottom: 12px;
				
				@media (prefers-color-scheme: dark) {
					color: variables.$text-color-secondary-dark;
				}
			}
			
			.filter-pills {
				display: flex;
				flex-wrap: wrap;
				gap: 8px;
			}
		}
		
		.filter-pill {
			padding: 6px 16px;
			font-size: var(--font-size-xs);
			font-weight: var(--font-weight-medium);
			background: transparent;
			border: 1px solid variables.$border-color;
			border-radius: 20px;
			color: variables.$text-color;
			cursor: pointer;
			transition: all 0.2s ease;
			
			&:hover {
				background-color: variables.$card-bg;
				border-color: variables.$text-color-secondary;
			}
			
			&.active {
				background-color: variables.$text-color;
				color: variables.$white;
				border-color: variables.$text-color;
			}
			
			@media (prefers-color-scheme: dark) {
				border-color: variables.$border-color-dark;
				color: variables.$text-color-dark;
				
				&:hover {
					background-color: variables.$card-bg-dark;
					border-color: variables.$text-color-secondary-dark;
				}
				
				&.active {
					background-color: variables.$text-color-dark;
					color: variables.$black;
					border-color: variables.$text-color-dark;
				}
			}
		}
		
		.filter-clear {
			margin-top: 16px;
			padding: 8px 20px;
			font-size: var(--font-size-xs);
			font-weight: var(--font-weight-medium);
			background: transparent;
			border: none;
			color: hsl(0, 60%, 50%); // Red color
			cursor: pointer;
			transition: opacity 0.2s ease;
			
			&:hover {
				opacity: 0.7;
			}
			
			&:disabled {
				opacity: 0.3;
				cursor: not-allowed;
			}
		}
	}
	
	// Featured projects grid
	.portfolio-featured-grid {
		display: grid;
		grid-template-columns: repeat(3, minmax(220px, max-content));
		justify-content: center; // Center the grid
		gap: 32px;
		margin-bottom: 80px;
		padding: 0 48px;
		
		@media (min-width: 1200px) {
			gap: 40px;
			padding: 0 64px;
		}
		
		// Mobile carousel override
		@media (max-width: 768px) {
			&.notebook-carousel-mobile {
				display: flex !important;
				grid-template-columns: none;
			}
		}
		
		@media (min-width: 1400px) {
			gap: 48px;
			padding: 0 80px;
		}
		
		@media (max-width: variables.$tablet-breakpoint) {
			grid-template-columns: repeat(2, 1fr);
			gap: 24px;
			padding: 0 32px;
		}
		
		@media (max-width: variables.$mobile-breakpoint) {
			&:not(.notebook-carousel-mobile) {
				grid-template-columns: repeat(1, 1fr);
				gap: 20px;
				padding: 0 16px;
			}
		}
	}
	
	// Portfolio item wrapper (clickable container)
	.portfolio-item-wrapper {
		display: flex;
		flex-direction: column;
		align-items: center;
		width: max-content; // Only as wide as content
		text-decoration: none;
		transition: transform 0.2s ease;
		cursor: pointer;
		
		&:hover {
			// Only transform the featured item, not the wrapper
			.portfolio-item--featured {
				transform: translateY(-8px) scale(1.02);
			}
			
			.portfolio-image {
				transform: rotateY(calc(-10deg + var(--tilt-y) * 0.8)) rotateX(calc(3deg + var(--tilt-x) * 0.5));
				
				&::before {
					// Spine becomes more visible on hover
					width: 18px;
					background: linear-gradient(90deg, 
						rgba(0, 0, 0, 0.5) 0%,
						rgba(0, 0, 0, 0.3) 20%,
						rgba(255, 255, 255, 0.2) 40%,
						rgba(0, 0, 0, 0.2) 60%,
						rgba(0, 0, 0, 0.4) 100%
					);
				}
				
				.image-wrapper {
					box-shadow: 
						0 0 0 1px rgba(0, 0, 0, 0.15),
						0 20px 60px rgba(0, 0, 0, 0.4),
						0 5px 20px rgba(0, 0, 0, 0.3),
						0 1px 5px rgba(0, 0, 0, 0.2);
						
					&::after {
						// Enhanced gloss on hover
						background: linear-gradient(
							105deg,
							rgba(255, 255, 255, 0.6) 0%,
							rgba(255, 255, 255, 0.3) 20%,
							transparent 40%,
							transparent 60%,
							rgba(255, 255, 255, 0.15) 90%,
							rgba(255, 255, 255, 0.25) 100%
						);
					}
				}
			}
		}
		
		&.filtered-out {
			display: none;
		}
	}
	
	// Featured portfolio item (card styling)
	.portfolio-item--featured {
		height: 180px;
		overflow: visible;
		border-radius: 0;
		background: transparent;
		box-shadow: none;
		transition: transform 0.3s ease;
		position: relative;
		perspective: 1200px;
		transform-style: preserve-3d;
		margin: 0 auto;
		max-width: 100%;
		
		// CSS custom properties for parallax
		--tilt-x: 0deg;
		--tilt-y: 0deg;
		--mouse-x: 0;
		--mouse-y: 0;
		
		@media (hover: hover) and (pointer: fine) {
			.portfolio-item-wrapper:hover & {
				box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
			}
		}
		
		@media (prefers-color-scheme: dark) {
			background-color: variables.$card-bg-dark;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
			
			@media (hover: hover) and (pointer: fine) {
				.portfolio-item-wrapper:hover & {
					box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
				}
			}
			
			.portfolio-image {
				&::before {
					// Dark spine
					background: linear-gradient(90deg, 
						rgba(0, 0, 0, 0.6) 0%,
						rgba(0, 0, 0, 0.4) 20%,
						rgba(255, 255, 255, 0.05) 40%,
						rgba(0, 0, 0, 0.3) 60%,
						rgba(0, 0, 0, 0.5) 100%
					);
				}
				
				&::after {
					// Dark back cover
					background: #1a1a1a;
				}
				
				.image-wrapper {
					background: #0a0a0a;
					box-shadow: 
						0 0 0 1px rgba(255, 255, 255, 0.05),
						0 10px 40px rgba(0, 0, 0, 0.5),
						0 2px 10px rgba(0, 0, 0, 0.4);
					
					&::after {
						// Adjusted gloss for dark mode
						background: linear-gradient(
							105deg,
							rgba(255, 255, 255, 0.3) 0%,
							rgba(255, 255, 255, 0.1) 20%,
							transparent 40%,
							transparent 60%,
							rgba(255, 255, 255, 0.05) 90%,
							rgba(255, 255, 255, 0.1) 100%
						);
						mix-blend-mode: screen;
					}
					
					.pages-edge {
						background: linear-gradient(90deg,
							transparent 0%,
							rgba(255, 255, 255, 0.02) 30%,
							rgba(255, 255, 255, 0.05) 70%,
							rgba(255, 255, 255, 0.1) 100%
						);
					}
				}
			}
		}
		
		.portfolio-image {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			transform-style: preserve-3d;
			transform: rotateY(calc(-15deg + var(--tilt-y) * 0.8)) rotateX(calc(5deg + var(--tilt-x) * 0.5));
			transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
			
			// Book spine (left edge)
			&::before {
				content: '';
				position: absolute;
				left: 0;
				top: 0;
				bottom: 0;
				width: 15px;
				background: linear-gradient(90deg, 
					rgba(0, 0, 0, 0.4) 0%,
					rgba(0, 0, 0, 0.2) 20%,
					rgba(255, 255, 255, 0.1) 40%,
					rgba(0, 0, 0, 0.15) 60%,
					rgba(0, 0, 0, 0.3) 100%
				);
				transform: rotateY(-90deg) translateZ(7.5px);
				transform-origin: left center;
				border-radius: 2px 0 0 2px;
			}
			
			// Book back cover (behind)
			&::after {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: #f5f5f5;
				transform: translateZ(-10px);
				border-radius: 0 8px 8px 0;
				box-shadow: 
					0 0 0 1px rgba(0, 0, 0, 0.1),
					-2px 0 4px rgba(0, 0, 0, 0.1);
			}
			
			// Main book cover
			.image-wrapper {
				position: relative;
				width: 100%;
				height: 100%;
				background: white;
				border-radius: 0 8px 8px 0;
				overflow: hidden;
				transform: translateZ(0);
				box-shadow: 
					0 0 0 1px rgba(0, 0, 0, 0.1),
					0 10px 40px rgba(0, 0, 0, 0.3),
					0 2px 10px rgba(0, 0, 0, 0.2);
				
				// Substrate/paper texture
				&::before {
					content: '';
					position: absolute;
					top: 0;
					left: 0;
					right: 0;
					bottom: 0;
					background: 
						repeating-linear-gradient(
							90deg,
							transparent,
							transparent 2px,
							rgba(255, 255, 255, 0.03) 2px,
							rgba(255, 255, 255, 0.03) 4px
						),
						repeating-linear-gradient(
							0deg,
							transparent,
							transparent 2px,
							rgba(255, 255, 255, 0.03) 2px,
							rgba(255, 255, 255, 0.03) 4px
						);
					z-index: 3;
					pointer-events: none;
				}
				
				// Glossy finish
				&::after {
					content: '';
					position: absolute;
					top: 0;
					left: 0;
					right: 0;
					bottom: 0;
					background: linear-gradient(
						105deg,
						rgba(255, 255, 255, 0.5) 0%,
						rgba(255, 255, 255, 0.2) 20%,
						transparent 40%,
						transparent 60%,
						rgba(255, 255, 255, 0.1) 90%,
						rgba(255, 255, 255, 0.2) 100%
					);
					z-index: 4;
					pointer-events: none;
					mix-blend-mode: overlay;
				}
				
				// Inner pages shadow (right edge)
				.pages-edge {
					position: absolute;
					right: 0;
					top: 2px;
					bottom: 2px;
					width: 8px;
					background: linear-gradient(90deg,
						transparent 0%,
						rgba(0, 0, 0, 0.05) 30%,
						rgba(0, 0, 0, 0.1) 70%,
						rgba(0, 0, 0, 0.2) 100%
					);
					z-index: 2;
					
					// Page lines
					&::before {
						content: '';
						position: absolute;
						right: 0;
						top: 0;
						bottom: 0;
						width: 4px;
						background: repeating-linear-gradient(
							0deg,
							rgba(0, 0, 0, 0.05),
							rgba(0, 0, 0, 0.05) 1px,
							transparent 1px,
							transparent 2px
						);
					}
				}
			}
			
			img, video {
				width: 100%;
				height: 100%;
				object-fit: cover;
				display: block;
				position: relative;
				z-index: 1;
			}
		}
	}
	
	// Portfolio info (outside the card)
	.portfolio-info {
		padding: 12px 10px 0 10px;
		text-align: center;
		width: calc(100% + 20px);
		margin-left: -10px;
		
		.portfolio-title {
			font-family: var(--font-sans);
			font-size: var(--font-size-base);
			font-weight: var(--font-weight-semibold);
			color: variables.$text-color;
			margin: 0 0 4px 0;
			line-height: var(--line-height-tight);
			letter-spacing: -0.02em;
			
			// Mobile: scale up 2 sizes (base → lg → xl)
			@media (max-width: variables.$mobile-breakpoint) {
				font-size: var(--font-size-xl);
			}
			
			@media (prefers-color-scheme: dark) {
				color: variables.$text-color-dark;
			}
		}
		
		.portfolio-byline {
			font-family: var(--font-sans);
			font-size: var(--font-size-sm);
			font-weight: var(--font-weight-normal);
			color: variables.$text-color-secondary;
			margin: 0;
			line-height: var(--line-height-tight);
			letter-spacing: -0.01em;
			
			// Mobile: scale up 1 size (sm → base)
			@media (max-width: variables.$mobile-breakpoint) {
				font-size: var(--font-size-base);
			}
			
			@media (prefers-color-scheme: dark) {
				color: variables.$text-color-secondary-dark;
			}
		}
	}
	
	// Ensure portfolio-more-section works in portfolio-list context
	.portfolio-list,
	.portfolio-list--redesigned {
		.portfolio-more-section {
			// Clear any grid constraints
			grid-column: 1 / -1;
			width: 100%;
			max-width: none;
			// Padding is already set on the element itself
		}
	}
	
	// Even More Section
	.portfolio-more-section {
		margin-top: 36px;
		position: relative;
		grid-column: 1 / -1; // Span full grid width
		width: 100%;
		padding: 0; // Remove padding to allow background edge-to-edge
		box-sizing: border-box;
		
		// Desktop - extend to edges of content area
		@media (min-width: variables.$tablet-breakpoint) {
			// Assuming projectsContent has padding of space-md (usually 32px)
			margin-left: -32px;
			margin-right: -32px;
			width: calc(100% + 64px);
		}
		
		// Mobile responsive margin
		@media (max-width: variables.$mobile-breakpoint) {
			margin-top: 24px;
			padding: 0; // Ensure no padding on mobile
			width: 100vw;
			margin-left: calc(-50vw + 50%);
			margin-right: calc(-50vw + 50%);
		}
		
		// Gradient transition
		.portfolio-more-transition {
			height: 90px;
			background: linear-gradient(
				to bottom,
				transparent 0%,
				rgba(245, 245, 245, 0) 10%,
				rgba(245, 245, 245, 0.4) 30%,
				rgba(245, 245, 245, 0.7) 50%,
				rgba(245, 245, 245, 0.85) 70%,
				rgba(245, 245, 245, 0.95) 85%,
				#f5f5f5 100%
			);
			margin: 0; // No compensation needed now
			
			@media (max-width: variables.$mobile-breakpoint) {
				height: 60px;
			}
			
			// Dark mode gradient
			@media (prefers-color-scheme: dark) {
				background: linear-gradient(
					to bottom,
					transparent 0%,
					rgba(0, 0, 0, 0.2) 25%,
					rgba(0, 0, 0, 0.6) 60%,
					rgba(0, 0, 0, 0.9) 90%,
					rgba(0, 0, 0, 0.95) 100%
				);
			}
		}
		
		// Dark background content area
		.portfolio-more-content {
			background-color: #f5f5f5;
			margin: 0; // No compensation needed
			padding: 60px 63px 80px; // Add the 15px that was on parent (48 + 15 = 63)
			min-height: 300px; // Ensure minimum height
			
			// Dark mode background
			@media (prefers-color-scheme: dark) {
				background-color: rgba(0, 0, 0, 0.95);
			}
			
			@media (min-width: 1200px) {
				padding: 80px 79px 100px; // 64 + 15
			}
			
			@media (min-width: 1400px) {
				padding: 80px 95px 100px; // 80 + 15
			}
			
			@media (max-width: variables.$tablet-breakpoint) {
				padding: 60px 47px 80px; // 32 + 15
			}
			
			@media (max-width: variables.$mobile-breakpoint) {
				padding: 48px 24px calc(120px + env(safe-area-inset-bottom)); // Match device padding
				margin: 0;
				width: 100%;
				min-height: 60vh; // Ensure it extends to bottom of viewport
			}
			
			.portfolio-more-title {
				font-family: var(--font-sans);
				font-size: 32px;
				font-weight: var(--font-weight-semibold);
				color: rgba(0, 0, 0, 0.9);
				text-align: center;
				margin: 0 0 60px 0;
				letter-spacing: -0.02em;
				line-height: 1.2;
				
				@media (prefers-color-scheme: dark) {
					color: rgba(255, 255, 255, 0.9);
				}
				
				@media (min-width: variables.$tablet-breakpoint) {
					font-size: 42px;
					margin-bottom: 80px;
				}
				
				@media (max-width: variables.$mobile-breakpoint) {
					font-size: 26px;
					margin: 0 8px 48px 8px; // Add horizontal margins to match company blocks
					line-height: var(--line-height-1); // Tight line height on mobile
				}
			}
			
			// Company groups - each in its own row
			.portfolio-more-grid {
				display: flex;
				flex-direction: column;
				gap: 48px;
				max-width: 1200px;
				margin: 0 auto;
				
				@media (max-width: variables.$tablet-breakpoint) {
					gap: 36px;
				}
			}
			
			.portfolio-more-company {
				@media (max-width: variables.$mobile-breakpoint) {
					margin: 0 8px; // Add horizontal margins on mobile to prevent edge touching
				}
				.portfolio-more-company-name {
					font-family: var(--font-sans);
					font-size: var(--font-size-lg);
					font-weight: var(--font-weight-medium);
					color: rgba(0, 0, 0, 0.85);
					margin: 0 0 16px 0;
					text-transform: none;
					letter-spacing: -0.01em;
					
					display: flex;
					align-items: baseline;
					gap: 12px;
					
					@media (prefers-color-scheme: dark) {
						color: rgba(255, 255, 255, 0.85);
					}
					
					.company-years {
						font-size: var(--font-size-sm);
						font-weight: var(--font-weight-normal);
						color: rgba(0, 0, 0, 0.5);
						letter-spacing: 0;
						
						@media (prefers-color-scheme: dark) {
							color: rgba(255, 255, 255, 0.5);
						}
					}
					
					@media (max-width: variables.$mobile-breakpoint) {
						font-size: var(--font-size-base);
						
						.company-years {
							font-size: var(--font-size-sm);
						}
					}
				}
				
				.portfolio-more-projects {
					display: grid;
					grid-template-columns: repeat(3, 1fr);
					gap: 16px;
					
					@media (max-width: variables.$tablet-breakpoint) {
						grid-template-columns: repeat(2, 1fr);
						gap: 12px;
					}
					
					@media (max-width: variables.$mobile-breakpoint) {
						grid-template-columns: repeat(1, 1fr);
						gap: 10px;
					}
				}
				
				.portfolio-more-project {
					font-family: var(--font-sans);
					padding: 16px 20px;
					font-size: var(--font-size-base);
					font-weight: var(--font-weight-normal);
					line-height: var(--line-height-tight).4;
					color: rgba(0, 0, 0, 0.7);
					text-align: left;
					letter-spacing: -0.01em;
					background: rgba(0, 0, 0, 0.05);
					border-radius: 8px;
					
					transition: all 0.2s ease;
					cursor: default;
					
					@media (prefers-color-scheme: dark) {
						color: rgba(255, 255, 255, 0.7);
						background: rgba(255, 255, 255, 0.05);
					}
					
					&:hover {
						color: rgba(0, 0, 0, 0.95);
						background: rgba(0, 0, 0, 0.08);
						transform: translateY(-1px);
						
						@media (prefers-color-scheme: dark) {
							color: rgba(255, 255, 255, 0.95);
							background: rgba(255, 255, 255, 0.08);
						}
					}
					
					@media (max-width: variables.$mobile-breakpoint) {
						font-size: var(--font-size-sm);
						padding: 14px 16px;
					}
				}
			}
			
			// Dark mode adjustments for the dark section
			@media (prefers-color-scheme: dark) {
				background-color: rgba(0, 0, 0, 0.95);
			}
		}
	}
}

// Filters Modal
.filters-modal {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	z-index: 1000;
	display: flex;
	align-items: center;
	justify-content: center;
	padding: 20px;
	opacity: 0;
	visibility: hidden;
	transition: opacity 0.3s ease, visibility 0.3s ease;
	
	&[aria-hidden="false"] {
		opacity: 1;
		visibility: visible;
		
		.filters-modal-content {
			transform: translateY(0) scale(1);
		}
	}
	
	&-backdrop {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(0, 0, 0, 0.5);
		backdrop-filter: blur(4px);
		-webkit-backdrop-filter: blur(4px);
	}
	
	&-content {
		position: relative;
		width: 100%;
		max-width: 600px;
		max-height: 80vh;
		background: variables.$white;
		border-radius: 16px;
		box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
		display: flex;
		flex-direction: column;
		transform: translateY(20px) scale(0.95);
		transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
		
		@media (prefers-color-scheme: dark) {
			background: variables.$card-bg-dark;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
		}
	}
	
	&-header {
		padding: 24px 24px 16px;
		border-bottom: 1px solid variables.$border-color;
		display: flex;
		align-items: center;
		justify-content: space-between;
		
		h2 {
			margin: 0;
			font-size: var(--font-size-xl);
			font-weight: var(--font-weight-semibold);
			color: variables.$text-color;
		}
		
		@media (prefers-color-scheme: dark) {
			border-color: variables.$border-color-dark;
			
			h2 {
				color: variables.$text-color-dark;
			}
		}
	}
	
	&-close {
		width: 32px;
		height: 32px;
		padding: 0;
		background: transparent;
		border: none;
		border-radius: 8px;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		transition: all 0.2s ease;
		color: variables.$text-color-secondary;
		
		svg {
			width: 18px;
			height: 18px;
		}
		
		&:hover {
			background: variables.$card-bg;
			color: variables.$text-color;
		}
		
		@media (prefers-color-scheme: dark) {
			color: variables.$text-color-secondary-dark;
			
			&:hover {
				background: rgba(255, 255, 255, 0.1);
				color: variables.$text-color-dark;
			}
		}
	}
	
	&-body {
		padding: 24px;
		overflow-y: auto;
		flex: 1;
		
		.portfolio-filters {
			margin-bottom: 0;
			padding: 0;
			border: none;
		}
	}
	
	&-footer {
		padding: 16px 24px;
		border-top: 1px solid variables.$border-color;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 12px;
		
		@media (prefers-color-scheme: dark) {
			border-color: variables.$border-color-dark;
		}
		
		.filter-clear {
			margin: 0;
		}
		
		.filters-apply {
			padding: 10px 24px;
			font-size: var(--font-size-sm);
			font-weight: var(--font-weight-medium);
			background: variables.$text-color;
			color: variables.$white;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.2s ease;
			
			&:hover {
				background: color.scale(variables.$text-color, $lightness: -10%);
				transform: translateY(-1px);
			}
			
			@media (prefers-color-scheme: dark) {
				background: variables.$text-color-dark;
				color: variables.$black;
				
				&:hover {
					background: color.scale(variables.$text-color-dark, $lightness: -10%);
				}
			}
		}
	}
}

// =============================================================================
// DEMO MODE STYLES
// =============================================================================

// Demo mode active state
body.demo-active {
	.above-fold-content-wrapper {
		transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
		
		// Shrink the ::before overlay when demo is active
		&::before {
			top: -5dvh; // Shrink from -30dvh to -5dvh
			backdrop-filter: blur(5px); // Reduce blur
			-webkit-backdrop-filter: blur(5px);
			background: linear-gradient(
				180deg,
				rgba(0, 0, 0, 0) 0%,
				rgba(0, 0, 0, 0.05) 30%,
				rgba(0, 0, 0, 0.2) 60%,
				rgba(0, 0, 0, 0.4) 85%,
				rgba(0, 0, 0, 0.6) 100%
			);
			transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
		}
	}
}

// Demo mode for trailer hero
.project-trailer-hero.demo-mode {
	z-index: 20; // Bring to front
	transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
	
	.trailer-content {
		background: rgba(0, 0, 0, 0.95);
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 40px;
		
		// Demo container styles
		.demo-loading {
			color: white;
			font-size: var(--font-size-lg);
			font-weight: var(--font-weight-medium);
			text-align: center;
		}
		
		.demo-prototype,
		.demo-codesandbox,
		.demo-figma {
			width: 100%;
			height: 100%;
			max-width: 1400px;
			max-height: 90vh;
			margin: 0 auto;
			border-radius: 12px;
			overflow: hidden;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
			
			iframe {
				width: 100%;
				height: 100%;
				border: none;
				border-radius: 12px;
				background: white;
			}
		}
	}
}

// Demo close button
.demo-close-button {
	position: absolute;
	top: 20px;
	right: 20px;
	width: 48px;
	height: 48px;
	background: rgba(255, 255, 255, 0.1);
	backdrop-filter: blur(20px);
	-webkit-backdrop-filter: blur(20px);
	border: 1px solid rgba(255, 255, 255, 0.2);
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	transition: all 0.3s ease;
	z-index: 30;
	
	svg {
		width: 24px;
		height: 24px;
		color: white;
	}
	
	&:hover {
		background: rgba(255, 255, 255, 0.2);
		transform: scale(1.1);
		border-color: rgba(255, 255, 255, 0.3);
	}
	
	&:active {
		transform: scale(0.95);
	}
}

// Demo button pulsing animation
.demo-button {
	position: relative;
	overflow: visible;
	
	&::after {
		content: '';
		position: absolute;
		top: 50%;
		left: 50%;
		width: 100%;
		height: 100%;
		border-radius: 30px;
		background: white;
		opacity: 0;
		transform: translate(-50%, -50%) scale(1);
		animation: demoPulse 2s infinite;
		pointer-events: none;
		z-index: -1;
	}
}

@keyframes demoPulse {
	0% {
		opacity: 0.3;
		transform: translate(-50%, -50%) scale(1);
	}
	50% {
		opacity: 0;
		transform: translate(-50%, -50%) scale(1.3);
	}
	100% {
		opacity: 0;
		transform: translate(-50%, -50%) scale(1.3);
	}
}

// =============================================================================
// BYLINE MODAL STYLES
// =============================================================================

// Modal overlay
.byline-modal {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, 0.9);
	z-index: 1000;
	display: flex;
	align-items: center;
	justify-content: center;
	padding: 20px;
	opacity: 0;
	visibility: hidden;
	transition: opacity 0.3s ease, visibility 0.3s ease;
	
	&.active {
		opacity: 1;
		visibility: visible;
		
		.byline-modal-content {
			transform: scale(1);
		}
	}
}

// Modal content
.byline-modal-content {
	background: rgba(20, 20, 20, 0.95);
	backdrop-filter: blur(20px);
	-webkit-backdrop-filter: blur(20px);
	border: 1px solid rgba(255, 255, 255, 0.1);
	border-radius: 12px;
	padding: 32px;
	max-width: 600px;
	width: 100%;
	max-height: 80vh;
	overflow-y: auto;
	position: relative;
	transform: scale(0.9);
	transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
	
	.modal-byline-text {
		font-size: var(--font-size-lg);
		line-height: var(--line-height-tight).6;
		color: rgba(255, 255, 255, 0.9);
		margin: 0;
		text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
	}
	
	.modal-close-button {
		position: absolute;
		top: 16px;
		right: 16px;
		width: 32px;
		height: 32px;
		background: rgba(255, 255, 255, 0.1);
		border: 1px solid rgba(255, 255, 255, 0.2);
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		transition: all 0.2s ease;
		
		svg {
			width: 16px;
			height: 16px;
			color: rgba(255, 255, 255, 0.8);
		}
		
		&:hover {
			background: rgba(255, 255, 255, 0.15);
			border-color: rgba(255, 255, 255, 0.3);
			transform: scale(1.1);
		}
	}
}

// Demo mode styles
.demo-custom {
  width: 100%;
  height: 100%;
  min-height: 600px;
  background: #f5f5f5;
  border-radius: 8px;
  overflow: hidden;
  
  iframe {
    width: 100%;
    height: 100%;
    min-height: 600px;
    border: none;
    background: white;
  }
}

#trailerHero.demo-mode {
  #trailerContent {
    position: relative;
    z-index: 10;
  }
}

.demo-close-button {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  background: rgba(0, 0, 0, 0.8);
  border: none;
  border-radius: 50%;
  color: white;
  cursor: pointer;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
  
  &:hover {
    background: rgba(0, 0, 0, 0.9);
  }
  
  svg {
    width: 24px;
    height: 24px;
  }
}

// Demo Modal Styles
.demo-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: modalFadeIn 0.3s ease-out;
  
  &.closing {
    animation: modalFadeOut 0.3s ease-out;
  }
}

.demo-modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  cursor: pointer;
}

.demo-modal-content {
  position: relative;
  width: 100dvw;
  height: 100dvh;
  background: #f5f5f5;
  border-radius: 0;
  overflow: hidden;
  box-shadow: none;
  animation: modalSlideIn 0.3s ease-out;
  
  // Add grid background pattern for fullscreen mode
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(0, 0, 0, 0.08) 50px, rgba(0, 0, 0, 0.08) 51px),
      repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(0, 0, 0, 0.08) 50px, rgba(0, 0, 0, 0.08) 51px);
    background-size: 51px 51px;
    pointer-events: none;
    z-index: 0;
  }
  
  // Border frame
  &::after {
    content: '';
    position: absolute;
    top: 10px;
    left: 10px;
    right: 10px;
    bottom: 10px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 2px;
    pointer-events: none;
    z-index: 0;
  }
  
  .closing & {
    animation: modalSlideOut 0.3s ease-out;
  }
  
  // Dark mode support
  @media (prefers-color-scheme: dark) {
    background: #1a1a1a;
    
    &::before {
      background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(255, 255, 255, 0.08) 50px, rgba(255, 255, 255, 0.08) 51px),
        repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(255, 255, 255, 0.08) 50px, rgba(255, 255, 255, 0.08) 51px);
    }
    
    &::after {
      border-color: rgba(255, 255, 255, 0.12);
    }
  }
}

.demo-modal-close {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  background: rgba(0, 0, 0, 0.7);
  border: none;
  border-radius: 50%;
  color: white;
  cursor: pointer;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  backdrop-filter: blur(10px);
  
  &:hover {
    background: rgba(0, 0, 0, 0.9);
    transform: scale(1.1);
  }
  
  svg {
    width: 28px;
    height: 28px;
  }
}

// Zoom controls - styled like the back button
.demo-zoom-controls {
  position: absolute;
  top: 20px;
  right: 80px; // Position to the left of close button
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(10px);
  border-radius: 12px;
  padding: 4px 8px;
  z-index: 10;
  
  button {
    border-radius: 8px;
    background-color: transparent;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4px;
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-medium);
    border: none;
    transition: all 0.2s ease;
    cursor: pointer;
    width: 32px;
    height: 32px;
    
    &:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    &:active {
      transform: scale(0.95);
    }
    
    svg {
      width: 18px;
      height: 18px;
    }
  }
  
  .demo-zoom-level {
    color: white;
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-medium);
    min-width: 45px;
    text-align: center;
    user-select: none;
  }
  
  // Dark mode support
  @media (prefers-color-scheme: dark) {
    background: rgba(255, 255, 255, 0.1);
    
    button {
      color: white;
      
      &:hover {
        background: rgba(255, 255, 255, 0.2);
      }
    }
  }
  
  // Mobile adjustments
  @media (max-width: variables.$mobile-breakpoint) {
    top: 10px;
    right: 60px;
    gap: 4px;
    padding: 2px 6px;
    
    button {
      width: 28px;
      height: 28px;
      
      svg {
        width: 16px;
        height: 16px;
      }
    }
    
    .demo-zoom-level {
      font-size: var(--font-size-xs);
      min-width: 40px;
    }
  }
}

.demo-modal-body {
  width: 100%;
  height: 100%;
  position: relative;
  overflow: auto; // Allow scrolling when zoomed
  z-index: 1; // Ensure content appears above the grid background
  
  .demo-loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: var(--font-size-lg);
    color: #666;
    font-weight: var(--font-weight-medium);
  }
  
  .demo-custom {
    width: 100%;
    height: 100%;
    overflow: auto; // Allow scrolling when iframe is scaled
    display: flex;
    align-items: flex-start;
    justify-content: center;
    
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
      transform-origin: top center;
      transition: transform 0.2s ease;
    }
  }
}

// Prevent body scroll when modal is open
body.demo-modal-open {
  overflow: hidden;
}

// Inline Demo Styles
.demo-inline-container {
  width: 100%;
  height: 100%;
  position: relative;
  background: #f5f5f5;
  border-radius: 0;
  overflow: hidden;
  min-height: 500px;
  z-index: 10; // Ensure container is above trailer content
  
  // Blueprint/drafting table background - on the container, not scaled
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
      repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(0, 0, 0, 0.02) 50px, rgba(0, 0, 0, 0.02) 51px),
      repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(0, 0, 0, 0.02) 50px, rgba(0, 0, 0, 0.02) 51px);
    background-size: 51px 51px;
    background-position: center center;
    pointer-events: none;
    z-index: 1;
  }
  
  // Border frame - also fixed, not scaled
  &::after {
    content: '';
    position: absolute;
    top: 10px;
    left: 10px;
    right: 10px;
    bottom: 10px;
    border: 1px solid rgba(0, 0, 0, 0.03);
    border-radius: 2px;
    pointer-events: none;
    z-index: 1;
  }
  
  @media (max-width: variables.$mobile-breakpoint) {
    min-height: 300px;
  }
  
  // Demo controls overlay
  .demo-inline-controls {
    position: absolute;
    top: 12px;
    left: 12px;
    right: 12px;
    display: flex;
    justify-content: flex-end; // Changed from space-between since we only have right controls now
    align-items: center;
    z-index: 200; // Above iframe
    pointer-events: none; // Allow clicks through except on buttons
    
    > * {
      pointer-events: auto; // Re-enable clicks on children
    }
    
    @media (max-width: variables.$mobile-breakpoint) {
      top: 12px;
      left: 12px;
      right: 12px;
    }
  }
  
  // Right side controls container
  .demo-controls-right {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  // All control buttons use dynamic-back-button styling
  .demo-control-button {
    // Appearance - always black button with white text
    background-color: rgb(0, 0, 0) !important;
    color: rgb(255, 255, 255) !important;
    border-radius: 12px;
    box-shadow: none;
    border: none;
    
    // Layout
    display: flex;
    align-items: center;
    gap: 0;
    padding: 4px 10px;
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    flex-shrink: 0;
    width: auto;
    text-decoration: none;
    transition: all 0.2s ease;
    
    svg {
      width: 16px;
      height: 16px;
      margin-right: 6px;
      transition: transform 0.3s ease;
      flex-shrink: 0;
    }
    
    span {
      line-height: var(--line-height-normal);
    }
    
    &:hover {
      background-color: rgba(0, 0, 0, 0.8) !important;
      color: rgb(255, 255, 255) !important;
      transform: none; // Override previous transform
      box-shadow: none; // Override previous box-shadow
    }
    
    &:active {
      background-color: rgba(0, 0, 0, 0.9) !important;
      color: rgb(255, 255, 255) !important;
      transform: none; // Override previous transform
    }
    
    &:focus {
      outline: 2px solid var(--focus-ring-color, Highlight);
      outline-offset: 2px;
    }
    
    &.demo-fullscreen-button,
    &.demo-exit-fullscreen-button {
      padding: 4px 8px; // Smaller padding for icon-only button
      
      svg {
        margin-right: 0; // No margin for icon-only button
      }
    }
    
    // Hide text on mobile
    @media (max-width: variables.$mobile-breakpoint) {
      padding: 4px 8px;
      
      span {
        display: none;
      }
      
      svg {
        margin-right: 0;
      }
    }
  }
  
  // Zoom controls container - now a group of buttons
  .demo-zoom-inline {
    display: flex;
    align-items: center;
    gap: 0;
    background-color: rgb(0, 0, 0);
    border-radius: 12px;
    padding: 0;
    overflow: hidden;
    
    .demo-control-button {
      border-radius: 0;
      padding: 4px 8px;
      
      svg {
        margin-right: 0;
      }
      
      &:first-child {
        border-radius: 12px 0 0 12px;
      }
      
      &:last-child {
        border-radius: 0 12px 12px 0;
      }
      
      &:hover {
        background-color: rgba(0, 0, 0, 0.8) !important;
      }
    }
    
    .demo-zoom-level {
      color: white;
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-medium);
      min-width: 45px;
      text-align: center;
      user-select: none;
      padding: 4px 8px;
      background-color: rgb(0, 0, 0);
      line-height: var(--line-height-normal);
    }
  }
  
  .demo-inline-loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: #333;
    z-index: 2;
    
    .demo-loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-top-color: #333;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    
    p {
      margin: 0;
      font-size: var(--font-size-sm);
      opacity: 0.8;
    }
  }
  
  // Iframe wrapper for proper zoom scaling
  .demo-iframe-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    z-index: 100; // Above grid pattern
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; // Clip scaled content
  }

  .demo-inline-iframe {
    width: 100%;
    height: 100%;
    border: none;
    background: transparent;
  }
  
  &.demo-loaded {
    .demo-inline-loading {
      display: none;
    }
  }
  
  .demo-error {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: #cc0000;
    z-index: 2;
    
    p {
      margin: 0;
      font-size: var(--font-size-sm);
    }
  }
  
  .demo-placeholder {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: rgba(0, 0, 0, 0.4);
    z-index: 2;
    
    p {
      margin: 0;
      font-size: var(--font-size-sm);
    }
  }
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

// Ensure trailer hero handles inline demos properly
.project-trailer-hero {
  .trailer-content {
    .demo-inline-container {
      width: 100%;
      height: 100%;
    }
  }
}

// Dynamic height calculation for inline demos
.demo-inline-active {
  // Convert to flexbox layout for proper space distribution
  .above-the-fold-preview {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    overflow: hidden;
  }
  
  .project-trailer-hero {
    // Switch from absolute to relative positioning
    position: relative;
    height: 70%; // Increased to give more space to demo
    min-height: 450px;
    max-height: 75vh; // Increased cap for better demo visibility
    flex: 0 0 auto;
    
    @media (max-width: variables.$mobile-breakpoint) {
      height: 65%; // More space on mobile too
      min-height: 350px;
      max-height: 65vh;
    }
    
    .trailer-content {
      height: 100%;
      
      .demo-inline-container {
        height: 100%;
        border-radius: 0;
        
        &.demo-loaded {
          // Ensure loaded demos respect the container height
          .demo-inline-iframe {
            max-height: 100%; // Full height edge to edge
            
            @media (max-width: variables.$mobile-breakpoint) {
              max-height: 100%; // Full height edge to edge
            }
          }
        }
      }
    }
  }
  
  // Make content wrapper relative and auto-sized
  .above-fold-content-wrapper {
    position: relative;
    bottom: auto;
    flex: 0 0 auto;
    min-height: auto; // Let content determine height
    height: auto;
    
    // Completely remove the gradient overlay for inline demos
    &::before {
      display: none !important; // Force removal of overlay
    }
  }
}

// Fullscreen demo mode styles - high specificity to override spotlight modal
.project-trailer-hero.demo-fullscreen {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100dvw !important;
  height: 100dvh !important;
  max-height: 100dvh !important;
  z-index: 9999 !important;
  background: #f5f5f5 !important; // Force override any modal backgrounds
  animation: expandToFullscreen 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
              height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  
  // Add grid background pattern - higher opacity for visibility
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    background-color: #f5f5f5 !important; // Ensure base background is visible
    background-image: 
      repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(0, 0, 0, 0.08) 50px, rgba(0, 0, 0, 0.08) 51px),
      repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(0, 0, 0, 0.08) 50px, rgba(0, 0, 0, 0.08) 51px);
    background-size: 51px 51px;
    background-position: center center;
    pointer-events: none;
    z-index: 1; // Above the background but below content
  }
  
  // Border frame
  &::before {
    content: '';
    position: absolute;
    top: 10px;
    left: 10px;
    right: 10px;
    bottom: 10px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 2px;
    pointer-events: none;
    z-index: 0;
    background: none !important; // Remove any gradient overlays
  }
  
  // Dark mode support
  @media (prefers-color-scheme: dark) {
    background: #1a1a1a !important; // Force override any modal backgrounds
    
    &::after {
      background-color: #1a1a1a !important; // Ensure base background is visible in dark mode
      background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(255, 255, 255, 0.08) 50px, rgba(255, 255, 255, 0.08) 51px),
        repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(255, 255, 255, 0.08) 50px, rgba(255, 255, 255, 0.08) 51px);
    }
    
    &::before {
      border-color: rgba(255, 255, 255, 0.12);
    }
  }
  
  .trailer-content {
    height: 100%;
    position: relative;
    z-index: 2; // Above grid background
    background: transparent !important; // Allow grid background to show through
    
    .demo-inline-container {
      height: 100%;
      border-radius: 0 !important; // Remove rounded corners in fullscreen
      background: transparent !important; // Make container transparent in fullscreen
      
      // Hide the inline container's own grid background in fullscreen
      &::before,
      &::after {
        display: none !important;
      }
      
      // Make controls absolutely positioned in fullscreen mode
      .demo-inline-controls {
        position: absolute !important;
        top: 12px !important;
        left: 12px !important;
        right: 12px !important;
        z-index: 200 !important;
      }
      
      .demo-iframe-wrapper {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        z-index: 10; // Above everything else in the container
      }
    }
  }
}

// Body state when demo is fullscreen
body.demo-fullscreen-active {
  overflow: hidden;
}

// Animation for expanding to fullscreen - no opacity change
@keyframes expandToFullscreen {
  from {
    transform: scale(0.95);
  }
  to {
    transform: scale(1);
  }
}

// Ensure fullscreen demos override any spotlight modal background
.project-trailer-hero.demo-fullscreen,
body.demo-fullscreen-active .project-trailer-hero.demo-fullscreen {
  background: #f5f5f5 !important;
  
  @media (prefers-color-scheme: dark) {
    background: #1a1a1a !important;
  }
}


// Mobile-specific demo button fixes
@media (max-width: variables.$mobile-breakpoint) {
  .demo-button {
    padding: 8px 16px;
    font-size: var(--font-size-sm);
    line-height: normal;
    gap: 6px;
    
    svg {
      width: 14px;
      height: 14px;
    }
  }
  
  // Fix for any button with "Try the" text
  button:contains("Try the") {
    line-height: normal !important;
  }
}

// Animations
@keyframes modalFadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes modalFadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

@keyframes modalSlideIn {
  from {
    transform: scale(0.9);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes modalSlideOut {
  from {
    transform: scale(1);
    opacity: 1;
  }
  to {
    transform: scale(0.9);
    opacity: 0;
  }
}

