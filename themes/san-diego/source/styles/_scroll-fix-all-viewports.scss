// Comprehensive scroll fix for all viewports
@use 'variables';

// Desktop (> 1024px)
@media (min-width: calc(variables.$tablet-breakpoint + 1px)) {
  .blog {
    .blog-content {
      // Blog content should not scroll, just contain (unless dynamic content)
      &:not(.has-dynamic-content) {
        overflow: hidden !important;
        height: calc(100dvh - 24px); // Account for margins
        
        .content-inner-wrapper {
          // Inner wrapper should fill parent and not scroll
          height: 100% !important;
          overflow: hidden !important;
          display: flex;
          flex-direction: column;
          
          .tabs-wrapper {
            flex-shrink: 0;
          }
          
          .content-wrapper {
            // Content wrapper handles all scrolling
            flex: 1;
            min-height: 0; // Important for flexbox
            overflow-y: auto !important;
            overflow-x: hidden !important;
            -webkit-overflow-scrolling: touch;
            
            // Scrollbar styling
            &::-webkit-scrollbar {
              width: 6px;
            }
            
            &::-webkit-scrollbar-track {
              background: transparent;
            }
            
            &::-webkit-scrollbar-thumb {
              background-color: rgb(0 0 0 / 20%);
              border-radius: 3px;
              
              @media (prefers-color-scheme: dark) {
                background-color: rgb(255 255 255 / 20%);
              }
            }
          }
        }
      }
    }
  }
}

// Tablet (769px - 1024px)
@media (min-width: calc(variables.$mobile-breakpoint + 1px)) and (max-width: variables.$tablet-breakpoint) {
  .blog {
    .blog-content {
      &:not(.has-dynamic-content) {
        overflow: hidden !important;
        height: calc(100dvh - 24px);
        
        .content-inner-wrapper {
          height: 100% !important;
          overflow: hidden !important;
          display: flex;
          flex-direction: column;
          
          .tabs-wrapper {
            flex-shrink: 0;
          }
          
          .content-wrapper {
            flex: 1;
            min-height: 0;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            -webkit-overflow-scrolling: touch;
          }
        }
      }
    }
  }
}

// Mobile (<= 768px) - Critical for iOS Safari
// These styles use pure media queries to work immediately without waiting for JS
@media (max-width: variables.$mobile-breakpoint) {
  // iOS Safari requires body to be scrollable for toolbar collapse
  // DO NOT use overflow: hidden on html/body for iOS Safari compatibility
  html {
    height: 100%;
    // Let the page scroll naturally - this triggers Safari toolbar collapse
  }

  body {
    min-height: 100%;
    min-height: 100svh; // Use svh for Safari (accounts for dynamic toolbar)
    // overflow-y: visible is critical for Safari toolbar to collapse
    overflow-y: visible;
    overscroll-behavior-y: none;
  }

  .blog {
    // Blog should flow naturally, not be fixed height
    min-height: 100svh;
    height: auto;
    display: flex;
    flex-direction: column;
    // overflow: visible allows Safari to recognize scrollable content
    overflow: visible;

    .blog-header {
      // Header scrolls with the content
      height: auto;
      min-height: auto;
      flex-shrink: 0;
      position: relative;
      margin-bottom: 0;
      // Ensure header doesn't prevent scroll
      overflow: visible;
    }

    .blog-content {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      // Critical: overflow visible for iOS Safari scroll recognition
      overflow: visible;
      // Don't set fixed height - let content determine height
      height: auto;

      // TABS: sticky positioning for scroll-aware behavior
      .tabs-wrapper {
        position: sticky;
        top: 0;
        z-index: 1000;
        padding: 12px 16px;
        background: variables.$body-bg;
        flex-shrink: 0;

        @media (prefers-color-scheme: dark) {
          background: variables.$body-bg-dark;
        }

        // When JS adds is-sticky-fixed class for enhanced behavior
        &.is-sticky-fixed {
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
      }

      // Placeholder inserted by JS to prevent content jump when tabs become fixed
      .tabs-sticky-placeholder {
        flex-shrink: 0;
      }

      // No padding-top needed - placeholder handles this dynamically
      .content-inner-wrapper {
        padding-top: 0;
        height: auto;
        overflow: visible;
      }

      .content-wrapper {
        height: auto;
        overflow: visible;
        // Add padding to ensure bottom content is visible above safe area/controls
        padding-bottom: calc(24px + env(safe-area-inset-bottom, 20px));
      }

      // Tab content panes should flow naturally
      #postsContent,
      #projectsContent,
      #waresContent {
        height: auto;
        overflow: visible;
      }
    }
  }

  // Dark mode forced support for sticky tabs
  body.dark-mode-forced .blog .blog-content .tabs-wrapper {
    background: variables.$body-bg-dark;
  }

  body.dark-mode-forced .blog .blog-content .tabs-wrapper.is-sticky-fixed {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }
}

// Fix for dynamic content (posts/projects opened)
.blog-content.has-dynamic-content {
  @media (min-width: calc(variables.$mobile-breakpoint + 1px)) {
    .content-wrapper,
    .content-inner-wrapper {
      height: auto !important;
      min-height: 0 !important;
      overflow: visible !important;
    }
  }
}

// Ensure blog post list items always use the unified text color token
.blog .post-list-item ul li,
.blog .post-list-item ol li,
.blog .blog-list .post-list-item ul li,
.blog .blog-list .post-list-item ol li {
	color: var(--blog-list-text-color) !important;
}
