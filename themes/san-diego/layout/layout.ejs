<!DOCTYPE html>
<html lang="<%= config.language %>">
    <head>    
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
        <%- partial('_partial/head') %>
    </head>
    <body>
        <%- partial('_partial/skip-navigation') %>
        <%- partial('_partial/loading-skull') %>
		<%- body %>

        <%- js('js/device-detection.js') %>
        <%- js('js/profile-header-compact.js') %>
        <%- js('js/code-sandbox.js') %>
        <!-- main.js already loaded in head.ejs -->
        <% if (theme.search == true && page.type == 'search') { %>
        <%- js('js/search.js') %>
        <% } %>

        <% if (theme.scroll_reveal) { %>
        <script src="https://unpkg.com/scrollreveal@4.0.9/dist/scrollreveal.min.js" 
                integrity="sha384-vPeKjrQ3Y7cRNimyiSpBLaTBiMxcDc5dNfD7jFXIBx6P0rl75clO6mUVJitIJQWP" 
                crossorigin="anonymous"></script>
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 150, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        <% } %>

        <!-- mobile-tabs.js and sound-effects.js already loaded in head.ejs -->
        <!-- Additional scripts -->
        
        <!-- Cloudflare Web Analytics -->
        <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "e8fdac6a36f74464bcf2d55fbb7f0ca2"}'></script>
        <!-- End Cloudflare Web Analytics -->
        
        <script>
        // Loading screen management for all pages
        function hideLoadingScreen() {
            document.body.classList.add('loaded');
            const loadingScreen = document.querySelector('.loading-screen');
            if (loadingScreen) {
                loadingScreen.style.opacity = '0';
                setTimeout(function() {
                    if (loadingScreen) loadingScreen.style.display = 'none';
                }, 300);
            }
        }

        // Hide loading screen when page is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(hideLoadingScreen, 500);
            });
        } else {
            setTimeout(hideLoadingScreen, 100);
        }

        // Additional safeguard
        window.addEventListener('load', function() {
            setTimeout(hideLoadingScreen, 200);
        });

        // Handle back/forward navigation
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                document.body.classList.add('loaded');
                hideLoadingScreen();
            }
        });
        </script>
    </body>
</html>
