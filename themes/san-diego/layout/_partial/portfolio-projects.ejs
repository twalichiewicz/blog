<div id="projectsContent" class="portfolio-list portfolio-list--redesigned" role="tabpanel" aria-labelledby="tab-portfolio">
    <div class="column-title portfolio-column-title">Projects</div>
    
    <!-- Filters dropdown -->
    <div class="portfolio-controls">
        <div class="filters-dropdown-container">
            <button class="posts-only-button filters-toggle" id="filtersToggle">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="filter-icon" style="width: 14px; height: 14px; margin-right: 4px; vertical-align: -2px;">
                    <path d="M3 6h18M7 12h10M9 18h6"/>
                </svg>
                Filters
                <span class="filter-count-pip" style="display: none;">0</span>
            </button>
            
            <div class="filters-dropdown" id="filtersDropdown" style="display: none;">
                <div class="filters-dropdown-content">
                    <div class="filters-dropdown-header">
                        <h3>Filter Projects</h3>
                        <button class="filter-clear">Clear all</button>
                    </div>
                    
                    <div class="portfolio-filters">
                        <% if (typeof filterCategories !== 'undefined') { %>
                            <% Object.entries(filterCategories).forEach(([category, filters]) => { %>
                                <div class="filter-category" data-category="<%- category %>">
                                    <div class="filter-category-label"><%- category.charAt(0).toUpperCase() + category.slice(1) %></div>
                                    <div class="filter-pills">
                                        <% filters.forEach(filter => { %>
                                            <button class="filter-pill" data-filter="<%- filter.toLowerCase().replace(/\s+/g, '-') %>" data-category="<%- category %>">
                                                <%- filter %>
                                            </button>
                                        <% }) %>
                                    </div>
                                </div>
                            <% }) %>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <% if (projectPosts.length > 0) { %>
        <% 
        // Separate featured (with writeups) and non-featured projects
        const featuredProjects = [];
        const nonFeaturedProjects = {};
        
        projectPosts.forEach(function(post) {
            if (!post.draft) {
                if (post.has_writeup !== false) {
                    featuredProjects.push(post);
                } else {
                    const company = post.company || 'Other Projects';
                    if (!nonFeaturedProjects[company]) {
                        nonFeaturedProjects[company] = [];
                    }
                    nonFeaturedProjects[company].push(post);
                }
            }
        });
        
        // Sort featured projects by date (most recent first)
        featuredProjects.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
        
        // Get company order for non-featured section
        const companyOrder = config.portfolio?.companies?.order || [
            'Autodesk',
            'Human Interest', 
            'Common Cents Lab',
            'Lyra Health',
            'Maisha Meds',
            'Other Projects'
        ];
        
        %>
        
        <%
        // Define filter categories (moved outside conditionals to be accessible in modal)
        const filterCategories = {
            discipline: ['UX Design', 'UI Design', 'Research', 'Brand Design', 'Systems Design'],
            type: ['Web App', 'Mobile App', 'Design System', 'Desktop App', 'Platform'],
            skills: ['Prototyping', 'User Research', 'Visual Design', 'Data Viz', 'Strategy'],
            industry: ['FinTech', 'Enterprise', 'Healthcare', 'Creative Tools', 'Social Impact']
        };
        %>
        
        <!-- Featured Projects Grid -->
        <div class="portfolio-featured-grid">
            <% featuredProjects.forEach(function(post) { %>
                <a href="<%- url_for(post.path) %>" class="portfolio-item-wrapper" 
                   data-discipline="<%- (post.tags?.discipline || []).join(' ').toLowerCase().replace(/\s+/g, '-') %>"
                   data-type="<%- (post.tags?.type || []).join(' ').toLowerCase().replace(/\s+/g, '-') %>"
                   data-skills="<%- (post.tags?.skills || []).join(' ').toLowerCase().replace(/\s+/g, '-') %>"
                   data-industry="<%- (post.tags?.industry || []).join(' ').toLowerCase().replace(/\s+/g, '-') %>">
                    <div class="portfolio-item portfolio-item--featured">
                        <% if (post.cover_image) { %>
                            <div class="notebook">
                                <!-- Back cover (base layer) -->
                                <div class="back-cover"></div>
                                
                                <!-- Page block (middle pages) -->
                                <div class="page-block"></div>
                                
                                <!-- Additional page layer for thickness -->
                                <div class="page-layer-2"></div>
                                
                                <!-- Inside back cover -->
                                <div class="inside-back-cover"></div>
                                
                                <!-- Inside pages with content -->
                                <div class="inside-pages">
                                    <% 
                                    // Process cover image for paperclip photo
                                    let coverImagePath = post.cover_image;
                                    const isVideo = /\.(mp4|webm|ogg|mov)$/i.test(post.cover_image);
                                    
                                    if (isVideo && post.cover_video_poster) {
                                        // Use poster for video covers
                                        coverImagePath = post.cover_video_poster;
                                    }
                                    
                                    if (coverImagePath) {
                                        if (!coverImagePath.startsWith('/') && !coverImagePath.startsWith('http')) {
                                            if (/^\d{4}\/\d{2}\/\d{2}\//.test(coverImagePath)) {
                                                coverImagePath = '/' + coverImagePath;
                                            } else {
                                                coverImagePath = post.path + coverImagePath;
                                            }
                                        }
                                    }
                                    %>
                                    <div class="paperclip-photo">
                                        <img src="<%- coverImagePath ? url_for(coverImagePath) : '' %>" alt="<%- post.title %>" />
                                    </div>
                                </div>
                                
                                <!-- Inside front cover -->
                                <div class="inside-front-cover"></div>
                                
                                <!-- Front cover (top layer) -->
                                <div class="front-cover"></div>
                            </div>
                        <% } %>
                    </div>
                    <div class="portfolio-info">
                        <h4 class="portfolio-title"><%- post.display_name || post.title %></h4>
                        <% if (post.display_description || post.byline) { %>
                            <p class="portfolio-byline"><%- post.display_description || post.byline %></p>
                        <% } %>
                    </div>
                </a>
            <% }) %>
        </div>
        
        <% if (Object.keys(nonFeaturedProjects).length > 0) { %>
            <!-- Even More Section -->
            <div class="portfolio-more-section">
                <div class="portfolio-more-transition"></div>
                <div class="portfolio-more-content">
                    <h2 class="portfolio-more-title">That's just scratching the surface</h2>
                    
                    <div class="portfolio-more-grid">
                        <% 
                        // Sort companies by predefined order
                        const sortedCompanies = Object.keys(nonFeaturedProjects).sort((a, b) => {
                            const indexA = companyOrder.indexOf(a);
                            const indexB = companyOrder.indexOf(b);
                            
                            if (indexA !== -1 && indexB !== -1) {
                                return indexA - indexB;
                            }
                            
                            if (indexA !== -1) return -1;
                            if (indexB !== -1) return 1;
                            
                            if (a === 'Other Projects') return 1;
                            if (b === 'Other Projects') return -1;
                            return a.localeCompare(b);
                        });
                        %>
                        
                        <% sortedCompanies.forEach(function(company) { %>
                            <div class="portfolio-more-company">
                                <h3 class="portfolio-more-company-name">
                                    <%- company %>
                                    <% 
                                    const companyYears = config.portfolio?.companies?.years || {
                                        'Autodesk': '2019—Present',
                                        'Human Interest': '2017—2019',
                                        'Common Cents Lab': '2016—2017',
                                        'Lyra Health': '2015',
                                        'Maisha Meds': '2013-2014'
                                    };
                                    if (companyYears[company]) { %>
                                        <span class="company-years"><%- companyYears[company] %></span>
                                    <% } %>
                                </h3>
                                <div class="portfolio-more-projects">
                                    <% nonFeaturedProjects[company].forEach(function(post) { %>
                                        <div class="portfolio-more-project"><%- post.title %></div>
                                    <% }) %>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                </div>
            </div>
        <% } %>
    <% } else { %>
        <%- partial('_partial/loading-skull') %>
    <% } %>
</div>

