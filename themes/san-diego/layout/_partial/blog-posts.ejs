<div id="postsContent" class="blog-list" role="tabpanel" aria-labelledby="tab-blog">
    <div class="column-title blog-column-title">Posts</div>
    
    <!-- Add search bar -->
    <div class="search-container">
        <div class="search-input-wrapper">
            <div class="search-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 21l-4.35-4.35"/>
                    <path d="M15.5 10.5a5 5 0 1 0-10 0 5 5 0 0 0 10 0z"/>
                </svg>
            </div>
            <input type="text" id="postSearch" placeholder="Search words..." class="search-input" aria-label="Search blog posts">
            <button class="search-clear" aria-label="Clear search" style="display: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <button class="posts-only-button" data-filter="posts"><span class="button-text-full">Posts only</span></button>
    </div>
    
    <% if (blogPosts.length > 0) { %>
        <% blogPosts.forEach(function(post, index) { %>
            <% 
            // Generate unique post ID from title or use index
            const postId = 'post-' + (post.slug || post.title.toLowerCase().replace(/[^\w]+/g, '-') || index);
            
            // Determine if this is a long-form post (has <a> in h3 and long: true)
            const isLongPost = post.long === true && !post.type;
            const classNames = [];
            if (post.type === 'link') {
                classNames.push('post-link');
            }
            if (isLongPost) {
                classNames.push('post-long');
            }
            %>
            <% 
            // Check if this is a regular blog post (not link or short)
            const isRegularPost = !post.type && !post.short;
            %>
            
            <% if (isRegularPost) { %>
                <%# Use the Substack-style post-link partial for regular posts %>
                <%- partial('post-link', { post: post }) %>
            <% } else { %>
                <%# Keep existing rendering for link posts and short posts %>
                <% if (isLongPost) { %>
                    <a href="<%- url_for(post.path) %>" class="post-link-wrapper no-external-indicators">
                <% } %>
                <article class="post-list-item <%= classNames.join(' ') %>" id="<%= postId %>">
                    <div class="post-byline">
                        <%= date(post.date, 'MMMM D, YYYY') %> • 
                        <%= post.type === 'link' ? 'Link' : (post.short ? 'Musing' : 'Post') %>
                    </div>
                    <% if (post.type === 'link') { %>
                        <div class="link-share no-external-indicators <%= post.workspace_os_special ? 'workspace-os-special' : '' %>">
                            <% if (post.workspace_os_special) { %>
                                <div class="starfield-background">
                                    <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
                                    <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
                                    <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
                                    <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
                                </div>
                                <style>
                                .workspace-os-special {
                                    position: relative;
                                    background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%);
                                    border-radius: 8px;
                                    padding: 20px;
                                    overflow: hidden;
                                }
                                .starfield-background {
                                    position: absolute;
                                    top: 0;
                                    left: 0;
                                    right: 0;
                                    bottom: 0;
                                    pointer-events: none;
                                }
                                .star {
                                    position: absolute;
                                    background: white;
                                    border-radius: 50%;
                                    width: 2px;
                                    height: 2px;
                                    animation: twinkle 3s infinite ease-in-out;
                                }
                                .star:nth-child(1) { top: 20%; left: 15%; animation-delay: 0s; }
                                .star:nth-child(2) { top: 80%; left: 25%; animation-delay: 0.5s; }
                                .star:nth-child(3) { top: 40%; left: 75%; animation-delay: 1s; }
                                .star:nth-child(4) { top: 70%; left: 60%; animation-delay: 1.5s; }
                                .star:nth-child(5) { top: 30%; left: 40%; animation-delay: 2s; }
                                .star:nth-child(6) { top: 85%; left: 80%; animation-delay: 2.5s; }
                                .star:nth-child(7) { top: 15%; left: 65%; animation-delay: 0.3s; }
                                .star:nth-child(8) { top: 60%; left: 20%; animation-delay: 0.8s; }
                                .star:nth-child(9) { top: 45%; left: 90%; animation-delay: 1.3s; }
                                .star:nth-child(10) { top: 75%; left: 10%; animation-delay: 1.8s; }
                                .star:nth-child(11) { top: 25%; left: 85%; animation-delay: 2.3s; }
                                .star:nth-child(12) { top: 90%; left: 45%; animation-delay: 0.1s; }
                                .star:nth-child(13) { top: 10%; left: 30%; animation-delay: 0.6s; }
                                .star:nth-child(14) { top: 55%; left: 70%; animation-delay: 1.1s; }
                                .star:nth-child(15) { top: 35%; left: 55%; animation-delay: 1.6s; }
                                .star:nth-child(16) { top: 65%; left: 35%; animation-delay: 2.1s; }
                                .star:nth-child(17) { top: 50%; left: 5%; animation-delay: 0.4s; }
                                .star:nth-child(18) { top: 5%; left: 80%; animation-delay: 0.9s; }
                                .star:nth-child(19) { top: 95%; left: 65%; animation-delay: 1.4s; }
                                .star:nth-child(20) { top: 40%; left: 15%; animation-delay: 1.9s; }
                                @keyframes twinkle {
                                    0%, 100% { opacity: 0.3; transform: scale(1); }
                                    50% { opacity: 1; transform: scale(1.5); }
                                }
                                .workspace-os-special .post-link-wrapper {
                                    background: rgba(255, 255, 255, 0.05);
                                    border: 1px solid rgba(255, 255, 255, 0.1);
                                    color: white;
                                    position: relative;
                                    z-index: 1;
                                }
                                .workspace-os-special .link-url {
                                    color: rgba(255, 255, 255, 0.7);
                                }
                                .workspace-os-special .external-icon {
                                    color: white;
                                }
                                @media (prefers-reduced-motion: reduce) {
                                    .star {
                                        animation: none;
                                        opacity: 0.6;
                                    }
                                }
                                </style>
                            <% } %>
                            <% if (post.content) { %>
                                <% 
                                // Strip script tags from link post content to prevent HTML breaking
                                const cleanContent = post.content
                                    .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                                    .replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi, '');
                                %>
                                <p><%- cleanContent %></p>
                            <% } %>
                            
                            <a href="<%= post.url %>" target="_blank" rel="noopener" class="post-list-item post-long post-link-wrapper">
                                <div class="link-text-group">
                                    <%= post.title %>
                                    <div class="link-source">
                                        <span class="link-url"><%= new URL(post.url).hostname %></span>
                                    </div>
                                </div>
                                <span class="external-icon">↗</span>
                            </a>
                        </div>
                    <% } else if (post.short) { %>
                        <%- post.content %>
                    <% } %>
                </article>
                <% if (isLongPost) { %>
                    </a>
                <% } %>
            <% } %>
            <% if (index < blogPosts.length - 1) { %>
                <hr class="post-separator">
            <% } %>
        <% }) %>
    <% } else { %>
        <!-- No posts to display -->
    <% } %>
</div>