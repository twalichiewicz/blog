class PropelVisualizations{constructor(){this.init(),this.setupCounters(),this.setupImageParallax(),this.setupMoneyPattern(),this.setupModalAnimations()}init(){this.setupVideo(),this.setupSpendingGraph(),this.setupTransactionData(),this.setupComparisonChart(),this.setupScrollAnimations()}setupCounters(){document.querySelectorAll(".counter").forEach(t=>{const e=t.closest(".stat-item"),o=parseFloat(e.dataset.value);this.animateOnScroll(e,()=>{this.animateValue(t,0,o,2e3)})})}animateValue(t,e,o,a){let r=null;const s=n=>{r||(r=n);const i=Math.min((n-r)/a,1),l=e+(o-e)*this.easeOutCubic(i);t.textContent.includes("in")?t.textContent=`1 in ${Math.floor(l)}`:t.textContent=Math.floor(l),i<1&&window.requestAnimationFrame(s)};window.requestAnimationFrame(s)}easeOutCubic(t){return 1-Math.pow(1-t,3)}setupImageParallax(){const t=document.querySelectorAll(".solution-image, .analysis-image");let e=!1;const o=()=>{t.forEach(t=>{const e=t.getBoundingClientRect(),o=window.innerHeight;if(e.top<o&&e.bottom>0){const a=(o-e.top)/(o+e.height)*30;t.style.transform=`translate3d(0, ${a}px, 0)`}}),e=!1};window.addEventListener("scroll",()=>{e||(requestAnimationFrame(o),e=!0)},{passive:!0})}setupSpendingGraph(){const t=document.querySelector(".problem-visualization");if(!t)return;const e=document.createElement("canvas");t.appendChild(e);const o=getComputedStyle(document.documentElement),a=o.getPropertyValue("--propel-green-rgb").trim()||"0, 168, 98",r="#FFFFFF"===o.getPropertyValue("--propel-text").trim()?"255, 255, 255":"29, 29, 31",s=(o.getPropertyValue("--propel-border").trim(),e.getContext("2d").createLinearGradient(0,0,0,400));s.addColorStop(0,`rgba(${a}, 0.15)`),s.addColorStop(1,`rgba(${a}, 0)`);const n={labels:Array.from({length:31},(t,e)=>e+1),datasets:[{label:"Actual, 2016",data:Array.from({length:31},(t,e)=>0===e?100:2===e?70:6===e?40:e>=9&&e<=10?20:11===e?18:12===e?10:e>=13&&e<=15?9:18===e?5:e>=21&&e<=30?0:null),borderColor:"rgb(255, 105, 105)",backgroundColor:s,fill:!0,tension:.4,borderWidth:3,spanGaps:!0,pointRadius:0},{label:"Ideal",data:Array.from({length:31},(t,e)=>100*(1-e/30)),borderColor:`rgb(${a})`,borderDash:[5,5],fill:!1,tension:0,borderWidth:1.5,pointRadius:0},{label:"USDA, 2009",data:Array.from({length:31},(t,e)=>0===e?100:1===e?80:6===e?40:15===e?20:21===e?10:30===e?0:null),borderColor:"rgb(172, 142, 255)",borderDash:[2,2],fill:!1,stepped:!1,tension:0,borderWidth:1.5,spanGaps:!0,pointRadius:0}]},i=new Chart(e,{type:"line",data:n,options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:2e3,easing:"easeInOutQuart"},interaction:{intersect:!1,mode:"index"},plugins:{tooltip:{backgroundColor:"rgba(0, 0, 0, 0.85)",titleColor:"#FFFFFF",bodyColor:"rgba(255, 255, 255, 0.8)",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,padding:12,displayColors:!0,titleFont:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',weight:600,size:13},bodyFont:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',size:12},callbacks:{label:t=>`${t.dataset.label}: ${Math.round(t.raw)}%`}},legend:{display:!0,position:"top",align:"end",labels:{color:"var(--propel-text)",font:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',size:12},boxWidth:12,padding:15,usePointStyle:!1},maxHeight:40},annotation:{annotations:{line1:{type:"line",xMin:9,xMax:9,borderColor:`rgba(${r}, 0.3)`,borderWidth:1,shadowOffsetX:4,shadowBlur:8,shadowColor:`rgba(${r}, 0.1)`,label:{content:"9",enabled:!0,position:"top",backgroundColor:"transparent",color:`rgba(${r}, 1)`,font:{weight:"bold",size:14,family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},yAdjust:-10}}}}},scales:{y:{beginAtZero:!0,max:100,grid:{color:`rgba(${r}, 0.1)`,drawBorder:!1,drawTicks:!1},ticks:{font:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',size:12},color:"var(--propel-text-secondary)",padding:8,callback:t=>t%20==0?`${t}%`:"",stepSize:20},border:{display:!1},title:{display:!0,text:"Percentage of balance",color:"var(--propel-text)",font:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',size:14,weight:500},padding:{bottom:10}}},x:{grid:{display:!1,drawBorder:!1,drawTicks:!1},ticks:{font:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',size:12},color:"var(--propel-text-secondary)",padding:8,maxRotation:0,callback:t=>t%3==0?`${t}`:""},border:{display:!1},title:{display:!0,text:"Days after benefit deposit",color:"var(--propel-text)",font:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',size:14,weight:500},padding:{top:10}}}}}}),l=()=>{const t=e.getContext("2d").createLinearGradient(0,0,0,e.height),o=getComputedStyle(document.documentElement).getPropertyValue("--propel-green-rgb").trim()||"0, 168, 98",a="#FFFFFF"===getComputedStyle(document.documentElement).getPropertyValue("--propel-text").trim()?"255, 255, 255":"29, 29, 31";t.addColorStop(0,`rgba(${o}, 0.15)`),t.addColorStop(1,`rgba(${o}, 0)`),i.data.datasets[0].backgroundColor=t,i.data.datasets[0].borderColor=`rgb(${o})`,i.options.scales.y.grid.color=`rgba(${a}, 0.1)`,i.update("none")};window.addEventListener("resize",l),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",l),this.animateOnScroll(t,()=>{i.show(0)})}setupScrollAnimations(){document.querySelectorAll(".propel-case-study section").forEach(t=>{const e=t.querySelector(".content-wrap");e&&this.animateOnScroll(e,()=>{e.classList.add("visible");const t=e.children;Array.from(t).forEach((t,e)=>{setTimeout(()=>{if(t.classList.add("visible"),t.querySelectorAll("h1, h2, h3, p, .button-group, .app-store-button, blockquote, cite, .feature-card").forEach((t,e)=>{setTimeout(()=>{t.classList.add("visible")},100*e)}),t.classList.contains("features-grid")&&t.querySelectorAll(".feature-card").forEach((t,e)=>{setTimeout(()=>{t.classList.add("visible"),t.querySelectorAll("h3, p").forEach(t=>t.classList.add("visible"))},150*e)}),t.classList.contains("stats-grid")&&t.querySelectorAll(".stat-item").forEach((t,e)=>{setTimeout(()=>{t.classList.add("visible")},150*e)}),t.classList.contains("solution-showcase")){const e=t.querySelector(".solution-image"),o=t.querySelector(".solution-details");e&&e.classList.add("visible"),o&&(o.classList.add("visible"),o.querySelectorAll("h3, p").forEach(t=>t.classList.add("visible")))}if(t.classList.contains("impact-showcase")){const e=t.querySelectorAll(".impact-stat"),o=t.querySelector(".impact-quote");e.forEach((t,e)=>{setTimeout(()=>{t.classList.add("visible"),t.querySelectorAll("h3, p").forEach(t=>t.classList.add("visible"))},150*e)}),o&&setTimeout(()=>{o.classList.add("visible"),o.querySelectorAll("blockquote, cite").forEach(t=>t.classList.add("visible"))},150*e.length)}},200*e)})})})}setupTransactionData(){const t=document.querySelector(".transaction-visualization");if(!t)return;const e=t.offsetWidth,o=t.offsetHeight,a=new Two({width:e,height:o,autostart:!0}).appendTo(t);this.generateTransactionData().forEach(r=>{const s=a.makeCircle(r.x*e,r.y*o,4);s.fill="#ffffff",s.opacity=.6,s.translation.set(r.x*e,r.y*o+50),s.opacity=0,this.animateOnScroll(t,()=>{s.opacity=.6,s.translation.set(r.x*e,r.y*o)})})}setupComparisonChart(){const t=document.querySelector(".solution-comparison");if(!t)return;const e=this.generateSpendingData(!0),o=this.generateSpendingData(!1),a=document.createElement("canvas");t.appendChild(a),new Chart(a,{type:"line",data:{labels:Array.from({length:31},(t,e)=>e+1),datasets:[{label:"Before Fresh EBT",data:e,borderColor:"#ff6b6b",backgroundColor:"rgba(255, 107, 107, 0.1)",fill:!0},{label:"With Fresh EBT",data:o,borderColor:"#4ecdc4",backgroundColor:"rgba(78, 205, 196, 0.1)",fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:2e3,easing:"easeInOutQuart"}}})}generateSpendingData(t=!0){const e=[];let o=250;for(let a=0;a<31;a++)o-=t?o*(.2-.005*a):o*(.1-.002*a),e.push(Math.max(0,o));return e}generateTransactionData(){const t=[];for(let e=0;e<100;e++)t.push({x:Math.random(),y:Math.random(),amount:100*Math.random()});return t}animateOnScroll(t,e){if(!t)return;let o=!1;const a=()=>{const a=t.getBoundingClientRect(),s=window.innerHeight;a.top<s-.1*a.height&&a.bottom>.1*a.height&&(e(),window.removeEventListener("scroll",r)),o=!1},r=()=>{o||(requestAnimationFrame(a),o=!0)};a(),window.addEventListener("scroll",r,{passive:!0})}setupVideo(){const t=document.querySelector(".hero-video");t&&(t.addEventListener("loadeddata",()=>{t.style.opacity="1"}),t.addEventListener("error",()=>{}),setTimeout(()=>{0===t.readyState&&t.load()},1e3))}setupMoneyPattern(){const t=document.querySelector(".money-pattern");if(t)for(let e=0;e<20;e++){const e=document.createElement("span");e.textContent="ðŸ’¸",e.style.position="absolute",e.style.fontSize="32px",e.style.left=100*Math.random()+"vw",e.style.top=100*Math.random()+"vh",e.style.animation=`flyMoney ${10+20*Math.random()}s linear ${10*Math.random()}s infinite`,e.style.opacity="0",t.appendChild(e)}}setupModalAnimations(){const t=document.getElementById("tldrModal"),e=t.querySelector(".modal-content"),o=document.querySelectorAll("[data-open-modal]"),a=document.querySelectorAll("[data-close-modal]"),r=()=>{document.body.classList.add("modal-open"),t.classList.add("active"),requestAnimationFrame(()=>{e.classList.add("animate-in")})},s=()=>{e.classList.remove("animate-in"),e.classList.add("animate-out"),setTimeout(()=>{document.body.classList.remove("modal-open"),t.classList.remove("active"),e.classList.remove("animate-out")},300)};o.forEach(t=>{t.addEventListener("click",r)}),a.forEach(t=>{t.addEventListener("click",s)}),t.addEventListener("click",e=>{e.target===t&&s()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("active")&&s()})}}document.addEventListener("DOMContentLoaded",()=>{new PropelVisualizations,document.querySelectorAll(".tldr-button, .floating-tldr button").forEach(t=>{t.setAttribute("data-open-modal","tldr")}),document.querySelectorAll(".close-button").forEach(t=>{t.setAttribute("data-close-modal","tldr")});const t=document.querySelector('.hero-section svg[astro-icon="logo"]');if(t){t.querySelectorAll('path[fill="black"]:not([stroke])').forEach(t=>{t.setAttribute("fill","var(--propel-text)")}),t.querySelectorAll('path[stroke="black"]').forEach(t=>{t.setAttribute("stroke","var(--propel-text)"),"black"===t.getAttribute("fill")&&t.setAttribute("fill","var(--propel-text)")});const e=t.querySelector('path[fill="#8BC95A"]');e&&(e.setAttribute("fill","var(--propel-green)"),e.setAttribute("stroke","var(--propel-text)"))}});