!function(){"use strict";const t="portfolio-carousel-state";let e=null;class o{constructor(){this.container=document.querySelector(".portfolio-featured-grid"),this.container&&this.isMobile()&&(e&&e.destroy(),this.notebooks=Array.from(this.container.querySelectorAll(".portfolio-item-wrapper")),0!==this.notebooks.length&&(this.activeIndex=this.loadState(),this.isScrolling=!1,this.boundHandleScroll=this.handleScroll.bind(this),this.boundDocumentClick=this.handleDocumentClick.bind(this),this.boundBeforeUnload=this.handleBeforeUnload.bind(this),this.tabButtonHandlers=new Map,"true"===sessionStorage.getItem("portfolio-back-navigation")?(sessionStorage.removeItem("portfolio-back-navigation"),this.isInitialTabLoad=!1):this.isInitialTabLoad=!sessionStorage.getItem("portfolio-tab-shown"),e=this,this.init()))}isMobile(){return window.innerWidth<=768}loadState(){try{const e=localStorage.getItem(t);if(e)return JSON.parse(e).activeIndex||0}catch(t){}return 0}saveState(){try{localStorage.setItem(t,JSON.stringify({activeIndex:this.activeIndex,timestamp:Date.now()}))}catch(t){}}init(){this.container.classList.add("notebook-carousel-mobile"),document.body.classList.add("notebook-carousel-active"),this.container.addEventListener("scroll",this.boundHandleScroll),document.addEventListener("click",this.boundDocumentClick),this.tabButtons=Array.from(document.querySelectorAll(".tab-button")),this.tabButtons.forEach(t=>{const e=()=>{"portfolio"!==t.dataset.type&&this.saveState()};this.tabButtonHandlers.set(t,e),t.addEventListener("click",e)}),window.addEventListener("beforeunload",this.boundBeforeUnload),requestAnimationFrame(()=>{this.isInitialTabLoad?(this.scrollToNotebook(0,!1),sessionStorage.setItem("portfolio-tab-shown","true"),this.isInitialTabLoad=!1):(this.scrollToNotebook(this.activeIndex,!1),this.activateNotebook(this.activeIndex))})}handleScroll(){this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.snapToNearest()},50)}snapToNearest(){const t=this.container.getBoundingClientRect(),e=t.left+t.width/2;let o=0,i=1/0;this.notebooks.forEach((t,s)=>{const n=t.getBoundingClientRect(),a=n.left+n.width/2,r=Math.abs(a-e);r<i&&(i=r,o=s)}),o!==this.activeIndex&&(this.activateNotebook(o),this.saveState()),this.scrollToNotebook(o,!0)}scrollToNotebook(t,e=!0){const o=this.notebooks[t];if(!o)return;const i=this.container.offsetWidth,s=o.offsetWidth,n=o.offsetLeft-(i-s)/2;this.container.scrollTo({left:n,behavior:e?"smooth":"auto"})}activateNotebook(t){t<0||t>=this.notebooks.length||(this.notebooks.forEach((e,o)=>{e.classList.remove("carousel-active"),e.classList.toggle("carousel-inactive",o!==t)}),this.notebooks[t].classList.add("carousel-active"),this.activeIndex=t,window.playBookSound&&window.playBookSound())}checkAndRestorePosition(){const t=this.loadState();t!==this.activeIndex&&(this.activeIndex=t,this.scrollToNotebook(t,!1),this.activateNotebook(t))}handleDocumentClick(t){const e=t.target.closest("a");e&&e.href&&!e.href.startsWith("#")&&this.saveState()}handleBeforeUnload(){this.saveState()}destroy(){this.saveState(),this.container&&(this.container.classList.remove("notebook-carousel-mobile"),this.container.removeEventListener("scroll",this.boundHandleScroll)),document.body.classList.remove("notebook-carousel-active"),document.removeEventListener("click",this.boundDocumentClick),window.removeEventListener("beforeunload",this.boundBeforeUnload),this.tabButtons&&this.tabButtons.forEach(t=>{const e=this.tabButtonHandlers.get(t);e&&t.removeEventListener("click",e)}),this.tabButtonHandlers.clear(),this.notebooks.forEach(t=>{t.classList.remove("carousel-active","carousel-inactive")}),e===this&&(e=null)}}function i(t=!1){const i=document.querySelector(".portfolio-featured-grid");if(!i)return;if(window.innerWidth>768)return;const s=document.getElementById("projectsContent");if(s&&"none"!==window.getComputedStyle(s).display){if(t&&sessionStorage.setItem("portfolio-back-navigation","true"),!e||e.container&&e.container.isConnected&&e.container===i||e.destroy(),e&&e.container&&e.container.classList.contains("notebook-carousel-mobile")){const t=e.loadState();return void(t!==e.activeIndex&&(e.activeIndex=t,e.scrollToNotebook(t,!1),e.activateNotebook(t)))}new o}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i(),document.addEventListener("contentLoaded",i),document.addEventListener("portfolio-loaded",i),window._notebookCarousel={getInstance:()=>e,reinitialize:i}}();