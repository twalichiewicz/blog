import{CarouselState}from"./carousel-state.js";import{CarouselView}from"./carousel-view.js";import{CarouselGestures}from"./carousel-gestures.js";import{CarouselSpotlight}from"./carousel-spotlight.js";import{CarouselKeyboard}from"./carousel-keyboard.js";import{CarouselMedia}from"./carousel-media.js";export class ModernCarousel{static instances=new WeakMap;static activeSpotlight=null;constructor(e,t={}){if(ModernCarousel.instances.has(e))return ModernCarousel.instances.get(e);this.element=e,this.options={autoplay:!1,autoplayInterval:5e3,pauseOnHover:!0,enableKeyboard:!0,enableTouch:!0,enableSpotlight:!0,transitionDuration:400,...t},this.initialize(),ModernCarousel.instances.set(e,this)}initialize(){const e=this.element.querySelectorAll(".carousel-slide");e.length&&(this.state=new CarouselState(e.length),this.view=new CarouselView(this.element,this.state),this.view.initialize(),this.view.addHoverEffects(),this.media=new CarouselMedia(this.element,this.state),this.options.enableTouch&&(this.gestures=new CarouselGestures(this.element,this.state),this.gestures.enable()),this.options.enableKeyboard&&(this.keyboard=new CarouselKeyboard(this.element,this.state),this.keyboard.enable()),this.options.enableSpotlight&&(this.spotlight=new CarouselSpotlight(this.element,this.state,this.view)),this.setupEventListeners(),this.handleResponsive(),this.options.autoplay&&this.startAutoplay(),this.element.classList.add("carousel-initialized"))}setupEventListeners(){const e=this.element.querySelector(".carousel-button.prev"),t=this.element.querySelector(".carousel-button.next");let s;e&&e.addEventListener("click",e=>{e.preventDefault(),this.prev()}),t&&t.addEventListener("click",e=>{e.preventDefault(),this.next()}),this.element.querySelectorAll(".indicator").forEach((e,t)=>{e.addEventListener("click",e=>{e.preventDefault(),this.goToSlide(t)})}),this.options.pauseOnHover&&this.options.autoplay&&(this.element.addEventListener("mouseenter",()=>this.pauseAutoplay()),this.element.addEventListener("mouseleave",()=>this.resumeAutoplay())),window.addEventListener("resize",()=>{clearTimeout(s),s=setTimeout(()=>this.handleResponsive(),150)})}next(){return!!this.state.next()&&(this.resetAutoplay(),!0)}prev(){return!!this.state.prev()&&(this.resetAutoplay(),!0)}goToSlide(e){return!!this.state.setIndex(e)&&(this.resetAutoplay(),!0)}startAutoplay(){this.options.autoplay&&!this.autoplayTimer&&(this.autoplayTimer=setInterval(()=>{this.next()},this.options.autoplayInterval))}pauseAutoplay(){this.autoplayTimer&&(clearInterval(this.autoplayTimer),this.autoplayTimer=null,this.autoplayPaused=!0)}resumeAutoplay(){this.options.autoplay&&this.autoplayPaused&&(this.autoplayPaused=!1,this.startAutoplay())}resetAutoplay(){this.options.autoplay&&!this.autoplayPaused&&(this.pauseAutoplay(),this.autoplayPaused=!1,this.startAutoplay())}handleResponsive(){this.view.handleResize(),this.media.handleResize()}destroy(){this.pauseAutoplay(),this.gestures&&this.gestures.disable(),this.keyboard&&this.keyboard.disable(),this.spotlight&&this.spotlight.destroy(),ModernCarousel.instances.delete(this.element),this.element.classList.remove("carousel-initialized")}static getInstance(e){return ModernCarousel.instances.get(e)}}export function initializeCarousels(){const e=document.querySelectorAll(".carousel:not(.carousel-initialized)"),t=[];return e.forEach(e=>{try{const s=new ModernCarousel(e);t.push(s)}catch(e){console.error("Failed to initialize carousel:",e)}}),t}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeCarousels):initializeCarousels(),window.ModernCarousel=ModernCarousel,window.initializeCarousels=initializeCarousels;