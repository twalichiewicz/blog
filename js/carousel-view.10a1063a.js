import{CarouselAnimations}from"./carousel-animations.js";export class CarouselView{constructor(t,e){this.element=t,this.state=e,this.animations=new CarouselAnimations,this.track=t.querySelector(".carousel-track"),this.slides=Array.from(t.querySelectorAll(".carousel-slide")),this.indicators=Array.from(t.querySelectorAll(".indicator")),this.prevButton=t.querySelector(".carousel-button.prev"),this.nextButton=t.querySelector(".carousel-button.next"),this.mediaElements=this.collectMediaElements(),this.setupStateListeners()}collectMediaElements(){const t=[];return this.slides.forEach((e,s)=>{const i=e.querySelector("img"),a=e.querySelector("video"),n=e.querySelector("iframe");i?t.push({type:"image",element:i,src:i.src,alt:i.alt||"",slideIndex:s}):a?t.push({type:"video",element:a,src:a.src,slideIndex:s}):n&&t.push({type:"iframe",element:n,src:n.src,slideIndex:s})}),t}setupStateListeners(){this.state.on("indexChange",({previousIndex:t,currentIndex:e})=>{this.transitionToSlide(t,e),this.updateIndicators(e),this.updateButtonStates()}),this.state.on("transitionStateChange",({isTransitioning:t})=>{this.element.classList.toggle("transitioning",t)})}transitionToSlide(t,e){if(t===e)return;const s=this.slides[t],i=this.slides[e];this.state.setTransitioning(!0),this.pauseMediaInSlide(s),this.animations.fadeTransition(s,i,()=>{this.slides.forEach((t,s)=>{t.classList.toggle("active",s===e)}),this.playMediaInSlide(i),this.state.setTransitioning(!1)}),this.animations.indicatorTransition(this.indicators,t,e)}updateIndicators(t){this.indicators.forEach((e,s)=>{const i=s===t;e.classList.toggle("active",i),e.setAttribute("aria-selected",i),i?(e.style.backgroundColor="var(--carousel-indicator-active)",e.style.width="24px"):(e.style.backgroundColor="var(--carousel-indicator-inactive)",e.style.width="8px")})}updateButtonStates(){const t=this.state.currentIndex+1,e=this.state.slideCount;this.prevButton?.setAttribute("aria-label",`Previous slide (${t} of ${e})`),this.nextButton?.setAttribute("aria-label",`Next slide (${t} of ${e})`)}pauseMediaInSlide(t){if(!t)return;const e=t.querySelector("video");e&&!e.paused&&e.pause()}playMediaInSlide(t){if(!t)return;const e=t.querySelector("video");e&&e.hasAttribute("autoplay")&&e.play().catch(()=>{})}initialize(){this.slides.forEach((t,e)=>{t.classList.toggle("active",0===e)}),this.updateIndicators(0),this.updateButtonStates(),this.element.classList.add("carousel-modern")}handleResize(){const t=window.innerWidth<768;if(this.element.classList.toggle("carousel-mobile",t),this.prevButton&&this.nextButton){const e=!t||this.state.slideCount>1;this.prevButton.style.display=e?"":"none",this.nextButton.style.display=e?"":"none"}}addHoverEffects(){[this.prevButton,this.nextButton].forEach(t=>{t&&(t.addEventListener("mouseenter",()=>{t.style.transform="translateY(-50%) scale(1.1)",t.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.15)"}),t.addEventListener("mouseleave",()=>{t.style.transform="translateY(-50%) scale(1)",t.style.boxShadow=""}),t.addEventListener("mousedown",()=>{this.animations.buttonPress(t)}))}),this.indicators.forEach(t=>{t.addEventListener("mouseenter",()=>{t.classList.contains("active")||(t.style.opacity="0.8",t.style.transform="scale(1.2)")}),t.addEventListener("mouseleave",()=>{t.classList.contains("active")||(t.style.opacity="",t.style.transform="")})})}}