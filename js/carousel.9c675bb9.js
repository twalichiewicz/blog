class Carousel{static activeSpotlightCarousel=null;updateCarouselImages(){const t=this.carousel.querySelectorAll(".carousel-slide");return this.carouselImages=[],t.forEach((t,e)=>{const s=t.querySelector("img"),i=t.querySelector("video");if(s){const t=s.src;this.carouselImages.push({type:"image",element:s,src:t,alt:s.alt||"",slideIndex:e})}else if(i){let t="";t=i.poster?i.poster:"video-no-poster",this.carouselImages.push({type:"video",element:i,src:t,alt:"Video",slideIndex:e,videoSrc:i.src||i.querySelector("source")?.src||""})}}),this.carouselImages}ensureImagesLoaded(){}fixRelativePathsImmediately(){}fixImagePathsImmediately(){}constructor(t){this.carousel=t,this.track=t.querySelector(".carousel-track"),this.slides=Array.from(t.querySelectorAll(".carousel-slide")),this.indicators=Array.from(t.querySelectorAll(".indicator")),this.prevButton=t.querySelector(".carousel-button.prev"),this.nextButton=t.querySelector(".carousel-button.next"),this.currentIndex=0,this.slideCount=this.slides.length,this.activeMedia=null,this.currentSpotlightIndex=0,this.updateCarouselImages(),this.touchStartX=0,this.touchStartY=0,this.touchEndX=0,this.touchEndY=0,this.minSwipeDistance=50,this.maxSwipeTime=300,this.touchStartTime=0,this.spotlightModal=null,this.init(),this.handleIframeResize(),this.setupImageHandlers()}init(){if(this.updateCarouselImages(),this.ensureImagesLoaded(),this.boundPrev=this.prev.bind(this),this.boundNext=this.next.bind(this),this.boundPrevWithSound=t=>{this.boundPrev(t),window.playSmallClickSound&&window.playSmallClickSound()},this.boundNextWithSound=t=>{this.boundNext(t),window.playSmallClickSound&&window.playSmallClickSound()},this.indicatorHandlers=new Map,this.imageClickHandlers=new Map,this.boundTouchStart=this.handleTouchStart.bind(this),this.boundTouchMove=this.handleTouchMove.bind(this),this.boundTouchEnd=this.handleTouchEnd.bind(this),this.prevButton?.removeEventListener("click",this.boundPrevWithSound),this.nextButton?.removeEventListener("click",this.boundNextWithSound),this.indicators.forEach((t,e)=>{const s=this.indicatorHandlers.get(t);s&&t.removeEventListener("click",s)}),this.indicatorHandlers.clear(),this.slideCount>1){this.prevButton&&(this.prevButton.innerHTML=""),this.nextButton&&(this.nextButton.innerHTML="");const t=document.createElement("button");t.className="spotlight-modal-close",t.setAttribute("aria-label","Close spotlight"),t.innerHTML="\n\t\t  <svg width='24px' height='24px' viewBox='0 0 52 52' direction='ltr' xmlns='http://www.w3.org/2000/svg' version='1.1'>\n\t\t\t<g fill-rule='nonzero' transform='scale(1,-1) translate(0,-52.400390625)'>\n\t\t\t  <path fill='black' stroke='black' fill-opacity='1.0' stroke-width='1.0' d='\n\t\t\t\t  M 24.6640625,5.37109375\n\t\t\t\t  C 36.115234375,5.37109375 45.482421875,14.73828125 45.482421875,26.2109375\n\t\t\t\t  C 45.482421875,37.662109375 36.115234375,47.029296875 24.6640625,47.029296875\n\t\t\t\t  C 13.212890625,47.029296875 3.845703125,37.662109375 3.845703125,26.2109375\n\t\t\t\t  C 3.845703125,14.73828125 13.212890625,5.37109375 24.6640625,5.37109375\n\t\t\t\t  Z\n\t\t\t\t  M 16.45703125,17.40234375\n\t\t\t\t  C 16.091796875,17.40234375 15.8125,17.638671875 15.8125,17.982421875\n\t\t\t\t  C 15.8125,18.17578125 15.85546875,18.3046875 16.02734375,18.498046875\n\t\t\t\t  L 23.76171875,26.232421875\n\t\t\t\t  L 16.02734375,33.966796875\n\t\t\t\t  C 15.876953125,34.1171875 15.8125,34.2890625 15.8125,34.4609375\n\t\t\t\t  C 15.8125,34.8046875 16.091796875,35.041015625 16.45703125,35.041015625\n\t\t\t\t  C 16.671875,35.041015625 16.80078125,34.998046875 16.994140625,34.8046875\n\t\t\t\t  L 24.6640625,27.134765625\n\t\t\t\t  L 32.333984375,34.8046875\n\t\t\t\t  C 32.52734375,34.998046875 32.69921875,35.041015625 32.87109375,35.041015625\n\t\t\t\t  C 33.2578125,35.041015625 33.515625,34.8046875 33.515625,34.4609375\n\t\t\t\t  C 33.515625,34.2890625 33.451171875,34.1171875 33.30078125,33.966796875\n\t\t\t\t  L 25.56640625,26.232421875\n\t\t\t\t  L 33.30078125,18.498046875\n\t\t\t\t  C 33.451171875,18.34765625 33.515625,18.17578125 33.515625,17.982421875\n\t\t\t\t  C 33.515625,17.638671875 33.2578125,17.40234375 32.87109375,17.40234375\n\t\t\t\t  C 32.69921875,17.40234375 32.52734375,17.466796875 32.333984375,17.66015625\n\t\t\t\t  L 24.6640625,25.330078125\n\t\t\t\t  L 16.994140625,17.66015625\n\t\t\t\t  C 16.80078125,17.466796875 16.671875,17.40234375 16.45703125,17.40234375\n\t\t\t\t  Z\n\t\t\t  ' />\n\t\t\t</g>\n\t\t  </svg>\n\t\t",this.prevButton?.addEventListener("click",this.boundPrevWithSound),this.nextButton?.addEventListener("click",this.boundNextWithSound),this.indicators.forEach((t,e)=>{const s=()=>{this.goToSlide(e),window.playSmallClickSound&&window.playSmallClickSound()};this.indicatorHandlers.set(t,s),t.addEventListener("click",s)}),this.carousel.addEventListener("touchstart",this.boundTouchStart,{passive:!0}),this.carousel.addEventListener("touchmove",this.boundTouchMove,{passive:!1}),this.carousel.addEventListener("touchend",this.boundTouchEnd,{passive:!0})}if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&this.slides.length>0){this.slides.forEach(t=>t.classList.remove("active")),this.indicators.forEach(t=>t.classList.remove("active")),this.slides[0].classList.add("active"),this.indicators.length>0&&this.indicators[0].classList.add("active");const t=this.slides[0].querySelector("img");t&&(t.style.display="none",t.offsetHeight,t.style.display="")}this.slides.forEach((t,e)=>{const s=t.querySelector("img"),i=t.querySelector("video");if(s){s.style.cursor="nesw-resize";const t=()=>{this.openSpotlight(s.src,s.alt,e)};this.imageClickHandlers.set(s,t),s.addEventListener("click",t)}else if(i){i.style.cursor="nesw-resize";const t=()=>{this.openSpotlight(null,"Video",e)};this.imageClickHandlers.set(i,t),i.addEventListener("click",t)}}),this.slides.forEach(t=>{const e=t.querySelector("img");e&&(e.loading="lazy",e.decoding="async")}),this.slideCount<=1&&(this.prevButton&&(this.prevButton.style.display="none"),this.nextButton&&(this.nextButton.style.display="none"),this.indicators.forEach(t=>t.style.display="none")),this.goToSlide(0),this.setupVideoErrorHandling(),this.carousel.closest(".project-gallery-section")&&setTimeout(()=>{this.updateCarouselImages()},500)}handleSwipe(t,e){e<=this.maxSwipeTime&&Math.abs(t)>=this.minSwipeDistance&&(t>0?this.next():this.prev())}goToSlide(t){const e=this.slides[this.currentIndex];this.pauseMedia(e),this.slides[this.currentIndex].classList.remove("active"),this.slides[this.currentIndex].setAttribute("aria-hidden","true"),this.indicators[this.currentIndex]&&this.indicators[this.currentIndex].classList.remove("active"),this.currentIndex=t,this.slides[this.currentIndex].classList.add("active"),this.slides[this.currentIndex].setAttribute("aria-hidden","false"),this.indicators[this.currentIndex]&&this.indicators[this.currentIndex].classList.add("active");const s=this.slides[t];this.playMedia(s);const i=s.querySelector("iframe");i&&this.resizeIframe(i)}next(){const t=(this.currentIndex+1)%this.slideCount;this.goToSlide(t)}prev(){const t=(this.currentIndex-1+this.slideCount)%this.slideCount;this.goToSlide(t)}openSpotlight(t,e,s=-1){if(this.updateCarouselImages(),this.carousel.closest(".project-gallery-section"),this.carouselImages.length<=1&&this.slides.length>1&&this.updateCarouselImages(),this.carouselImages.length,Carousel.activeSpotlightCarousel=this,s>=0&&s<this.carouselImages.length)this.currentSpotlightIndex=s;else{const e=this.carouselImages.findIndex(e=>e.src===t);this.currentSpotlightIndex=e>=0?e:0}let i=document.querySelector(".spotlight-modal");const o=this.carouselImages.length>1,n=this.carouselImages[this.currentSpotlightIndex];let l="";if(n&&"video"===n.type){const t=n.element;l='<video controls autoplay style="max-width: 100%; max-height: 90vh;">';const e=t.querySelectorAll("source");e.length>0?e.forEach(t=>{l+=`<source src="${t.src}" type="${t.type}">`}):t.src&&(l+=`<source src="${t.src}">`),l+="</video>"}else l=`<img src="${t}" alt="${e}">`;i?i.innerHTML=`\n\t\t\t\t<button class="spotlight-modal-close" aria-label="Close spotlight"></button>\n\t\t\t\t${l}\n\t\t\t\t${o?`\n\t\t\t\t\t<div class="carousel-indicators">\n\t\t\t\t\t\t<button class="carousel-button prev" aria-label="Previous image"></button>\n\t\t\t\t\t\t${this.carouselImages.map((t,e)=>`\n\t\t\t\t\t\t\t<button class="indicator ${e===this.currentSpotlightIndex?"active":""}" \n\t\t\t\t\t\t\t\t\taria-label="Go to slide ${e+1}"></button>\n\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t\t<button class="carousel-button next" aria-label="Next image"></button>\n\t\t\t\t\t</div>\n\t\t\t\t`:""}\n\t\t\t`:(i=document.createElement("div"),i.className="spotlight-modal",i.innerHTML=`\n\t\t\t\t<button class="spotlight-modal-close" aria-label="Close spotlight"></button>\n\t\t\t\t${l}\n\t\t\t\t${o?`\n\t\t\t\t\t<div class="carousel-indicators">\n\t\t\t\t\t\t<button class="carousel-button prev" aria-label="Previous image"></button>\n\t\t\t\t\t\t${this.carouselImages.map((t,e)=>`\n\t\t\t\t\t\t\t<button class="indicator ${e===this.currentSpotlightIndex?"active":""}" \n\t\t\t\t\t\t\t\t\taria-label="Go to slide ${e+1}"></button>\n\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t\t<button class="carousel-button next" aria-label="Next image"></button>\n\t\t\t\t\t</div>\n\t\t\t\t`:""}\n\t\t\t`,document.body.appendChild(i)),this.setupSpotlightNavigation(i),this.setupSpotlightTouchEvents(i),i.classList.add("active"),document.body.style.overflow="hidden"}setupSpotlightTouchEvents(t){this.spotlightTouchHandlers=this.spotlightTouchHandlers||{},this.spotlightTouchHandlers.handleTouchStart=t=>{this.touchStartX=t.touches[0].clientX,this.touchStartY=t.touches[0].clientY,this.touchStartTime=Date.now()},this.spotlightTouchHandlers.handleTouchMove=t=>{if(!this.touchStartX)return;const e=t.touches[0].clientX,s=t.touches[0].clientY,i=this.touchStartX-e;Math.abs(this.touchStartY-s)>Math.abs(i)||t.preventDefault()},this.spotlightTouchHandlers.handleTouchEnd=t=>{if(!this.touchStartX)return;const e=Date.now()-this.touchStartTime;this.touchEndX=t.changedTouches[0].clientX,this.touchEndY=t.changedTouches[0].clientY;const s=this.touchStartX-this.touchEndX;Math.abs(this.touchStartY-this.touchEndY)<Math.abs(s)&&e<=this.maxSwipeTime&&Math.abs(s)>=this.minSwipeDistance&&(s>0?this.navigateSpotlight("next"):this.navigateSpotlight("prev")),this.touchStartX=0,this.touchStartY=0,this.touchEndX=0,this.touchEndY=0},t.addEventListener("touchstart",this.spotlightTouchHandlers.handleTouchStart,{passive:!0}),t.addEventListener("touchmove",this.spotlightTouchHandlers.handleTouchMove,{passive:!1}),t.addEventListener("touchend",this.spotlightTouchHandlers.handleTouchEnd,{passive:!0})}closeSpotlight(){const t=document.querySelector(".spotlight-modal");t&&(this.spotlightTouchHandlers&&(t.removeEventListener("touchstart",this.spotlightTouchHandlers.handleTouchStart),t.removeEventListener("touchmove",this.spotlightTouchHandlers.handleTouchMove),t.removeEventListener("touchend",this.spotlightTouchHandlers.handleTouchEnd),this.spotlightTouchHandlers=null),this.spotlightModalClickHandler&&(t.removeEventListener("click",this.spotlightModalClickHandler),this.spotlightModalClickHandler=null),t.classList.remove("active"),document.body.style.overflow="",Carousel.activeSpotlightCarousel===this&&(Carousel.activeSpotlightCarousel=null),this.boundSpotlightKeydownHandler&&(document.removeEventListener("keydown",this.boundSpotlightKeydownHandler),this.boundSpotlightKeydownHandler=null))}isVisible(t){const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=window.innerHeight&&e.right<=window.innerWidth}pauseMedia(t){const e=t.querySelector("video");e&&e.pause();const s=t.querySelector("iframe");s&&(s.src=s.src)}playMedia(t){const e=t.querySelector("video[autoplay]");e&&e.play().catch(()=>{})}getMediaType(t){return t.match(/\.(mp4|webm|ogg)$/i)?"video":t.includes("iframe")?"iframe":"image"}handleIframeResize(){const t=this.carousel.querySelectorAll("iframe");this.iframeResizeHandlers=this.iframeResizeHandlers||[],t.forEach(t=>{this.resizeIframe(t);const e=()=>{this.resizeIframe(t)};this.iframeResizeHandlers.push(e),window.addEventListener("resize",e)})}resizeIframe(t){const e=t.closest(".carousel-slide");if(e){const s=e.offsetWidth,i=e.offsetHeight;if(t.src.includes("physics-simulation")){const e=s/(16/9);t.style.height=`${e}px`}else t.style.height=`${i}px`;t.style.width=`${s}px`}}setupImageHandlers(){this.carousel.querySelectorAll("img").forEach(t=>{t.closest(".carousel-slide")||(t.naturalWidth>800||t.naturalHeight>800)&&(t.classList.add("large-image"),t.addEventListener("click",()=>{const e=this.carouselImages.findIndex(e=>e.src===t.src);this.openSpotlight(t.src,t.alt,e)}),t.style.cursor="nesw-resize")})}setupSpotlightNavigation(t){const e=t.querySelector(".carousel-button.prev"),s=t.querySelector(".carousel-button.next"),i=t.querySelector(".spotlight-modal-close"),o=this;this.spotlightModalClickHandler=this.spotlightModalClickHandler||null,e&&(e.onclick=()=>{o.navigateSpotlight("prev"),window.playSmallClickSound&&window.playSmallClickSound()}),s&&(s.onclick=()=>{o.navigateSpotlight("next"),window.playSmallClickSound&&window.playSmallClickSound()}),i&&(i.onclick=()=>{o.closeSpotlight(),window.playSmallClickSound&&window.playSmallClickSound()}),t.querySelectorAll(".carousel-indicators .indicator").forEach((e,s)=>{e.onclick=()=>{o.currentSpotlightIndex=s,o.updateSpotlightContent(t),o.updateSpotlightIndicators(),window.playSmallClickSound&&window.playSmallClickSound()}}),this.spotlightModalClickHandler&&t.removeEventListener("click",this.spotlightModalClickHandler),this.spotlightModalClickHandler=e=>{e.target===t&&(o.closeSpotlight(),window.playSmallClickSound&&window.playSmallClickSound())},t.addEventListener("click",this.spotlightModalClickHandler),o.boundSpotlightKeydownHandler&&document.removeEventListener("keydown",o.boundSpotlightKeydownHandler),o.boundSpotlightKeydownHandler=e=>{t.classList.contains("active")&&Carousel.activeSpotlightCarousel===o&&("ArrowLeft"===e.key&&(o.navigateSpotlight("prev"),window.playSmallClickSound&&window.playSmallClickSound()),"ArrowRight"===e.key&&(o.navigateSpotlight("next"),window.playSmallClickSound&&window.playSmallClickSound()),"Escape"===e.key&&(o.closeSpotlight(),window.playSmallClickSound&&window.playSmallClickSound()))},document.addEventListener("keydown",o.boundSpotlightKeydownHandler)}navigateSpotlight(t){if(Carousel.activeSpotlightCarousel!==this)return;const e=document.querySelector(".spotlight-modal");e&&(this.currentSpotlightIndex="next"===t?(this.currentSpotlightIndex+1)%this.carouselImages.length:(this.currentSpotlightIndex-1+this.carouselImages.length)%this.carouselImages.length,this.updateSpotlightContent(e),this.updateSpotlightIndicators())}updateSpotlightContent(t){const e=this.carouselImages[this.currentSpotlightIndex];if(!e||!t)return;const s=t.querySelector("img, video");if(!s)return;let i="";if("video"===e.type){const t=e.element;i='<video controls autoplay style="max-width: 100%; max-height: 90vh;">';const s=t.querySelectorAll("source");s.length>0?s.forEach(t=>{i+=`<source src="${t.src}" type="${t.type}">`}):t.src&&(i+=`<source src="${t.src}">`),i+="</video>"}else i=`<img src="${e.src}" alt="${e.alt||`Slide ${this.currentSpotlightIndex+1}`}">`;const o=document.createElement("div");o.innerHTML=i;const n=o.firstChild;s.parentNode.replaceChild(n,s)}updateSpotlightIndicators(){const t=document.querySelector(".spotlight-modal");t&&t.querySelectorAll(".indicator").forEach((t,e)=>{t.classList.toggle("active",e===this.currentSpotlightIndex)})}handleIframeLoad(t){t.addEventListener("load",()=>{if(this.resizeIframe(t),t.src.includes("physics-simulation")){const e=window.matchMedia("(prefers-color-scheme: dark)").matches;t.contentWindow.postMessage({darkMode:e},"*")}})}destroy(){this.prevButton?.removeEventListener("click",this.boundPrevWithSound),this.nextButton?.removeEventListener("click",this.boundNextWithSound),this.indicators.forEach((t,e)=>{const s=this.indicatorHandlers?.get(t);s&&t.removeEventListener("click",s)}),this.indicatorHandlers?.clear(),this.boundTouchStart&&this.carousel.removeEventListener("touchstart",this.boundTouchStart),this.boundTouchMove&&this.carousel.removeEventListener("touchmove",this.boundTouchMove),this.boundTouchEnd&&this.carousel.removeEventListener("touchend",this.boundTouchEnd),this.slides.forEach(t=>{const e=t.querySelector("img"),s=t.querySelector("video");if(e){const t=this.imageClickHandlers?.get(e);t&&e.removeEventListener("click",t)}if(s){const t=this.imageClickHandlers?.get(s);t&&s.removeEventListener("click",t)}}),this.imageClickHandlers?.clear(),this.iframeResizeHandlers&&(this.iframeResizeHandlers.forEach(t=>{window.removeEventListener("resize",t)}),this.iframeResizeHandlers=[]),Carousel.activeSpotlightCarousel===this&&this.closeSpotlight(),this.boundSpotlightKeydownHandler&&(document.removeEventListener("keydown",this.boundSpotlightKeydownHandler),this.boundSpotlightKeydownHandler=null),this.carouselImages=[],this.slides=[],this.indicators=[],this.indicatorHandlers=null,this.imageClickHandlers=null,this.carousel.dataset.carouselInstanceDestroyed="true"}handleTouchStart(t){this.slideCount<=1||(this.touchStartX=t.touches[0].clientX,this.touchStartY=t.touches[0].clientY,this.touchStartTime=Date.now())}handleTouchMove(t){if(this.slideCount<=1||!this.touchStartX)return;const e=t.touches[0].clientX,s=t.touches[0].clientY,i=this.touchStartX-e;Math.abs(this.touchStartY-s)>Math.abs(i)||t.preventDefault()}handleTouchEnd(t){if(this.slideCount<=1||!this.touchStartX)return;const e=Date.now()-this.touchStartTime;this.touchEndX=t.changedTouches[0].clientX,this.touchEndY=t.changedTouches[0].clientY;const s=this.touchStartX-this.touchEndX;Math.abs(this.touchStartY-this.touchEndY)<Math.abs(s)&&this.handleSwipe(s,e),this.touchStartX=0,this.touchStartY=0,this.touchEndX=0,this.touchEndY=0}setupVideoErrorHandling(){this.carousel.querySelectorAll("video").forEach((t,e)=>{const s=t.querySelectorAll("source");t.addEventListener("loadstart",()=>{}),t.addEventListener("loadedmetadata",()=>{}),t.addEventListener("canplay",()=>{}),t.addEventListener("error",e=>{t.error;const s=t.closest(".carousel-slide");if(s&&t.poster){const e=document.createElement("img");e.src=t.poster,e.alt="Video preview (video failed to load)",e.style.width="100%",e.style.height="auto",e.style.objectFit="contain",t.style.display="none",s.appendChild(e)}}),t.addEventListener("stalled",()=>{}),s.forEach((t,e)=>{t.addEventListener("error",t=>{})})})}}const initializedCarousels=new WeakSet;let carouselInstances=[];export function initializeCarousels(t=document){const e=t.querySelectorAll(".carousel");/^((?!chrome|android).)*safari/i.test(navigator.userAgent),document,e.forEach(t=>{const e=carouselInstances.findIndex(e=>e.carousel===t);if(e>-1){try{carouselInstances[e].destroy()}catch(t){window.DEBUG_MODE}carouselInstances.splice(e,1)}initializedCarousels.delete(t),t.classList.remove("initialized"),delete t.dataset.carouselInstanceDestroyed;try{const e=new Carousel(t);t.classList.add("initialized"),initializedCarousels.add(t),carouselInstances.push(e)}catch(t){window.DEBUG_MODE}})}export function cleanupCarouselInstances(t){t.querySelectorAll(".carousel.initialized").forEach(t=>{const e=carouselInstances.findIndex(e=>e.carousel===t);if(e>-1)try{carouselInstances[e].destroy(),carouselInstances.splice(e,1)}catch(t){window.DEBUG_MODE}initializedCarousels.delete(t),t.classList.remove("initialized"),delete t.dataset.carouselInstanceDestroyed})}window.addEventListener("pageshow",t=>{t.persisted&&initializeCarousels(document)}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>initializeCarousels(document)):initializeCarousels(document);