class VideoAutoplayManager{constructor(){this.videos=new Map,this.observer=null,this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){const e=document.querySelectorAll('video[data-autoplay="true"]');e.forEach((e,t)=>{}),0!==e.length&&(this.observer=new IntersectionObserver(e=>this.handleIntersection(e),{root:null,rootMargin:"50px",threshold:.1}),e.forEach(e=>this.setupVideo(e)))}setupVideo(e){const t=null!==e.closest(".project-trailer-hero");this.videos.set(e,{isPlaying:!1,hasPlayedOnce:!1,playPromise:null,isTrailer:t}),e.muted=!0,e.playsInline=!0,e.loop=!0,e.preload=t?"auto":"metadata",t&&(e.style.pointerEvents="none",e.setAttribute("disablePictureInPicture","true"),e.setAttribute("controlsList","nodownload nofullscreen noremoteplayback")),e.setAttribute("data-loading","true"),e.addEventListener("loadedmetadata",()=>{e.removeAttribute("data-loading")}),e.addEventListener("canplay",()=>{e.removeAttribute("data-loading")}),e.addEventListener("play",()=>{const t=this.videos.get(e);t&&(t.isPlaying=!0,t.hasPlayedOnce=!0),e.setAttribute("data-playing","true"),e.removeAttribute("data-loading")}),e.addEventListener("pause",()=>{const t=this.videos.get(e);t&&(t.isPlaying=!1),e.removeAttribute("data-playing")}),e.addEventListener("waiting",()=>{e.setAttribute("data-loading","true")}),e.addEventListener("playing",()=>{e.removeAttribute("data-loading"),e.setAttribute("data-playing","true")}),this.observer.observe(e),this.attemptPlay(e)}handleIntersection(e){e.forEach(e=>{const t=e.target,a=this.videos.get(t);a&&(e.isIntersecting?this.attemptPlay(t):(a.isTrailer,this.pauseVideo(t)))})}async attemptPlay(e){const t=this.videos.get(e);if(t&&!t.isPlaying)try{e.readyState<3&&await new Promise(t=>{const a=()=>{e.removeEventListener("canplay",a),t()};e.addEventListener("canplay",a),setTimeout(()=>{e.removeEventListener("canplay",a),t()},2e3)}),t.playPromise=e.play(),await t.playPromise}catch(t){"NotAllowedError"===t.name?this.setupUserInteractionFallback(e):t.name}}pauseVideo(e){const t=this.videos.get(e);if(t&&t.isPlaying)try{t.playPromise?t.playPromise.then(()=>{e.paused||e.pause()}).catch(()=>{}):e.paused||e.pause()}catch(e){}}setupUserInteractionFallback(e){const t=this.videos.get(e);if(t&&t.isTrailer)return;const a=e.closest(".portfolio-image");if(!a)return;const i=async()=>{try{await e.play(),a.removeEventListener("click",i)}catch(e){}};a.addEventListener("click",i),a.style.cursor="pointer",a.setAttribute("title","Click to play video")}refresh(){this.observer&&this.observer.disconnect(),this.videos.clear(),this.setup()}destroy(){this.observer&&this.observer.disconnect(),this.videos.clear()}}const videoAutoplayManager=new VideoAutoplayManager;export default videoAutoplayManager;