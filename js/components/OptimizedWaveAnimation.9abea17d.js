export class OptimizedWaveAnimation{constructor(i,e={}){this.canvas=i,this.ctx=i.getContext("2d"),this.config={baseString:"Design in Everything ",frequency:.009,amplitude:30,speed:3e-4,throttleFPS:30,font:{size:21,lineHeight:30,charWidth:14},...e},this.textData=[],this.startTime=0,this.lastFrameTime=0,this.frameInterval=1e3/this.config.throttleFPS,this.needsResize=!0,this.isVisible=!0,this.animationFrame=null,this.resizeTimeoutId=null,window.innerWidth<768&&(this.frameInterval=1e3/24,this.config.speed&&(this.config.speed*=3),this.config.frequency&&(this.config.frequency*=1.5))}init(){this.resizeCanvas(),this.buildTextData(),this.setupVisibilityObserver(),this.resizeHandler=()=>this.onResize(),window.addEventListener("resize",this.resizeHandler),window.addEventListener("orientationchange",()=>{setTimeout(()=>this.onResize(),300)}),this.lastFrameTime=performance.now(),this.animationFrame=requestAnimationFrame(i=>this.animate(i))}setupVisibilityObserver(){"IntersectionObserver"in window&&(this.observer=new IntersectionObserver(i=>{i.forEach(i=>{this.isVisible=i.isIntersecting})},{threshold:.1}),this.observer.observe(this.canvas))}resizeCanvas(){const i=window.innerWidth<768?.4:.8,e=window.devicePixelRatio*i||1,t=this.canvas.clientWidth||window.innerWidth;this.canvas.clientHeight,this.canvas.width=t*e,this.canvas.height=300*e,this.canvas.style.width=t+"px",this.canvas.style.height="300px",this.ctx.scale(e,e)}buildTextData(){this.ctx.font=this.config.font.size+"px sans-serif";const{charWidth:i,lineHeight:e}=this.config.font,t=window.innerWidth<768?.85:.8,s=Math.ceil(this.canvas.width/i/t),n=Math.ceil(this.canvas.height/e/t),a=this.config.baseString.repeat(Math.ceil(s/this.config.baseString.length)+1);this.textData=[];for(let h=0;h<n;h++)for(let n=-1;n<s;n++){const s=a[(h+n)%a.length];this.textData.push({char:s,baseX:n*i*(1/t),baseY:h*e*(1/t),currentX:n*i*(1/t),currentY:h*e*(1/t)})}}onResize(){this.resizeTimeoutId&&clearTimeout(this.resizeTimeoutId),this.resizeTimeoutId=setTimeout(()=>{this.needsResize=!0,this.resizeTimeoutId=null},150)}animate(i){if(i-this.lastFrameTime<this.frameInterval||!this.isVisible)return void(this.animationFrame=requestAnimationFrame(i=>this.animate(i)));this.lastFrameTime=i,this.needsResize&&(this.resizeCanvas(),this.buildTextData(),this.needsResize=!1),this.startTime||(this.startTime=i);const e=i-this.startTime;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"hsla(0, 0%, 85%,":"hsla(0, 6%, 37%,";this.ctx.font=this.config.font.size+"px sans-serif",window.innerWidth;for(let i=0;i<this.textData.length;i+=1){const s=this.textData[i],n=Math.sin(s.baseY*this.config.frequency-e*this.config.speed)*this.config.amplitude;s.currentX=s.baseX+.5*n,s.currentY=s.baseY;const a=.3+.7*(1-Math.abs(n)/this.config.amplitude);this.ctx.fillStyle=`${t} ${a})`,this.ctx.fillText(s.char,s.currentX,s.currentY)}this.animationFrame=requestAnimationFrame(i=>this.animate(i))}destroy(){this.animationFrame&&cancelAnimationFrame(this.animationFrame),window.removeEventListener("resize",this.resizeHandler),window.removeEventListener("orientationchange",this.resizeHandler),this.resizeTimeoutId&&clearTimeout(this.resizeTimeoutId),this.observer&&this.observer.disconnect()}}