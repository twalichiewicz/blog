import{initializeCarousels,cleanupCarouselInstances}from"./carousel.js";import{initializeMobileTabs}from"./mobile-tabs.js";import videoAutoplayManager from"./components/video-autoplay.js";import ScrollUtility from"./utils/scroll-utility.js";function createLifecycleEvent(e,t={}){try{return new CustomEvent(e,{detail:t})}catch(o){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,t),n}}function dispatchLifecycleEvent(e,t,o){o.forEach(o=>{if(!o||"function"!=typeof o.dispatchEvent)return;const n=createLifecycleEvent(e,t);o.dispatchEvent(n)})}function emitSdLifecycleEvent(e,t){window.SD&&window.SD.events&&"function"==typeof window.SD.events.emit&&window.SD.events.emit(e,t)}function emitBlogContentLifecycle(e={}){const t={type:e.type||e.contentType||e.originatingTab||"blog",...e};dispatchLifecycleEvent("contentLoaded",t,[document,window]),dispatchLifecycleEvent("blog:content-loaded",t,[document,window]),emitSdLifecycleEvent("blog:content-loaded",t),t.reinitialized&&(dispatchLifecycleEvent("blog:content-reinitialized",t,[document,window]),emitSdLifecycleEvent("blog:content-reinitialized",t))}function emitPortfolioLifecycle(e={}){const t={type:"portfolio",...e};dispatchLifecycleEvent("portfolio-loaded",t,[document,window]),dispatchLifecycleEvent("portfolio:loaded",t,[document,window]),emitSdLifecycleEvent("portfolio:loaded",t),emitSdLifecycleEvent("portfolio:content-loaded",t)}function executeInlineScripts(e){if(!e||"function"!=typeof e.querySelectorAll)return;const t=new Set(["","text/javascript","application/javascript","module"]);e.querySelectorAll("script").forEach(e=>{const o=(e.type||"").trim();if(o&&!t.has(o))return;const n=document.createElement("script");[...e.attributes].forEach(e=>{n.setAttribute(e.name,e.value)}),n.textContent=e.textContent,e.parentNode.replaceChild(n,e)})}function patchDomContentLoadedListener(){if("true"===document.documentElement.dataset.sdDomReadyPatched)return;document.documentElement.dataset.sdDomReadyPatched="true";const e=Document.prototype.addEventListener;Document.prototype.addEventListener=function(t,o,n){if("DOMContentLoaded"!==t||"loading"===document.readyState)return e.call(this,t,o,n);setTimeout(()=>{try{o.call(document,new Event("DOMContentLoaded"))}catch(e){}},0)}}patchDomContentLoadedListener(),document.addEventListener("DOMContentLoaded",function(){function e(e){const t={searchInput:e.querySelector("#postSearch"),expandButtons:e.querySelectorAll(".expand-button")};if(setTimeout(()=>{window.projectDemo&&window.projectDemo.init&&window.projectDemo.init()},100),t.searchInput)t.searchInput.removeEventListener("input",s),t.searchInput.addEventListener("input",s),t.searchInput.removeEventListener("click",i),t.searchInput.addEventListener("click",i),r(t.searchInput);else{const e=document.querySelector("#postSearch");e&&(e.removeEventListener("input",s),e.addEventListener("input",s),e.removeEventListener("click",i),e.addEventListener("click",i),r(e))}if(t.expandButtons.length&&t.expandButtons.forEach(e=>{e.removeEventListener("click",T),e.addEventListener("click",T)}),"function"==typeof initializeCarousels){const t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=e!==document;t&&o?setTimeout(()=>{initializeCarousels(e)},100):initializeCarousels(e)}e.querySelector('video[data-autoplay="true"]')&&videoAutoplayManager&&"function"==typeof videoAutoplayManager.refresh&&videoAutoplayManager.refresh()}let t=()=>{};window.innerWidth,document.body.classList.contains("device-desktop");const o={hasInteracted:!1,isCollapsed:!1,lastScrollTop:0,scrollHandler:null,collapseTimeout:null,collapseDelay:600,ignoreNextFocus:!1};function n(){if([window._notebookCarousel,window._notebookCarouselDebug].forEach(e=>{if(!e||"function"!=typeof e.getInstance)return;const t=e.getInstance();if(t&&"function"==typeof t.destroy)try{t.destroy()}catch(e){}}),window.mobileTabs&&"function"==typeof window.mobileTabs.destroy){try{window.mobileTabs.destroy()}catch(e){}window.mobileTabs=null}}function i(e){window.playBookSound&&window.playBookSound()}function r(e){if(!e)return;const t=e.parentElement.querySelector(".search-clear");function o(){t.style.display=e.value?"block":"none"}function n(o){o.preventDefault(),window.playSmallClickSound&&window.playSmallClickSound(),e.value="",t.style.display="none",s({target:e}),e.focus()}t&&(t.removeEventListener("click",n),e.removeEventListener("input",o),t.addEventListener("click",n),e.addEventListener("input",o),o())}function s(e){const t=e.target.value.toLowerCase(),o=document.querySelector(".blog-content");if(!o)return;const n=o.querySelectorAll(".post-list-item"),i=o.querySelectorAll(".post-separator"),r=o.querySelector(".no-results-message"),c=o.querySelector(".posts-only-button"),a=c&&c.classList.contains("active");let l=0;const d=[];if(o.querySelectorAll(".search-highlight").forEach(e=>{const t=e.parentNode,o=document.createTextNode(e.textContent);t.replaceChild(o,e),t.normalize()}),n.forEach(e=>{const o=e.querySelector("h3")?.textContent.toLowerCase()||"",n=e.textContent.toLowerCase(),i=o.includes(t)||n.includes(t),r=e.querySelector(".post-long.post-preview-card")||e.classList.contains("post-long")&&e.classList.contains("post-preview-card");!i||a&&!r?e.style.display="none":(e.style.display="",l++,d.push(e),t&&function(e,t){if(!t)return;const o=new RegExp(`(${n=t,n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");var n;const i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){const t=e.parentNode;return"SCRIPT"===t.tagName||"STYLE"===t.tagName||t.classList&&t.classList.contains("search-highlight")?NodeFilter.FILTER_REJECT:o.test(e.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),r=[];let s;for(;s=i.nextNode();)r.push(s);r.forEach(e=>{const t=e.parentNode,n=document.createDocumentFragment();let i,r=0;o.lastIndex=0;const s=e.textContent;for(;null!==(i=o.exec(s));){i.index>r&&n.appendChild(document.createTextNode(s.slice(r,i.index)));const e=document.createElement("mark");e.className="search-highlight",e.textContent=i[0],n.appendChild(e),r=o.lastIndex}r<s.length&&n.appendChild(document.createTextNode(s.slice(r))),t.replaceChild(n,e)})}(e,t))}),i.forEach(e=>e.style.display="none"),d.forEach((e,t)=>{if(t<d.length-1){let t=e.nextElementSibling;for(;t&&!t.classList.contains("post-separator");)t=t.nextElementSibling;t&&t.classList.contains("post-separator")&&(t.style.display="")}}),r){const e=0===l;r.style.display=e?"flex":"none",r.setAttribute("aria-hidden",e?"false":"true")}const u=o.querySelector("#postsContent");u&&u.classList.toggle("has-no-results",0===l),y(e.target.closest(".search-container")),t&&d.length>0&&(s.scrollTimeout&&clearTimeout(s.scrollTimeout),s.scrollTimeout=setTimeout(()=>{const e=d[0];if(e){const t=document.querySelector(".tabs-wrapper"),n=t?t.offsetHeight:0,i=16,r=e.getBoundingClientRect(),s=e.closest(".mobile-tab-pane")||window,c=o.querySelector(".search-container");let a=0;if(c&&t){const e=c.getBoundingClientRect();a=window.scrollY+e.bottom-n+i}if(s===window||s===document.documentElement){const e=window.scrollY+r.top-n-i,t=Math.max(a,e);window.scrollTo({top:Math.max(0,t),behavior:"smooth"})}else{const e=s.getBoundingClientRect(),t=s.scrollTop+(r.top-e.top)-n-i;s.scrollTo({top:Math.max(0,t),behavior:"smooth"})}}},150))}function c(){const e=document.querySelector(".posts-only-button");if(!e)return;e.removeEventListener("click",a),e.addEventListener("click",a);const t=document.querySelector("#postSearch");t&&r(t)}function a(e){window.playSmallClickSound&&window.playSmallClickSound(),e.currentTarget.classList.toggle("active");const t=document.querySelector("#postSearch");t&&s({target:t})}function l(){return window.matchMedia&&window.matchMedia("(max-width: 768px)").matches}function d(){const e=document.scrollingElement||document.documentElement;return Math.max(0,window.pageYOffset||e.scrollTop||0)}function u(){return document.querySelector(".search-container")}function p(e,t){if(!e)return;e.classList.toggle("is-collapsed",t),o.isCollapsed=t,f();const n=e.querySelector(".search-collapse-toggle");n&&n.setAttribute("aria-expanded",t?"false":"true")}function y(e){const t=e||u();if(!t)return o.hasInteracted=!1,!1;const n=t.querySelector("#postSearch"),i=t.querySelector(".posts-only-button"),r=Boolean(n&&n.value.trim()),s=Boolean(i&&i.classList.contains("active")),c=r||s;return o.hasInteracted=c,c&&o.isCollapsed&&p(t,!1),c||f(),c}function m(e){if("focus"===e?.type&&o.ignoreNextFocus)return void(o.ignoreNextFocus=!1);const t=e?.currentTarget?.closest(".search-container");y(t)}function f(){o.collapseTimeout&&(clearTimeout(o.collapseTimeout),o.collapseTimeout=null)}function w(e){const t=e.currentTarget?.closest(".search-container")||u();if(!t)return;p(t,!1),f();const n=t.querySelector("#postSearch");n&&(o.ignoreNextFocus=!0,setTimeout(()=>n.focus(),0))}function h(){const e=u();if(!e)return;const t=e.querySelector(".search-collapse-toggle"),n=e.querySelector("#postSearch");o.isCollapsed=e.classList.contains("is-collapsed"),y(e),t&&(t.removeEventListener("click",w),t.addEventListener("click",w)),n&&(n.removeEventListener("focus",m),n.addEventListener("focus",m),n.removeEventListener("input",m),n.addEventListener("input",m),n.removeEventListener("click",m),n.addEventListener("click",m)),o.scrollHandler||(o.lastScrollTop=d(),o.scrollHandler=()=>{const e=d(),t=o.lastScrollTop;if(o.lastScrollTop=e,!l()){const e=u();return e&&o.isCollapsed&&p(e,!1),void f()}if(o.hasInteracted)return void f();const n=u();if(!n)return void f();const i=n.querySelector("#postSearch");if(i&&document.activeElement===i)return void f();const r=window.getComputedStyle(n);"none"!==r.display&&"hidden"!==r.visibility?o.isCollapsed?f():e>t+4&&e>0?function(e){o.collapseTimeout||(o.collapseTimeout=window.setTimeout(()=>{if(o.collapseTimeout=null,!l())return;if(o.hasInteracted||o.isCollapsed)return;const t=e||u();if(!t)return;const n=window.getComputedStyle(t);"none"!==n.display&&"hidden"!==n.visibility&&p(t,!0)},o.collapseDelay))}(n):(e<t-4||e<=0)&&f():f()},window.addEventListener("scroll",o.scrollHandler,{passive:!0}))}window.scrollToFullStory=function(){const e=document.getElementById("full-story");e&&ScrollUtility.scrollToElement(e,{behavior:"smooth",block:"start"})},document.querySelector(".blog-content")&&function(){const o=document.querySelector(".blog-content"),i=document.querySelector(".blog");if(!o)return;const r=window.matchMedia("(max-width: 768px)");let s=null;const a=["height","min-height","max-height","overflow","overflow-y","overflow-x","width"];function l(e){e&&a.forEach(t=>e.style.removeProperty(t))}function d(e,t=[0,16,32,64,128,256,400]){t.forEach(t=>{setTimeout(()=>l(e),t)})}function u(){const e=o.querySelector(".content-inner-wrapper");e&&l(e)}u();const p=()=>u();function y(e){i&&(e?i.classList.add("long-form-active"):i.classList.remove("long-form-active"),u())}r.addEventListener?r.addEventListener("change",p):r.addListener&&r.addListener(p),y(!1);let m=o.innerHTML,f=window.location.pathname+window.location.search+window.location.hash,w="blog";function v(){if(!s)return;const e=s.host;e&&e.isConnected&&(e.classList.remove("dynamic-scroll-host"),e.removeAttribute("data-dynamic-scroll"),e.style.removeProperty("height"),e.style.removeProperty("min-height"),e.style.removeProperty("max-height"),e.style.removeProperty("overflow"),e.style.removeProperty("overflow-y"),e.style.removeProperty("overflow-x"),e.style.removeProperty("-webkit-overflow-scrolling")),s.cleanup&&s.cleanup(),s=null}function g(t={}){const{fromContentType:n=null,originatingTab:i=w}=t;"function"==typeof cleanupCarouselInstances&&cleanupCarouselInstances(o),v(),o.classList.remove("has-dynamic-content"),o.style.removeProperty("overflow"),o.style.removeProperty("overflow-y"),o.style.removeProperty("overflow-x"),document.body.classList.remove("has-dynamic-content-active"),o.innerHTML=m,executeInlineScripts(o),e(o),C(o),u(),y(!1);const r=o.querySelector(".content-inner-wrapper");if(r&&(r.style.opacity="1",r.style.removeProperty("overflow")),o.style.opacity="1",requestAnimationFrame(()=>{requestAnimationFrame(()=>{initializeMobileTabs(),setTimeout(()=>{document.querySelectorAll(".tab-button").length},200)})}),b(),c(),h(),window.innerWidth<=768){const e=o.querySelector(".tabs-wrapper");e&&(e.style.display="")}const s=(e,t=0)=>{window.mobileTabs&&"function"==typeof window.mobileTabs.switchTab?window.mobileTabs.switchTab(e,!1):t<6?setTimeout(()=>s(e,t+1),50*(t+1)):(e=>{const t=document.querySelectorAll(".tab-button"),o=new Map;t.forEach(t=>{if(!t)return;const n=t.dataset.pane,i=t.dataset.type===e;if(t.classList.toggle("active",i),t.setAttribute("aria-selected",i?"true":"false"),n){const e=document.getElementById(n);e&&o.set(t.dataset.type,e)}}),o.forEach((t,o)=>{const n=o===e;t.style.display=n?"block":"none",t.setAttribute("aria-hidden",n?"false":"true"),t.classList.toggle("is-visible",n)})})(e)},a=n||i,l={source:"restoreInitialView",originatingTab:a,fromContentType:n};"portfolio"===n?(sessionStorage.setItem("portfolio-back-navigation","true"),setTimeout(()=>{s(a),emitPortfolioLifecycle(l),emitBlogContentLifecycle({...l,reinitialized:!0}),setTimeout(()=>{window.projectDemo&&window.projectDemo.init&&window.projectDemo.init()},100),setTimeout(()=>{window._notebookCarousel&&window._notebookCarousel.reinitialize&&window._notebookCarousel.reinitialize()},300)},50)):setTimeout(()=>{s(a),emitBlogContentLifecycle({...l,reinitialized:!0}),window.location.search.includes("tab=portfolio")&&"portfolio"!==i&&history.replaceState({path:f,isInitial:!0,isDynamic:!1,fromTab:i,contentType:i||"blog"},"",f)},50),window.initializeSoundEffects?window.initializeSoundEffects():setTimeout(()=>{window.initializeSoundEffects&&window.initializeSoundEffects()},100),document.body.style.opacity="1",document.body.classList.add("loaded");const d=document.querySelector(".page-transition-overlay");d&&(d.style.display="none"),document.dispatchEvent(new Event("dynamic-content-unloaded"))}async function S(e,t=300){if(!e)return;const n=e.querySelector(".project-edge-wrapper");if(n)return n.style.transform="translateZ(0)",n.style.willChange="opacity",n.style.opacity="0",n.style.transition=`opacity ${t}ms ease-in-out`,n.offsetHeight,await new Promise(e=>setTimeout(e,20)),n.style.opacity="1",await new Promise(e=>setTimeout(e,t)),void(n.style.willChange="auto");let i=e;e===o&&(i=e.querySelector(".content-inner-wrapper"),i||(i=e)),i&&(i.style.transform="translateZ(0)",i.style.willChange="opacity",i.style.opacity="0",i.style.transition=`opacity ${t}ms ease-in-out`,i.offsetHeight,await new Promise(e=>setTimeout(e,20)),i.style.opacity="1",await new Promise(e=>setTimeout(e,t)),i.style.willChange="auto")}function T(){if(!o)return null;if(o.querySelector(".project-edge-wrapper")||o.innerHTML.includes("project-edge-wrapper"))return null;if(o.querySelector(".demo-inline-container")||o.innerHTML.includes("demo-inline-container"))return null;if(o.querySelector(".demo-inline-controls")||o.innerHTML.includes("demo-inline-controls"))return null;if(o.querySelector(".project-navigation")||o.innerHTML.includes("project-navigation"))return null;let e=o.querySelector(".dynamic-back-button");e||(e=document.createElement("button"),e.textContent="â† Back",e.className="dynamic-back-button",o.firstChild?o.insertBefore(e,o.firstChild):o.appendChild(e)),t();const i=async function(e){e.preventDefault(),window.soundEffects&&window.soundEffects.playButtonPress&&window.soundEffects.playButtonPress();const t=history.state,o=t&&t.contentType||null;n();let i=null;window.ScreenWipeTransition?i=await window.ScreenWipeTransition.startBack(()=>{g({fromContentType:o,originatingTab:w})}):g({fromContentType:o,originatingTab:w}),window.ScreenWipeTransition&&i&&await window.ScreenWipeTransition.end(i),history.pushState({path:f,isInitial:!0,isDynamic:!1,contentType:"blog"},"",f)},r=e._clickHandler;return r&&e.removeEventListener("click",r),e.addEventListener("click",i),e._clickHandler=i,e}async function E(n,i=!0,r="blog",c=null){if(!o)return;"boolean"==typeof r&&(r=r?"portfolio":"blog");const a=r||"blog",p="portfolio"===a,m="wares"===a;"function"==typeof cleanupCarouselInstances&&cleanupCarouselInstances(o),v(),o.classList.add("has-dynamic-content"),window.matchMedia("(max-width: 768px)").matches||(o.style.overflowY="auto",o.style.overflowX="hidden");const h=o.querySelector(".content-inner-wrapper");h&&(window.matchMedia("(max-width: 768px)").matches?h.style.setProperty("border-radius","12px","important"):h.style.setProperty("border-radius","12px 0 0 0","important"));let g=null;window.ScreenWipeTransition&&(g=await window.ScreenWipeTransition.start()),v(),o.innerHTML="";let b=!1;try{const L=await fetch(n);if(!L.ok)throw new Error(`HTTP error! status: ${L.status}`);const C=await L.text(),x=(new DOMParser).parseFromString(C,"text/html"),q=p?["div.project-edge-wrapper","div.project-wrapper"]:m?["div.ware-wrapper"]:["div.post-wrapper"];let k=null;for(const P of q)if(k=x.querySelector(P),k)break;k||p||m||(k=x.querySelector("div.project-wrapper"));const A=T();if(k){const j=k&&(k.classList.contains("post-wrapper")||k.querySelector(".post-wrapper")),I="blog"===a&&j,D=c||("portfolio"===a?"portfolio":"wares"===a?"wares":"blog"),M={source:"dynamic-content",url:n,originatingTab:D,contentType:a,isProject:p};if(w=D,history.state&&history.state.isInitial){const W={...history.state,fromTab:D};history.replaceState(W,"",W.path||f)}const z=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let B=null;if(p){const R=new URL(n,window.location.origin).pathname;B=R.replace(/\.html$/,"").replace(/\/?$/,"/")}if(z&&p&&k.querySelectorAll(".carousel img").forEach(e=>{const t=e.getAttribute("src")||"";if(t.startsWith("./")){const o=t.substring(2),n=B+o;e.setAttribute("src",n)}else if(t&&!t.startsWith("/")&&!t.startsWith("http")){const o=B+t;e.setAttribute("src",o)}}),p&&B){const $=e=>{if(!e)return e;if(e.startsWith("/")||e.startsWith("http")||e.startsWith("data:")||e.startsWith("blob:"))return e;const t=e.startsWith("./")?e.substring(2):e;return B+t};k.querySelectorAll("video").forEach(e=>{const t=e.getAttribute("poster"),o=$(t);o&&o!==t&&e.setAttribute("poster",o);const n=e.getAttribute("src"),i=$(n);i&&i!==n&&e.setAttribute("src",i),e.querySelectorAll("source").forEach(e=>{const t=e.getAttribute("src"),o=$(t);o&&o!==t&&e.setAttribute("src",o)})})}const N=document.createDocumentFragment();if(k.classList.contains("project-edge-wrapper")){const _=k.querySelector(".project-wrapper");_&&_.classList.add("dynamic-loaded");const O=k.cloneNode(!0);N.appendChild(O)}else{const U=document.createElement("div");U.className="content-inner-wrapper",U.style.opacity="0";const Y=window.matchMedia("(max-width: 768px)").matches;if(Y||(U.style.overflow="hidden"),Y?U.style.setProperty("border-radius","12px","important"):U.style.setProperty("border-radius","12px 0 0 0","important"),p){let K=null;K=k.classList.contains("project-wrapper")?k:k.querySelector(".project-wrapper"),K&&!K.classList.contains("dynamic-loaded")&&K.classList.add("dynamic-loaded")}U.appendChild(k.cloneNode(!0)),N.appendChild(U)}executeInlineScripts(N),A?A.after(N):o.appendChild(N),b=!0,y(I);const F=o.querySelector(".content-wrapper");F&&requestAnimationFrame(()=>{void 0!==ScrollUtility&&ScrollUtility?.scrollToElement?ScrollUtility.scrollToElement(F,{behavior:"auto",block:"start"}):F.scrollTo({top:0,behavior:"auto"})}),u(),function(){const e=o.querySelector(".project-edge-wrapper")||o.querySelector(".content-inner-wrapper")||o.querySelector(".project-edge-wrapper .project-wrapper");if(!e)return;v(),l(e),d(e);const t=new MutationObserver(t=>{for(const o of t)"style"===o.attributeName&&l(e)});t.observe(e,{attributes:!0,attributeFilter:["style"]}),s={host:e,cleanup:()=>t.disconnect()},e.classList.add("dynamic-scroll-host"),e.setAttribute("data-dynamic-scroll","true")}();const H=o.querySelector(".content-inner-wrapper");function E(){const e=o.querySelector(".read-story-button")||o.querySelector("#scrollToFullStoryBtn");return!!e&&(e.onclick=null,e.onclick=function(e){e.preventDefault(),window.playButtonSound&&window.playButtonSound(),window.scrollToFullStory&&window.scrollToFullStory()},!0)}H&&d(H),t(),e(o),window.initializeProjectTabs&&window.initializeProjectTabs(o),window.initializeProjectSummary&&window.initializeProjectSummary(o),window.initializeSoundEffects?window.initializeSoundEffects():setTimeout(()=>{window.initializeSoundEffects&&window.initializeSoundEffects()},100),p&&emitPortfolioLifecycle(M),E()||(setTimeout(E,100),setTimeout(E,300),setTimeout(E,500)),document.body.classList.add("has-dynamic-content-active"),document.dispatchEvent(new Event("dynamic-content-loaded")),emitBlogContentLifecycle(M)}else{y(!1);const X=document.createElement("p");X.textContent="Sorry, the content could not be loaded.",A?A.after(X):o.appendChild(X)}i&&history.pushState({path:n,contentType:a,isProject:p,isDynamic:!0,fromTab:resolvedOriginatingTab},"",n)}catch(J){if(console.error("[fetchAndDisplayContent] Failed to load dynamic content:",J),!b){const Z=document.createElement("p");Z.textContent="There was an error loading the page.";let V=o.querySelector(".dynamic-back-button");V||(V=T()),V?V.after(Z):o.appendChild(Z),y(!1),v(),o.classList.remove("has-dynamic-content"),o.style.removeProperty("overflow"),o.style.removeProperty("overflow-y"),o.style.removeProperty("overflow-x"),document.body.classList.remove("has-dynamic-content-active"),document.dispatchEvent(new Event("dynamic-content-unloaded"))}}window.ScreenWipeTransition&&g&&await window.ScreenWipeTransition.end(g),await S(o),ScrollUtility.scrollToElement(o,{behavior:"smooth",block:"start"})}function L(e){const t=e.currentTarget;if(!(t.hostname!==window.location.hostname||t.getAttribute("target")||"http:"!==t.protocol&&"https:"!==t.protocol||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)){const o=t.classList.contains("post-link-wrapper"),n=t.matches("a.portfolio-item-wrapper, a.portfolio-item.has-writeup"),i=t.classList.contains("wares-card");if(o||n||i){e.preventDefault(),o&&window.playBookSound&&window.playBookSound();const r=t.href,s=t.dataset.contentType||(n?"portfolio":i?"wares":"blog");E(r,!0,s,"portfolio"===s?"portfolio":"wares"===s?"wares":"blog")}}}function C(e){e&&e.querySelectorAll("a.post-link-wrapper, a.portfolio-item-wrapper, a.portfolio-item.has-writeup, a.wares-card").forEach(e=>{e.removeEventListener("click",L),e.addEventListener("click",L)})}t=function(){if(!o)return;const e=o.querySelector(".dynamic-back-button");if(!e)return;const t=o.querySelector(".content-inner-wrapper"),n=window.matchMedia("(max-width: 768px)").matches;if(n&&t&&e.parentElement!==t)return t.insertBefore(e,t.firstChild),void e.classList.add("is-mobile");n||e.parentElement===o||o.insertBefore(e,o.firstChild),e.classList.remove("is-mobile")},C(o);const x=async function(t){if(t.state&&t.state.fromTab&&(w=t.state.fromTab),!t.state||t.state.isInitial){const e=history.state,o=t.state&&t.state.fromTab,i=o||w||t.state&&t.state.contentType||e&&e.contentType||null,r="portfolio"===i||window.location.pathname.includes("/20"),s="portfolio"===o||e&&"portfolio"===e.fromTab||"portfolio"===w;return n(),void g({fromContentType:i||(r||s?"portfolio":null),originatingTab:o||w})}if(t.state&&t.state.page){const n=t.state.page;await async function(e,t=300){if(!e)return;const n=e.querySelector(".project-edge-wrapper");if(n)return n.style.opacity="1",n.style.transition=`opacity ${t}ms ease-in-out`,n.style.opacity="0",void await new Promise(e=>setTimeout(e,t));let i=e;e===o&&(i=e.querySelector(".content-inner-wrapper"),i||(i=e)),i&&(i.style.opacity="1",i.style.transition=`opacity ${t}ms ease-in-out`,i.style.opacity="0",await new Promise(e=>setTimeout(e,t)))}(o),window.history.replaceState({page:n},"",n);try{const i=await fetch(n,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(i.ok){const r=await i.text(),s=(new DOMParser).parseFromString(r,"text/html").querySelector(".blog");if(s){const i={source:"popstate",url:n,contentType:t.state?.contentType||"blog",originatingTab:t.state?.fromTab||w};o.innerHTML=s.innerHTML,executeInlineScripts(o),e(o),C(o),await S(o),"portfolio"===i.contentType&&emitPortfolioLifecycle(i),emitBlogContentLifecycle({...i,reinitialized:!0})}}}catch(e){await S(o)}}};window.addEventListener("popstate",x),window._blogPopstateHandler=x,window.fetchAndDisplayContent=E,history.state&&(history.state.isDynamic||history.state.isInitial)||history.replaceState({path:f,isInitial:!0,isDynamic:!1,fromTab:"blog",contentType:"blog"},"",f)}();let v=new Set(["professional","personal"]);function g(e){const t=e.currentTarget,o=t.closest(".filter-checkbox").getAttribute("data-type");t.checked?v.add(o):v.delete(o),S()}function b(){const e=document.querySelectorAll(".project-filter-container .filter-input"),t=document.querySelector("#projectsContent");document.querySelector(".project-toggle-container")&&!e.length||e.length&&t&&(e.forEach(e=>{const t=e.closest(".filter-checkbox").getAttribute("data-type");e.checked=v.has(t),e.removeEventListener("change",g),e.addEventListener("change",g)}),S())}function S(){const e=document.querySelector("#projectsContent");if(!e)return;const t=e.querySelectorAll(".company-group"),o=e.querySelectorAll(".portfolio-item");let n=!1;t.forEach(e=>{const t=e.getAttribute("data-project-type"),o=v.has(t);e.style.display=o?"":"none",o&&(n=!0)}),o.forEach(e=>{const t=e.getAttribute("data-project-type"),o=v.has(t);e.style.display=o?"":"none"});let i=e.querySelector(".no-projects-message");if(n||0!==v.size)if(n)i&&i.remove();else{i||(i=document.createElement("div"),i.className="no-projects-message",i.style.textAlign="center",i.style.padding="3rem 2rem",i.style.color="var(--text-color-secondary)",e.appendChild(i));const t=Array.from(v).join(" or ");i.textContent=`No ${t} projects to display.`}else i||(i=document.createElement("div"),i.className="no-projects-message",i.style.textAlign="center",i.style.padding="3rem 2rem",i.style.color="var(--text-color-secondary)",e.appendChild(i)),i.textContent="Please select at least one project type to display."}function T(){const e=this.nextElementSibling,t=this.closest("details");if(t)return void(this.textContent=t.open?"Show less":"Read more");const o="true"===this.getAttribute("aria-expanded");this.setAttribute("aria-expanded",!o),e&&(e.style.maxHeight=o?null:`${e.scrollHeight}px`),this.textContent=o?"Read more":"Show less"}window.initializeProjectToggle=b,window.initializePostsOnlyButton=c,e(document),initializeMobileTabs(),b(),c(),h();const E=document.querySelector("#postSearch");let L;E&&r(E),window.addEventListener("resize",function(){clearTimeout(L),L=setTimeout(function(){const e=document.querySelector(".blog-content");if(!e)return;const o=window.matchMedia("(max-width: 768px)").matches,n=e.querySelector(".dynamic-back-button"),i=e.querySelector(".content-inner-wrapper");n&&i&&(o?i.style.setProperty("border-radius","12px","important"):i.style.setProperty("border-radius","12px 0 0 0","important")),t()},250)})});