!function(){"use strict";let t,e=null;function o(){return window.innerWidth<=768||"ontouchstart"in window}window._notebookCarouselDebug={getInstance:()=>e,forceInitialize:()=>{s()},checkState:()=>({instance:!!e,initialized:e?.initialized,activeIndex:e?.currentActiveIndex,notebookCount:e?.notebooks?.length,container:!!document.querySelector(".portfolio-featured-grid.notebook-carousel-mobile")})};class i{constructor(){e&&e.destroy(),this.container=document.querySelector(".portfolio-featured-grid"),this.projectsContent=document.getElementById("projectsContent"),this.projectsContent,this.container&&this.projectsContent&&o()&&(this.notebooks=Array.from(this.container.querySelectorAll(".portfolio-item-wrapper")),0!==this.notebooks.length&&(this.isScrolling=!1,this.isTouching=!1,this.isActivating=!1,this.scrollTimeout=null,this.currentActiveIndex=-1,this.scrollEndDelay=100,this.initialized=!1,this.carouselObserver=null,this.initialPositioningComplete=!1,this.allowActivation=!1,e=this,this.init()))}init(){this.setupContainers(),requestAnimationFrame(()=>{this.setupScrolling(),this.initialized=!0,this.container.scrollLeft})}setupContainers(){this.projectsContent.classList.add("has-notebook-carousel"),this.container.classList.add("notebook-carousel-mobile"),document.body.classList.add("notebook-carousel-active"),sessionStorage.getItem("carouselScrollPosition")||(this.container.scrollLeft=0),this.notebooks.forEach((t,e)=>{})}setupScrolling(){this.container.addEventListener("scroll",this.handleScroll.bind(this)),this.container.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.container.addEventListener("touchmove",this.handleTouchMove.bind(this)),this.container.addEventListener("touchend",this.handleTouchEnd.bind(this)),"ontouchstart"in window&&document.body.classList.add("touch-device"),this.setupIntersectionObserver(),this.setupVisibilityObserver(),this.waitForNotebooksToLoad().then(()=>{this.initialPositioningComplete=!0}),window.addEventListener("resize",()=>{o()?this.initialized||this.init():this.destroy()})}waitForNotebooksToLoad(){return new Promise(t=>{const e=()=>{const e=this.container.querySelectorAll(".portfolio-item--featured");return this.container.querySelectorAll(".portfolio-item--featured.notebook-content-loaded, .portfolio-item--featured.notebook-loaded").length===e.length&&(t(),!0)};if(e())return;const o=setInterval(()=>{e()&&clearInterval(o)},100);setTimeout(()=>{clearInterval(o),t()},5e3)})}setupIntersectionObserver(){this.observer&&this.observer.disconnect();const t={root:this.container,rootMargin:"0px -30% 0px -30%",threshold:.3};this.observer=new IntersectionObserver(t=>{if(!this.initialPositioningComplete||!this.allowActivation)return;if(this.isScrolling||this.isTouching)return;let e=null,o=1/0;const i=this.container.getBoundingClientRect(),s=i.left+i.width/2;if(t.forEach(t=>{const i=t.target.getBoundingClientRect(),n=i.left+i.width/2,r=Math.abs(n-s);this.intersectionInfo={isIntersecting:t.isIntersecting,notebookIndex:this.notebooks.indexOf(t.target),notebookCenter:n,distanceFromCenter:r,intersectionRatio:t.intersectionRatio},t.isIntersecting&&r<o&&(o=r,e=t.target)}),e&&!this.isScrolling&&!this.isTouching){const t=this.notebooks.indexOf(e);-1!==t&&t!==this.currentActiveIndex&&this.activateNotebook(t)}},t),this.notebooks.forEach((t,e)=>{this.observer.observe(t)})}setupVisibilityObserver(){this.carouselObserver&&this.carouselObserver.disconnect(),this.carouselObserver=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting||-1===this.currentActiveIndex||this.resetAllNotebooks()})},{root:null,rootMargin:"0px",threshold:.1}),this.carouselObserver.observe(this.container)}handleScroll(){this.allowActivation||(this.allowActivation=!0),this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.isScrolling=!0,this.closeAllNotebooksForScroll(),this.scrollTimeout=setTimeout(()=>{this.isScrolling=!1,this.allowActivation&&this.snapToNearestNotebook()},this.scrollEndDelay)}handleTouchStart(t){this.allowActivation||(this.allowActivation=!0),this.isTouching=!0,this.closeAllNotebooksForScroll()}handleTouchMove(t){this.isTouching||(this.isTouching=!0,this.closeAllNotebooksForScroll())}handleTouchEnd(t){this.isTouching=!1}closeAllNotebooksForScroll(){this.notebooks.forEach(t=>{t.classList.remove("carousel-active","carousel-dimmed","carousel-closing")}),this.currentActiveIndex=-1,this.isActivating=!1}snapToNearestNotebook(){const t=this.container.getBoundingClientRect(),e=t.left+t.width/2;let o=null,i=1/0,s=-1;if(this.notebooks.forEach((t,n)=>{const r=t.getBoundingClientRect(),c=r.left+r.width/2,l=Math.abs(c-e);l<i&&(i=l,o=t,s=n)}),o){const t=this.container.offsetWidth,e=o.offsetWidth,i=o.offsetLeft-(t-e)/2;this.container.scrollTo({left:i,behavior:"smooth"}),setTimeout(()=>{this.allowActivation&&this.checkActiveNotebook()},200)}}checkActiveNotebook(){if(!this.allowActivation)return;const t=this.container.getBoundingClientRect(),e=t.left+t.width/2;let o=null,i=1/0,s=-1;this.notebooks.forEach((t,n)=>{const r=t.getBoundingClientRect(),c=r.left+r.width/2,l=Math.abs(c-e);l<i&&(i=l,o=t,s=n)}),-1!==s&&s!==this.currentActiveIndex&&this.activateNotebook(s)}activateNotebook(t){if(!(this.isScrolling||this.isTouching||this.isActivating)&&this.allowActivation){if(this.isActivating=!0,-1!==this.currentActiveIndex&&this.currentActiveIndex!==t){const t=this.notebooks[this.currentActiveIndex];this.currentActiveIndex,t.classList.add("carousel-closing"),setTimeout(()=>{t.classList.remove("carousel-active","carousel-closing"),t.classList.add("carousel-dimmed")},800)}this.notebooks.forEach((e,o)=>{o===t?(e.classList.remove("carousel-dimmed"),e.classList.add("carousel-active")):e.classList.remove("carousel-active","carousel-dimmed")}),this.currentActiveIndex=t,window.playBookSound&&setTimeout(()=>{window.playBookSound()},50),setTimeout(()=>{this.isActivating=!1},300)}}deactivateAllNotebooks(){this.notebooks.forEach(t=>{t.classList.remove("carousel-active","carousel-dimmed")}),this.currentActiveIndex=-1}resetAllNotebooks(){if(-1!==this.currentActiveIndex){const t=this.notebooks[this.currentActiveIndex];t.classList.add("carousel-closing"),setTimeout(()=>{t.classList.remove("carousel-closing")},100)}this.notebooks.forEach(t=>{t.classList.remove("carousel-active","carousel-dimmed","carousel-closing")}),this.currentActiveIndex=-1}restoreScrollPosition(t){this.container.style.scrollSnapType="none",this.container.scrollLeft=t,setTimeout(()=>{this.container.style.scrollSnapType="x mandatory",this.checkActiveNotebook()},100)}destroy(){this.projectsContent&&this.projectsContent.classList.remove("has-notebook-carousel"),this.container&&(this.container.classList.remove("notebook-carousel-mobile"),this.container.removeEventListener("scroll",this.handleScroll.bind(this)),this.container.removeEventListener("touchstart",this.handleTouchStart.bind(this)),this.container.removeEventListener("touchmove",this.handleTouchMove.bind(this)),this.container.removeEventListener("touchend",this.handleTouchEnd.bind(this))),document.body.classList.remove("notebook-carousel-active"),document.body.classList.remove("touch-device"),this.notebooks.forEach(t=>{t.classList.remove("carousel-active","carousel-dimmed","carousel-closing")}),this.observer&&(this.observer.disconnect(),this.observer=null),this.carouselObserver&&(this.carouselObserver.disconnect(),this.carouselObserver=null),this.scrollTimeout&&(clearTimeout(this.scrollTimeout),this.scrollTimeout=null),this.initialized=!1,this.initialPositioningComplete=!1,this.allowActivation=!1,this.currentActiveIndex=-1,this.isTouching=!1,e===this&&(e=null)}}function s(){if(!o())return;const t=document.querySelector(".portfolio-featured-grid");if(!t)return;if(t.classList.contains("notebook-carousel-mobile")){const t=sessionStorage.getItem("carouselScrollPosition");return void(t&&e&&(e.restoreScrollPosition(parseInt(t,10)),sessionStorage.removeItem("carouselScrollPosition")))}e&&e.destroy();const n=document.getElementById("projectsContent");!n||"none"!==window.getComputedStyle(n).display&&"hidden"!==window.getComputedStyle(n).visibility&&"0"!==window.getComputedStyle(n).opacity?new i:setTimeout(()=>s(),100)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{s()}):s(),document.addEventListener("contentLoaded",()=>{s()}),document.addEventListener("portfolio-loaded",()=>{s()}),window.addEventListener("load",()=>{document.querySelector(".portfolio-featured-grid.notebook-carousel-mobile")||s()}),window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{const t=document.querySelector(".portfolio-featured-grid");if(!t)return;const e=window.innerWidth<=768,o=t.classList.contains("notebook-carousel-mobile");if(e&&!o)s();else if(!e&&o){t.classList.remove("notebook-carousel-mobile"),t.style.removeProperty("display"),t.style.removeProperty("overflow-x"),t.style.removeProperty("overflow-y"),t.style.removeProperty("scroll-snap-type"),t.querySelectorAll(".portfolio-item-wrapper").forEach(t=>{t.classList.remove("carousel-active","carousel-dimmed")});const e=t.closest(".portfolio-list, .portfolio-list--redesigned");e&&e.classList.remove("has-notebook-carousel"),document.body.classList.remove("notebook-carousel-active")}},250)})}();