export class CarouselGestures{constructor(t,e,i={}){this.element=t,this.state=e,this.config={minSwipeDistance:50,maxSwipeTime:300,velocityThreshold:.3,preventVerticalScroll:!0,enableMomentum:!0,...i},this.touchData={startX:0,startY:0,currentX:0,currentY:0,startTime:0,velocityX:0,isActive:!1,identifier:null},this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleWheel=this.handleWheel.bind(this)}enable(){this.element.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.element.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.element.addEventListener("touchend",this.handleTouchEnd),this.element.addEventListener("touchcancel",this.handleTouchEnd),this.element.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.element.addEventListener("wheel",this.handleWheel,{passive:!1})}disable(){this.element.removeEventListener("touchstart",this.handleTouchStart),this.element.removeEventListener("touchmove",this.handleTouchMove),this.element.removeEventListener("touchend",this.handleTouchEnd),this.element.removeEventListener("touchcancel",this.handleTouchEnd),this.element.removeEventListener("mousedown",this.handleMouseDown),this.element.removeEventListener("wheel",this.handleWheel)}handleTouchStart(t){if(this.state.isTransitioning)return;const e=t.touches[0];this.touchData={startX:e.clientX,startY:e.clientY,currentX:e.clientX,currentY:e.clientY,startTime:Date.now(),velocityX:0,isActive:!0,identifier:e.identifier},this.element.classList.add("dragging")}handleTouchMove(t){if(!this.touchData.isActive)return;const e=Array.from(t.touches).find(t=>t.identifier===this.touchData.identifier);if(!e)return;const i=e.clientX-this.touchData.startX,s=e.clientY-this.touchData.startY;this.touchData.velocityX=e.clientX-this.touchData.currentX,this.touchData.currentX=e.clientX,this.touchData.currentY=e.clientY,this.config.preventVerticalScroll&&Math.abs(i)>Math.abs(s)&&(t.preventDefault(),this.applyDragTransform(i))}handleTouchEnd(t){if(!this.touchData.isActive)return;const e=this.touchData.currentX-this.touchData.startX,i=this.touchData.currentY-this.touchData.startY,s=Date.now()-this.touchData.startTime;if(this.element.classList.remove("dragging"),this.resetDragTransform(),Math.abs(e)>Math.abs(i)){const t=Math.abs(this.touchData.velocityX);(Math.abs(e)>this.config.minSwipeDistance||t>this.config.velocityThreshold&&s<this.config.maxSwipeTime)&&(e>0?this.state.prev():this.state.next(),this.triggerHapticFeedback())}this.touchData.isActive=!1}handleMouseDown(t){if(this.state.isTransitioning)return;const e=t.clientX;let i=e,s=!1;const n=t=>{const n=t.clientX-e;!s&&Math.abs(n)>5&&(s=!0,this.element.classList.add("dragging")),s&&(i=t.clientX,this.applyDragTransform(n))},a=()=>{if(s){const t=i-e;this.element.classList.remove("dragging"),this.resetDragTransform(),Math.abs(t)>this.config.minSwipeDistance&&(t>0?this.state.prev():this.state.next())}document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",a)}handleWheel(t){Math.abs(t.deltaX)>Math.abs(t.deltaY)&&(t.preventDefault(),this.wheelTimeout||(t.deltaX>0?this.state.next():this.state.prev(),this.wheelTimeout=setTimeout(()=>{this.wheelTimeout=null},300)))}applyDragTransform(t){const e=this.element.querySelector(".carousel-track");if(!e)return;const i=.3*this.element.offsetWidth,s=Math.max(-i,Math.min(i,t)),n=s*(1-Math.abs(s)/i*.3);e.style.transform=`translateX(${n}px)`,e.style.transition="none"}resetDragTransform(){const t=this.element.querySelector(".carousel-track");t&&(t.style.transform="",t.style.transition="")}triggerHapticFeedback(){"vibrate"in navigator&&navigator.vibrate(10),window.webkit?.messageHandlers?.haptic&&window.webkit.messageHandlers.haptic.postMessage("impact")}}